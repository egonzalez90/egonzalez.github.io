<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>OpenStack Stuff - application catalog</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">OpenStack Stuff </a></h1>
                <nav><ul>
                    <li><a href="/category/linux.html">Linux</a></li>
                    <li><a href="/category/linux-openstack.html">Linux, OpenStack</a></li>
                    <li><a href="/category/linux-openstack-various.html">Linux, OpenStack, Various</a></li>
                    <li><a href="/category/linux-various.html">Linux, Various</a></li>
                    <li><a href="/category/linux-virtualizacion.html">Linux, Virtualizacion</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/openstack.html">OpenStack</a></li>
                    <li><a href="/category/reflexiones.html">Reflexiones</a></li>
                    <li><a href="/category/various.html">Various</a></li>
                    <li><a href="/category/virtualizacion.html">Virtualizacion</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/murano-in-rdo-openstack-manual-installation.html">Murano in RDO OpenStack - Manual Installation</a></h1>
<footer class="post-info">
        <span>Mon 14 December 2015</span>
<span>| tags: <a href="/tag/app.html">app</a><a href="/tag/application-catalog.html">application catalog</a><a href="/tag/centos.html">centos</a><a href="/tag/create.html">create</a><a href="/tag/deploy.html">deploy</a><a href="/tag/environment.html">environment</a><a href="/tag/install.html">install</a><a href="/tag/liberty.html">liberty</a><a href="/tag/manual.html">manual</a><a href="/tag/murano.html">murano</a><a href="/tag/openstack.html">openstack</a><a href="/tag/packstack.html">packstack</a><a href="/tag/rdo.html">rdo</a><a href="/tag/red-hat.html">red hat</a></span>
</footer><!-- /.post-info --><p>Want to install and use Murano in a RDO OpenStack environment? Here are
the steps to do it.</p>
<p>The first thing we need to do, is to know what is Murano:<br>
Murano is an application catalog who gives the users the capacity to
launch pre-configured s/instances/jobs/g with apps in an OpenStack
infrastructure.<br>
As the final user just select an application from a catalog with a
minimal configuration, and Murano will take the role to orchestrate the
background jobs(create instances, configure apps, connect networks,
etc)<br>
For more information about application catalog project refer to this
site:<br>
<a href="https://wiki.openstack.org/wiki/Murano/ApplicationCatalog">https://wiki.openstack.org/wiki/Murano/ApplicationCatalog</a></p>
<p>At this tutorial, i will use the following s/configurations/versions/g:</p>
<ul>
<li>Centos 7.1</li>
<li>RDO Liberty release</li>
<li>Hosts installed with packstack/ML2 network</li>
</ul>
<p>Let's start installing some pre requisites</p>
<div class="highlight"><pre><span></span>sudo yum install -y gcc python-setuptools python-devel git postgresql-devel libffi-devel openssl-devel
</pre></div>


<p>Install pip</p>
<div class="highlight"><pre><span></span>sudo easy_install pip
</pre></div>


<p>Install tox and upgrade six</p>
<div class="highlight"><pre><span></span>sudo pip install tox
sudo pip install --upgrade six
</pre></div>


<p>Create a database for murano</p>
<div class="highlight"><pre><span></span>mysql -u root -p
CREATE DATABASE murano;
</pre></div>


<p>Create murano user at MySQL</p>
<div class="highlight"><pre><span></span>GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;%&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
</pre></div>


<p>Clone murano from liberty/stable branch</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano
</pre></div>


<p>Install all requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano/
sudo  pip install -r requirements.txt
</pre></div>


<p>Install murano</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Create sample configuration file</p>
<div class="highlight"><pre><span></span>oslo-config-generator --config-file etc/oslo-config-generator/murano.conf
</pre></div>


<p>Create murano directory and copy the sample content on it</p>
<div class="highlight"><pre><span></span>mkdir /etc/murano
cp ~/murano/etc/murano/* /etc/murano/
</pre></div>


<p>Rename sample configuration to murano.conf</p>
<div class="highlight"><pre><span></span>mv /etc/murano/murano.conf.sample /etc/murano/murano.conf
</pre></div>


<p>Edit the configuration file like this, adjust the configuration as your
environment needs.<br>
<code>vi /etc/murano/murano.conf</code></p>
<div class="highlight"><pre><span></span><span class="k">[oslo_messaging_rabbit]</span>

<span class="na">rabbit_host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">rabbit_port</span><span class="o">=</span><span class="s">5672</span>
<span class="na">rabbit_hosts</span><span class="o">=</span><span class="s">RABBITMQ_IP:5672</span>
<span class="na">rabbit_use_ssl</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_userid</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_virtual_host</span><span class="o">=</span><span class="s">/</span>
<span class="na">rabbit_ha_queues</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_notification_exchange</span><span class="o">=</span><span class="s">openstack</span>
<span class="na">rabbit_notification_topic</span><span class="o">=</span><span class="s">notifications</span>

<span class="k">[database]</span>
<span class="na">connection</span> <span class="o">=</span> <span class="s">mysql://murano:MURANODB_PASS@MYSQL_IP/murano</span>

<span class="k">[keystone_authtoken]</span>
<span class="na">auth_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:5000/v2.0</span>
<span class="na">identity_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:35357</span>
<span class="na">admin_user</span><span class="o">=</span><span class="s">murano</span>
<span class="na">admin_password</span><span class="o">=</span><span class="s">MURANO_PASS</span>
<span class="na">admin_tenant_name</span><span class="o">=</span><span class="s">services</span>

<span class="k">[murano]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">http://MURANO_IP:8082</span>

<span class="k">[rabbitmq]</span>

<span class="na">host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">login</span><span class="o">=</span><span class="s">guest</span>
<span class="na">password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">virtual_host</span><span class="o">=</span><span class="s">/</span>
</pre></div>


<p>Create murano user</p>
<div class="highlight"><pre><span></span>openstack user create --password MURANO_PASS murano
</pre></div>


<p>Add murano user to services tenant with admin privileges</p>
<div class="highlight"><pre><span></span>openstack role add --project services --user murano admin
</pre></div>


<p>Create a service for application-catalog</p>
<div class="highlight"><pre><span></span>openstack service create --name muranoapi --description &quot;Murano Project&quot; application-catalog
</pre></div>


<p>Associate an endpoint to application-catalog service</p>
<div class="highlight"><pre><span></span>openstack endpoint create --region RegionOne --publicurl &#39;http://MURANO_IP:8082/&#39; --adminurl &#39;http://MURANO_IP:8082/&#39; --internalurl &#39;http://http://MURANO_IP:8082/&#39; MURANO_SERVICE_ID
</pre></div>


<p>Sync the database</p>
<div class="highlight"><pre><span></span>murano-db-manage --config-file /etc/murano/murano.conf upgrade
</pre></div>


<p>Open a new terminal and start murano-api service</p>
<div class="highlight"><pre><span></span>murano-api --config-file /etc/murano/murano.conf
</pre></div>


<p>Import base murano package</p>
<div class="highlight"><pre><span></span>murano-manage --config-file /etc/murano/murano.conf import-package murano/meta/io.murano
</pre></div>


<p>In a new terminal, start murano-engine service</p>
<div class="highlight"><pre><span></span>murano-engine --config-file /etc/murano/murano.conf
</pre></div>


<p>Clone stable liberty module for horizon</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano-dashboard
</pre></div>


<p>Install base requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano-dashboard
pip install -r requirements.txt
</pre></div>


<p>Install murano-dashboard module</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Enable murano-dashboard at horizon</p>
<div class="highlight"><pre><span></span>cp muranodashboard/local/_50_murano.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
</pre></div>


<p>Restart apache to apply changes</p>
<div class="highlight"><pre><span></span>systemctl restart httpd
</pre></div>


<p>Import ApacheHttpServer package</p>
<div class="highlight"><pre><span></span><span class="n">murano</span> <span class="o">--</span><span class="n">murano</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://storage.apps.openstack.org/&quot;</span> <span class="n">package</span><span class="o">-</span><span class="kn">import</span> <span class="nn">io.murano.apps.apache.ApacheHttpServer</span>
</pre></div>


<p>You can find more packages at:
<a href="http://apps.openstack.org/#tab=murano-apps">http://apps.openstack.org/#tab=murano-apps</a></p>
<p>This will add a Debian image to glance image service, wait until the
image is in active status</p>
<p>Create a file with the following content, modify the variables with your
own needs<br>
<code>vi object_model_patch.json</code></p>
<div class="highlight"><pre><span></span>[
    { &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/-&quot;, &quot;value&quot;:
        {
            &quot;instance&quot;: {
                &quot;availabilityZone&quot;: &quot;nova&quot;,
                &quot;name&quot;: &quot;APP_NAME&quot;,
                &quot;image&quot;: &quot;GLANCE_IMAGE_ID&quot;,
                &quot;keyname&quot;: &quot;KEY_PAIR&quot;,
                &quot;flavor&quot;: &quot;FLAVOR&quot;,
                &quot;assignFloatingIp&quot;: false,
                &quot;?&quot;: {
                    &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,
                    &quot;id&quot;: &quot;===id1===&quot;
                }
            },
            &quot;name&quot;: &quot;ApacheHttpServer&quot;,
            &quot;enablePHP&quot;: true,
            &quot;?&quot;: {
                &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,
                &quot;id&quot;: &quot;===id2===&quot;
            }
        }
    }
]
</pre></div>


<p>Create an environment</p>
<div class="highlight"><pre><span></span>murano environment-create --join-subnet-id SUBNET_ID ENVIRONMENT_NAME

murano environment-create --join-subnet-id e2c5175a-d5bc-4eb7-91ba-67ac9120c64a test
+----------------------------------+------+---------------------+---------------------+
| ID                               | Name | Created             | Updated             |
+----------------------------------+------+---------------------+---------------------+
| 68a19d233d2d42459faf64d375d995e5 | test | 2015-12-11T13:09:57 | 2015-12-11T13:09:57 |
+----------------------------------+------+---------------------+---------------------+
</pre></div>


<p>Create a session for temporal working on the environment</p>
<div class="highlight"><pre><span></span>murano environment-session-create ENVIRONMENT_ID

murano environment-session-create 68a19d233d2d42459faf64d375d995e5
Created new session:
+----------+----------------------------------+
| Property | Value                            |
+----------+----------------------------------+
| id       | b0f5e39a9c4c419c9ee7fdb6c92c37a6 |
+----------+----------------------------------+
</pre></div>


<p>Add the file with the apps configuration</p>
<div class="highlight"><pre><span></span>murano environment-apps-edit --session-id SESSION_ID ENVIRONMENT_ID FILE_NAME

murano environment-apps-edit --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6 68a19d233d2d42459faf64d375d995e5 object_model_patch.json
</pre></div>


<p>Deploy the environment</p>
<div class="highlight"><pre><span></span>murano environment-deploy ENVIRONMENT_ID --session-id SESSION_ID

murano environment-deploy 68a19d233d2d42459faf64d375d995e5 --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6
+-----------+-------------------------------------------------------------+
| Property  | Value                                                       |
+-----------+-------------------------------------------------------------+
| created   | 2015-12-11T13:09:57                                         |
| id        | 68a19d233d2d42459faf64d375d995e5                            |
| name      | test                                                        |
| services  | [                                                           |
|           |   {                                                         |
|           |     &quot;instance&quot;: {                                           |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                           |
|           |       &quot;name&quot;: &quot;test&quot;,                                       |
|           |       &quot;assignFloatingIp&quot;: false,                            |
|           |       &quot;keyname&quot;: &quot;&quot;,                                        |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                    |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,      |
|           |       &quot;?&quot;: {                                                |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,  |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;            |
|           |       }                                                     |
|           |     },                                                      |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                             |
|           |     &quot;enablePHP&quot;: true,                                      |
|           |     &quot;?&quot;: {                                                  |
|           |       &quot;status&quot;: &quot;deploying&quot;,                                |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,     |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;              |
|           |     }                                                       |
|           |   }                                                         |
|           | ]                                                           |
| status    | deploying                                                   |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                            |
| updated   | 2015-12-11T13:09:57                                         |
| version   | 0                                                           |
+-----------+-------------------------------------------------------------+
</pre></div>


<p>Now, you can check at nova the building status of the instances</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | BUILD  | scheduling | NOSTATE     |          |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
</pre></div>


<p>After a while, the instance is up and running</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks         |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | ACTIVE | -          | Running     | private=10.0.0.8 |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
</pre></div>


<p>Once the instance is active, murano will configure the application
inside, wait until the status is ready.</p>
<div class="highlight"><pre><span></span>murano environment-show f392de2004e24ff7b2a08f05df0599b8
+-----------+---------------------------------------------------------------+
| Property  | Value                                                         |
+-----------+---------------------------------------------------------------+
| created   | 2015-12-11T13:43:23                                           |
| id        | 68a19d233d2d42459faf64d375d995e5                              |
| name      | test                                                          |
| services  | [                                                             |
|           |   {                                                           |
|           |     &quot;instance&quot;: {                                             |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                             |
|           |       &quot;openstackId&quot;: &quot;91615340-e1d3-428e-848f-38a762004d33&quot;,  |
|           |       &quot;name&quot;: &quot;test&quot;,                                         |
|           |       &quot;securityGroupName&quot;: null,                              |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,        |
|           |       &quot;assignFloatingIp&quot;: false,                              |
|           |       &quot;floatingIpAddress&quot;: null,                              |
|           |       &quot;keyname&quot;: &quot;&quot;,                                          |
|           |       &quot;?&quot;: {                                                  |
|           |         &quot;classVersion&quot;: &quot;0.0.0&quot;,                              |
|           |         &quot;name&quot;: null,                                         |
|           |         &quot;package&quot;: &quot;io.murano&quot;,                               |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,    |
|           |         &quot;_actions&quot;: {},                                       |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;              |
|           |       },                                                      |
|           |       &quot;ipAddresses&quot;: [                                        |
|           |         &quot;10.0.0.8&quot;                                            |
|           |       ],                                                      |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                      |
|           |       &quot;networks&quot;: {                                           |
|           |         &quot;useFlatNetwork&quot;: false,                              |
|           |         &quot;primaryNetwork&quot;: null,                               |
|           |         &quot;useEnvironmentNetwork&quot;: true,                        |
|           |         &quot;customNetworks&quot;: []                                  |
|           |       },                                                      |
|           |       &quot;sharedIps&quot;: []                                         |
|           |     },                                                        |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                               |
|           |     &quot;?&quot;: {                                                    |
|           |       &quot;classVersion&quot;: &quot;0.0.0&quot;,                                |
|           |       &quot;status&quot;: &quot;ready&quot;,                                      |
|           |       &quot;name&quot;: null,                                           |
|           |       &quot;package&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,    |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,       |
|           |       &quot;_actions&quot;: {},                                         |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;                |
|           |     },                                                        |
|           |     &quot;enablePHP&quot;: true                                         |
|           |   }                                                           |
|           | ]                                                             |
| status    | ready                                                         |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                              |
| updated   | 2015-12-11T13:47:35                                           |
| version   | 1                                                             |
+-----------+---------------------------------------------------------------+
</pre></div>


<p>That's all you need to have up and running a Murano application catalog,
for now there is no rpm package to ease the installation, so you need to
install from source like we done.<br>
A thing you can do, is create systemd files to manage murano services
in a easier way.</p>
<p>Regards, Eduardo Gonzalez</p><p><a href="/murano-in-rdo-openstack-manual-installation.html#disqus_thread">comments</a></p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://twitter.com/egongu90">Twitter</a></li>
                            <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                            <li><a href="https://github.com/egonzalez90">Github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'egonzalez-1';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>