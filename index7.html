<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | Page 7</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Dec 14, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html" rel="bookmark" title="Permanent Link to &quot;Murano in RDO OpenStack - Manual Installation&quot;">Murano in RDO OpenStack - Manual Installation</a>
                </h2>

                
                

                <p>Want to install and use Murano in a RDO OpenStack environment? Here are
the steps to do it.</p>
<p>The first thing we need to do, is to know what is Murano:<br>
Murano is an application catalog who gives the users the capacity to
launch pre-configured s/instances/jobs/g with apps in an OpenStack
infrastructure.<br>
As the final user just select an application from a catalog with a
minimal configuration, and Murano will take the role to orchestrate the
background jobs(create instances, configure apps, connect networks,
etc)<br>
For more information about application catalog project refer to this
site:<br>
<a href="https://wiki.openstack.org/wiki/Murano/ApplicationCatalog">https://wiki.openstack.org/wiki/Murano/ApplicationCatalog</a></p>
<p>At this tutorial, i will use the following s/configurations/versions/g:</p>
<ul>
<li>Centos 7.1</li>
<li>RDO Liberty release</li>
<li>Hosts installed with packstack/ML2 network</li>
</ul>
<p>Let's start installing some pre requisites</p>
<div class="highlight"><pre><span></span>sudo yum install -y gcc python-setuptools python-devel git postgresql-devel libffi-devel openssl-devel
</pre></div>


<p>Install pip</p>
<div class="highlight"><pre><span></span>sudo easy_install pip
</pre></div>


<p>Install tox and upgrade six</p>
<div class="highlight"><pre><span></span>sudo pip install tox
sudo pip install --upgrade six
</pre></div>


<p>Create a database for murano</p>
<div class="highlight"><pre><span></span>mysql -u root -p
CREATE DATABASE murano;
</pre></div>


<p>Create murano user at MySQL</p>
<div class="highlight"><pre><span></span>GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;%&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
</pre></div>


<p>Clone murano from liberty/stable branch</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano
</pre></div>


<p>Install all requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano/
sudo  pip install -r requirements.txt
</pre></div>


<p>Install murano</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Create sample configuration file</p>
<div class="highlight"><pre><span></span>oslo-config-generator --config-file etc/oslo-config-generator/murano.conf
</pre></div>


<p>Create murano directory and copy the sample content on it</p>
<div class="highlight"><pre><span></span>mkdir /etc/murano
cp ~/murano/etc/murano/* /etc/murano/
</pre></div>


<p>Rename sample configuration to murano.conf</p>
<div class="highlight"><pre><span></span>mv /etc/murano/murano.conf.sample /etc/murano/murano.conf
</pre></div>


<p>Edit the configuration file like this, adjust the configuration as your
environment needs.<br>
<code>vi /etc/murano/murano.conf</code></p>
<div class="highlight"><pre><span></span><span class="k">[oslo_messaging_rabbit]</span>

<span class="na">rabbit_host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">rabbit_port</span><span class="o">=</span><span class="s">5672</span>
<span class="na">rabbit_hosts</span><span class="o">=</span><span class="s">RABBITMQ_IP:5672</span>
<span class="na">rabbit_use_ssl</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_userid</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_virtual_host</span><span class="o">=</span><span class="s">/</span>
<span class="na">rabbit_ha_queues</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_notification_exchange</span><span class="o">=</span><span class="s">openstack</span>
<span class="na">rabbit_notification_topic</span><span class="o">=</span><span class="s">notifications</span>

<span class="k">[database]</span>
<span class="na">connection</span> <span class="o">=</span> <span class="s">mysql://murano:MURANODB_PASS@MYSQL_IP/murano</span>

<span class="k">[keystone_authtoken]</span>
<span class="na">auth_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:5000/v2.0</span>
<span class="na">identity_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:35357</span>
<span class="na">admin_user</span><span class="o">=</span><span class="s">murano</span>
<span class="na">admin_password</span><span class="o">=</span><span class="s">MURANO_PASS</span>
<span class="na">admin_tenant_name</span><span class="o">=</span><span class="s">services</span>

<span class="k">[murano]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">http://MURANO_IP:8082</span>

<span class="k">[rabbitmq]</span>

<span class="na">host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">login</span><span class="o">=</span><span class="s">guest</span>
<span class="na">password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">virtual_host</span><span class="o">=</span><span class="s">/</span>
</pre></div>


<p>Create murano user</p>
<div class="highlight"><pre><span></span>openstack user create --password MURANO_PASS murano
</pre></div>


<p>Add murano user to services tenant with admin privileges</p>
<div class="highlight"><pre><span></span>openstack role add --project services --user murano admin
</pre></div>


<p>Create a service for application-catalog</p>
<div class="highlight"><pre><span></span>openstack service create --name muranoapi --description &quot;Murano Project&quot; application-catalog
</pre></div>


<p>Associate an endpoint to application-catalog service</p>
<div class="highlight"><pre><span></span>openstack endpoint create --region RegionOne --publicurl &#39;http://MURANO_IP:8082/&#39; --adminurl &#39;http://MURANO_IP:8082/&#39; --internalurl &#39;http://http://MURANO_IP:8082/&#39; MURANO_SERVICE_ID
</pre></div>


<p>Sync the database</p>
<div class="highlight"><pre><span></span>murano-db-manage --config-file /etc/murano/murano.conf upgrade
</pre></div>


<p>Open a new terminal and start murano-api service</p>
<div class="highlight"><pre><span></span>murano-api --config-file /etc/murano/murano.conf
</pre></div>


<p>Import base murano package</p>
<div class="highlight"><pre><span></span>murano-manage --config-file /etc/murano/murano.conf import-package murano/meta/io.murano
</pre></div>


<p>In a new terminal, start murano-engine service</p>
<div class="highlight"><pre><span></span>murano-engine --config-file /etc/murano/murano.conf
</pre></div>


<p>Clone stable liberty module for horizon</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano-dashboard
</pre></div>


<p>Install base requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano-dashboard
pip install -r requirements.txt
</pre></div>


<p>Install murano-dashboard module</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Enable murano-dashboard at horizon</p>
<div class="highlight"><pre><span></span>cp muranodashboard/local/_50_murano.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
</pre></div>


<p>Restart apache to apply changes</p>
<div class="highlight"><pre><span></span>systemctl restart httpd
</pre></div>


<p>Import ApacheHttpServer package</p>
<div class="highlight"><pre><span></span><span class="n">murano</span> <span class="o">--</span><span class="n">murano</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://storage.apps.openstack.org/&quot;</span> <span class="n">package</span><span class="o">-</span><span class="kn">import</span> <span class="nn">io.murano.apps.apache.ApacheHttpServer</span>
</pre></div>


<p>You can find more packages at:
<a href="http://apps.openstack.org/#tab=murano-apps">http://apps.openstack.org/#tab=murano-apps</a></p>
<p>This will add a Debian image to glance image service, wait until the
image is in active status</p>
<p>Create a file with the following content, modify the variables with your
own needs<br>
<code>vi object_model_patch.json</code></p>
<div class="highlight"><pre><span></span>[
    { &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/-&quot;, &quot;value&quot;:
        {
            &quot;instance&quot;: {
                &quot;availabilityZone&quot;: &quot;nova&quot;,
                &quot;name&quot;: &quot;APP_NAME&quot;,
                &quot;image&quot;: &quot;GLANCE_IMAGE_ID&quot;,
                &quot;keyname&quot;: &quot;KEY_PAIR&quot;,
                &quot;flavor&quot;: &quot;FLAVOR&quot;,
                &quot;assignFloatingIp&quot;: false,
                &quot;?&quot;: {
                    &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,
                    &quot;id&quot;: &quot;===id1===&quot;
                }
            },
            &quot;name&quot;: &quot;ApacheHttpServer&quot;,
            &quot;enablePHP&quot;: true,
            &quot;?&quot;: {
                &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,
                &quot;id&quot;: &quot;===id2===&quot;
            }
        }
    }
]
</pre></div>


<p>Create an environment</p>
<div class="highlight"><pre><span></span>murano environment-create --join-subnet-id SUBNET_ID ENVIRONMENT_NAME

murano environment-create --join-subnet-id e2c5175a-d5bc-4eb7-91ba-67ac9120c64a test
+----------------------------------+------+---------------------+---------------------+
| ID                               | Name | Created             | Updated             |
+----------------------------------+------+---------------------+---------------------+
| 68a19d233d2d42459faf64d375d995e5 | test | 2015-12-11T13:09:57 | 2015-12-11T13:09:57 |
+----------------------------------+------+---------------------+---------------------+
</pre></div>


<p>Create a session for temporal working on the environment</p>
<div class="highlight"><pre><span></span>murano environment-session-create ENVIRONMENT_ID

murano environment-session-create 68a19d233d2d42459faf64d375d995e5
Created new session:
+----------+----------------------------------+
| Property | Value                            |
+----------+----------------------------------+
| id       | b0f5e39a9c4c419c9ee7fdb6c92c37a6 |
+----------+----------------------------------+
</pre></div>


<p>Add the file with the apps configuration</p>
<div class="highlight"><pre><span></span>murano environment-apps-edit --session-id SESSION_ID ENVIRONMENT_ID FILE_NAME

murano environment-apps-edit --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6 68a19d233d2d42459faf64d375d995e5 object_model_patch.json
</pre></div>


<p>Deploy the environment</p>
<div class="highlight"><pre><span></span>murano environment-deploy ENVIRONMENT_ID --session-id SESSION_ID

murano environment-deploy 68a19d233d2d42459faf64d375d995e5 --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6
+-----------+-------------------------------------------------------------+
| Property  | Value                                                       |
+-----------+-------------------------------------------------------------+
| created   | 2015-12-11T13:09:57                                         |
| id        | 68a19d233d2d42459faf64d375d995e5                            |
| name      | test                                                        |
| services  | [                                                           |
|           |   {                                                         |
|           |     &quot;instance&quot;: {                                           |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                           |
|           |       &quot;name&quot;: &quot;test&quot;,                                       |
|           |       &quot;assignFloatingIp&quot;: false,                            |
|           |       &quot;keyname&quot;: &quot;&quot;,                                        |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                    |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,      |
|           |       &quot;?&quot;: {                                                |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,  |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;            |
|           |       }                                                     |
|           |     },                                                      |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                             |
|           |     &quot;enablePHP&quot;: true,                                      |
|           |     &quot;?&quot;: {                                                  |
|           |       &quot;status&quot;: &quot;deploying&quot;,                                |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,     |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;              |
|           |     }                                                       |
|           |   }                                                         |
|           | ]                                                           |
| status    | deploying                                                   |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                            |
| updated   | 2015-12-11T13:09:57                                         |
| version   | 0                                                           |
+-----------+-------------------------------------------------------------+
</pre></div>


<p>Now, you can check at nova the building status of the instances</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | BUILD  | scheduling | NOSTATE     |          |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
</pre></div>


<p>After a while, the instance is up and running</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks         |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | ACTIVE | -          | Running     | private=10.0.0.8 |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
</pre></div>


<p>Once the instance is active, murano will configure the application
inside, wait until the status is ready.</p>
<div class="highlight"><pre><span></span>murano environment-show f392de2004e24ff7b2a08f05df0599b8
+-----------+---------------------------------------------------------------+
| Property  | Value                                                         |
+-----------+---------------------------------------------------------------+
| created   | 2015-12-11T13:43:23                                           |
| id        | 68a19d233d2d42459faf64d375d995e5                              |
| name      | test                                                          |
| services  | [                                                             |
|           |   {                                                           |
|           |     &quot;instance&quot;: {                                             |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                             |
|           |       &quot;openstackId&quot;: &quot;91615340-e1d3-428e-848f-38a762004d33&quot;,  |
|           |       &quot;name&quot;: &quot;test&quot;,                                         |
|           |       &quot;securityGroupName&quot;: null,                              |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,        |
|           |       &quot;assignFloatingIp&quot;: false,                              |
|           |       &quot;floatingIpAddress&quot;: null,                              |
|           |       &quot;keyname&quot;: &quot;&quot;,                                          |
|           |       &quot;?&quot;: {                                                  |
|           |         &quot;classVersion&quot;: &quot;0.0.0&quot;,                              |
|           |         &quot;name&quot;: null,                                         |
|           |         &quot;package&quot;: &quot;io.murano&quot;,                               |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,    |
|           |         &quot;_actions&quot;: {},                                       |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;              |
|           |       },                                                      |
|           |       &quot;ipAddresses&quot;: [                                        |
|           |         &quot;10.0.0.8&quot;                                            |
|           |       ],                                                      |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                      |
|           |       &quot;networks&quot;: {                                           |
|           |         &quot;useFlatNetwork&quot;: false,                              |
|           |         &quot;primaryNetwork&quot;: null,                               |
|           |         &quot;useEnvironmentNetwork&quot;: true,                        |
|           |         &quot;customNetworks&quot;: []                                  |
|           |       },                                                      |
|           |       &quot;sharedIps&quot;: []                                         |
|           |     },                                                        |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                               |
|           |     &quot;?&quot;: {                                                    |
|           |       &quot;classVersion&quot;: &quot;0.0.0&quot;,                                |
|           |       &quot;status&quot;: &quot;ready&quot;,                                      |
|           |       &quot;name&quot;: null,                                           |
|           |       &quot;package&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,    |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,       |
|           |       &quot;_actions&quot;: {},                                         |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;                |
|           |     },                                                        |
|           |     &quot;enablePHP&quot;: true                                         |
|           |   }                                                           |
|           | ]                                                             |
| status    | ready                                                         |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                              |
| updated   | 2015-12-11T13:47:35                                           |
| version   | 1                                                             |
+-----------+---------------------------------------------------------------+
</pre></div>


<p>That's all you need to have up and running a Murano application catalog,
for now there is no rpm package to ease the installation, so you need to
install from source like we done.<br>
A thing you can do, is create systemd files to manage murano services
in a easier way.</p>
<p>Regards, Eduardo Gonzalez</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html">posted at 20:04</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/app.html" class="tags">app</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/application-catalog.html" class="tags">application catalog</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/centos.html" class="tags">centos</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/create.html" class="tags">create</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/deploy.html" class="tags">deploy</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/environment.html" class="tags">environment</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/install.html" class="tags">install</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/liberty.html" class="tags">liberty</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/manual.html" class="tags">manual</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/murano.html" class="tags">murano</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/packstack.html" class="tags">packstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rdo.html" class="tags">rdo</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/red-hat.html" class="tags">red hat</a>
                </div>
		<a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Sep 08, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/ceph-radosgw-admin-ops-how-to-use-it.html" rel="bookmark" title="Permanent Link to &quot;Ceph RadosGW Admin Ops, how to use it&quot;">Ceph RadosGW Admin Ops, how to use it</a>
                </h2>

                
                

                <p>Using RadosGW admin ops for the first time, can be a real headache ,
for this purpose i have made this post, where you will understand how to
use this API.<br>
Let's start:</p>
<p>For issue a request through admin ops, you need to have a signature,
this signature is make it signing a header.<br>
The header must to be composed by the current date, the request
type(GET/PUT/POST/DELETE) and the request itself.<br>
This header must be signed by SSL including the admin ops secret on
this signature.<br>
Now , you can make a request.<br>
Sometimes, the time is not the same as the radosgw node expect, you can
hack on it changing the date=\$(date) value with:<br>
If your host has two hours more than the radosgw node, substract this
two hours under \$(( 10#\$i-2)) variable, where 2 is the two hours to
substract.</p>
<div class="highlight"><pre><span></span><span class="nt">date</span><span class="o">=$(</span><span class="nt">for</span> <span class="nt">i</span> <span class="nt">in</span> <span class="o">$(</span><span class="nt">date</span> <span class="s2">&quot;+%H&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="nt">do</span> <span class="nt">date</span> <span class="s2">&quot;+%a, %d %b %Y $(( 10#$i-2 )):%M:%S +0000&quot;</span> <span class="o">;</span> <span class="nt">done</span><span class="o">)</span>
</pre></div>


<p>Examples:</p>
<p>Create a user named egonzalez:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">token</span><span class="o">=</span>U2JCD4ZG4D1XJOI5XNF4 <span class="c1">## USER_TOKEN</span>
<span class="nv">secret</span><span class="o">=</span>+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b <span class="c1">## USER_SECRET</span>
<span class="nv">query</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">name</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">query3</span><span class="o">=</span><span class="s2">&quot;&amp;uid=&quot;</span>
<span class="nv">query2</span><span class="o">=</span>admin/user
<span class="nv">query4</span><span class="o">=</span><span class="s2">&quot;&amp;quota-type=user&quot;</span>
<span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date<span class="k">)</span>
<span class="nv">header</span><span class="o">=</span><span class="s2">&quot;PUT\n\n\n</span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">\n/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">sig</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -en <span class="si">${</span><span class="nv">header</span><span class="si">}</span> <span class="p">|</span> openssl sha1 -hmac <span class="si">${</span><span class="nv">secret</span><span class="si">}</span> -binary <span class="p">|</span> base64<span class="k">)</span>
curl -v -H <span class="s2">&quot;Date: </span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">&quot;</span> -H <span class="s2">&quot;Authorization: AWS </span><span class="si">${</span><span class="nv">token</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">sig</span><span class="si">}</span><span class="s2">&quot;</span> -L -X PUT <span class="s2">&quot;http://10.0.2.10/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">?format=json</span><span class="si">${</span><span class="nv">query3</span><span class="si">}${</span><span class="nv">query</span><span class="si">}</span><span class="s2">&amp;display-name=</span><span class="si">${</span><span class="nv">name</span><span class="si">}</span><span class="s2">&quot;</span> -H <span class="s2">&quot;Host: 10.0.2.10&quot;</span>
<span class="c1">##Change IPs with your own IPs</span>
</pre></div>
</td></tr></table>

<p>Output:</p>
<div class="highlight"><pre><span></span>[ceph@adminnode scripts]$ sh createUser.sh egonzalez EgonzalezDescription
{&quot;user_id&quot;:&quot;egonzalez&quot;,&quot;display_name&quot;:&quot;EgonzalezDescription&quot;,&quot;email&quot;:&quot;&quot;,&quot;suspended&quot;:0,&quot;max_buckets&quot;:1000,&quot;subusers&quot;:[],&quot;keys&quot;:[{&quot;user&quot;:&quot;egonzalez&quot;,&quot;access_key&quot;:&quot;24FUKCWD6BL9T08DQ2JA&quot;,&quot;secret_key&quot;:&quot;mEQdhcrsqOy7q6Snvu8B5d5A2Ek9OezJH+khwYvX&quot;}],&quot;swift_keys&quot;:[],&quot;caps&quot;:[]}
</pre></div>


<p>See egonzalez quotas</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">token</span><span class="o">=</span>U2JCD4ZG4D1XJOI5XNF4 <span class="c1">## USER_TOKEN</span>
<span class="nv">secret</span><span class="o">=</span>+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b <span class="c1">## USER_SECRET</span>
<span class="nv">query</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">query3</span><span class="o">=</span><span class="s2">&quot;&amp;uid=&quot;</span>
<span class="nv">query2</span><span class="o">=</span>admin/user
<span class="nv">query4</span><span class="o">=</span><span class="s2">&quot;&amp;quota-type=user&quot;</span>
<span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date<span class="k">)</span>
<span class="nv">header</span><span class="o">=</span><span class="s2">&quot;GET\n\n\n</span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">\n/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">sig</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -en <span class="si">${</span><span class="nv">header</span><span class="si">}</span> <span class="p">|</span> openssl sha1 -hmac <span class="si">${</span><span class="nv">secret</span><span class="si">}</span> -binary <span class="p">|</span> base64<span class="k">)</span>
curl -v -H <span class="s2">&quot;Date: </span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">&quot;</span> -H <span class="s2">&quot;Authorization: AWS </span><span class="si">${</span><span class="nv">token</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">sig</span><span class="si">}</span><span class="s2">&quot;</span> -L -X GET <span class="s2">&quot;http://10.0.2.10/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">?quota</span><span class="si">${</span><span class="nv">query3</span><span class="si">}${</span><span class="nv">query</span><span class="si">}</span><span class="s2">&amp;quota-type=user&quot;</span> -H <span class="s2">&quot;Host: 10.0.2.10&quot;</span>
<span class="c1">##Change IPs with your own IPs</span>
</pre></div>
</td></tr></table>

<p>Output:</p>
<div class="highlight"><pre><span></span>[ceph@adminnode scripts]$ sh getuserquota.sh egonzalez

{&quot;enabled&quot;: true,&quot;max_size_kb&quot;:1000,&quot;max_objects&quot;:1000}Status: 200 OK
</pre></div>


<p>See egonzalez user information.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">token</span><span class="o">=</span>U2JCD4ZG4D1XJOI5XNF4 <span class="c1">## USER_TOKEN</span>
<span class="nv">secret</span><span class="o">=</span>+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b <span class="c1">## USER_SECRET</span>
<span class="nv">query</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">query3</span><span class="o">=</span><span class="s2">&quot;&amp;uid=&quot;</span>
<span class="nv">query2</span><span class="o">=</span>admin/user
<span class="nv">date</span><span class="o">=</span><span class="k">$(</span>date<span class="k">)</span>
<span class="nv">header</span><span class="o">=</span><span class="s2">&quot;GET\n\n\n</span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">\n/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">sig</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> -en <span class="si">${</span><span class="nv">header</span><span class="si">}</span> <span class="p">|</span> openssl sha1 -hmac <span class="si">${</span><span class="nv">secret</span><span class="si">}</span> -binary <span class="p">|</span> base64<span class="k">)</span>
curl -v -H <span class="s2">&quot;Date: </span><span class="si">${</span><span class="nv">date</span><span class="si">}</span><span class="s2">&quot;</span> -H <span class="s2">&quot;Authorization: AWS </span><span class="si">${</span><span class="nv">token</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">sig</span><span class="si">}</span><span class="s2">&quot;</span> -L -X GET <span class="s2">&quot;http://10.0.2.10/</span><span class="si">${</span><span class="nv">query2</span><span class="si">}</span><span class="s2">?format=json</span><span class="si">${</span><span class="nv">query3</span><span class="si">}${</span><span class="nv">query</span><span class="si">}</span><span class="s2">&quot;</span> -H <span class="s2">&quot;Host: 10.0.2.10&quot;</span>
<span class="c1">##Change IPs with your own IPs</span>
</pre></div>
</td></tr></table>

<p>Output:</p>
<div class="highlight"><pre><span></span>[ceph@adminnode scripts]$ sh userInfo.sh egonzalez
{&quot;user_id&quot;:&quot;egonzalez&quot;,&quot;display_name&quot;:&quot;EgonzalezDescription&quot;,&quot;email&quot;:&quot;&quot;,&quot;suspended&quot;:0,&quot;max_buckets&quot;:1000,&quot;subusers&quot;:[],&quot;keys&quot;:[{&quot;user&quot;:&quot;egonzalez&quot;,&quot;access_key&quot;:&quot;24FUKCWD6BL9T08DQ2JA&quot;,&quot;secret_key&quot;:&quot;mEQdhcrsqOy7q6Snvu8B5d5A2Ek9OezJH+khwYvX&quot;}],&quot;swift_keys&quot;:[],&quot;caps&quot;:[]}
</pre></div>


<p>When you really understand how admin ops works, is not as dificult to
use it, just search at the official documentation and modify the desired
values.</p>
<p>I hope this helps:</p>
<p>Regards, Eduardo.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/ceph-radosgw-admin-ops-how-to-use-it.html">posted at 13:45</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/admin.html" class="tags">admin</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/admin-ops.html" class="tags">admin ops</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ceph.html" class="tags">ceph</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/header.html" class="tags">header</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ops.html" class="tags">ops</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/query.html" class="tags">query</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/radosgw.html" class="tags">radosgw</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/script.html" class="tags">script</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/sign.html" class="tags">sign</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/understand.html" class="tags">understand</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/usage.html" class="tags">usage</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/user.html" class="tags">user</a>
                </div>
		<a href="https://egonzalez90.github.io/ceph-radosgw-admin-ops-how-to-use-it.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Aug 13, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html" rel="bookmark" title="Permanent Link to &quot;Multiple store locations for Glance images&quot;">Multiple store locations for Glance images</a>
                </h2>

                
                

                <p>In this post i will show you how to add multiple store locations for
glance images.<br>
This will allow you to extend your glance capacity without affect your
current stored images.<br>
The location can be any device or directory mounted at your glance host
as a NFS, a physical hard disk, or an extended partition.<br>
Let's start:</p>
<p>First we need to create the directories where hard disks are going to be
mounted  </p>
<p><code>sudo mkdir /var/lib/glance/lvm-images sudo mkdir /var/lib/glance/extended-images</code></p>
<p>Next, we mount the devices at the directories created in the previous
step</p>
<p><code>sudo mount /dev/sdc1 /var/lib/glance/lvm-images/ sudo mount /dev/sdd1 /var/lib/glance/extended-images/</code></p>
<p>An important step is making the glance user the owner of that
directories</p>
<p><code>chown glance:glance /var/lib/glance/lvm-images/ chown glance:glance /var/lib/glance/extended-images/</code></p>
<p>Once the previous steps has been made, we need to configure the
/etc/glance/glance-api.conf file.<br>
In this file, we're going to configure glance to use multiple
directories to store images.<br>
We search the section "Filesystem Store Options" and modify/create the
following:<br>
We will leave the option "filesystem_store_datadir=" empty, if we
comment this option, glance will use it as default store location and
will show us an error during image creation.<br>
And we add the option "filesystem_store_datadirs", once for any
directory we created in previous steps.<br>
We can use priorities on glance, priority 200 has precedence over
priority 100, if we don't specify any priority, default will be 0</p>
<p><code># ============ Filesystem Store Options ======================== filesystem_store_datadir= filesystem_store_datadirs=/var/lib/glance/images filesystem_store_datadirs=/var/lib/glance/lvm-images:200 filesystem_store_datadirs=/var/lib/glance/extended-images:100</code></p>
<p>Once we have configured glance-api.conf, restart glance-api service</p>
<p><code>systemctl restart openstack-glance-api</code></p>
<p>Now we're going to create an image</p>
<div class="highlight"><pre><span></span>glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress
[=============================&gt;] 100%
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |
| container_format | bare                                 |
| created_at       | 2015-08-13T11:34:00.000000           |
| deleted          | False                                |
| deleted_at       | None                                 |
| disk_format      | qcow2                                |
| id               | 6ac8f5b9-5863-46ca-bb04-db352d35d829 |
| is_public        | False                                |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | CirrosDatadir                        |
| owner            | 738ec25d8b9c41f9b0cf84ce25730e92     |
| protected        | False                                |
| size             | 12506112                             |
| status           | active                               |
| updated_at       | 2015-08-13T11:34:09.000000           |
| virtual_size     | None                                 |
+------------------+--------------------------------------+
</pre></div>


<p>The image has been properly created at glance, we're going to check if
the image has been properly created in the expected location.<br>
As we have configured a priority of 200 on this directory, the image
must be here.</p>
<p><code>ls -lsrt /var/lib/glance/extended-images/ total 12216 12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829</code></p>
<p>We have to keep the store location that we have been using till now, the
images remain available here.</p>
<p><code>ls -lsrt /var/lib/glance/images/ total 12892 12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778</code></p>
<p>Finally we check if the images are in active status</p>
<div class="highlight"><pre><span></span>glance image-list
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| ID                                   | Name           | Disk Format | Container Format | Size     | Status |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros         | qcow2       | bare             | 13200896 | active |
| 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir  | qcow2       | bare             | 12506112 | active |
| 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2       | bare             | 12506112 | active |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
</pre></div>


<p>Regards</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html">posted at 13:37</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/create.html" class="tags">create</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/filesystem_store_datadirs.html" class="tags">filesystem_store_datadirs</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance.html" class="tags">glance</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance-api.html" class="tags">glance-api</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance-apiconf.html" class="tags">glance-api.conf</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/images.html" class="tags">images</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/locations.html" class="tags">locations</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/multiple.html" class="tags">multiple</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/storage.html" class="tags">storage</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/store.html" class="tags">store</a>
                </div>
		<a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/6" class="prev_page">&larr;&nbsp;Previous</a>
                    <a href="https://egonzalez90.github.io/page/8" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 7 of 34</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>