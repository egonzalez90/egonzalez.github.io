<!DOCTYPE html>
<html lang="en-US">

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <meta name="description" content="OpenStack things : OpenStack, Docker, Ansible, Ceph, Linux">

    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=9a6333a51cf04996f04338046deefb14dd69cda4">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>To Conditional or To Skip, that is the Ansible question | OpenStack things</title>
<meta property="og:title" content="To Conditional or To Skip, that is the Ansible question">
<meta name="author" content="Editor">
<meta property="og:locale" content="en_US">
<meta name="description" content='Have you ever think about if an Ansible task should be skipped with a conditional or without (hidden skip)?. Well, this post will analyse both methods. Let’s use a example to create the same result and analyse the both methods: In OpenStack Kolla we found that sometimes operators need to customise policy.json files. That’s fine, but the problem is that policy.json files are installed with the services by default and we don’t need/want to maintain policy.json files in our repository because for sure will cause bugs from outdated policy files in the future. What’s the proposed solution to this? Allow operators use their own policy files only when their files exists in a custom configuration folder. If custom files are not present, default policy.json files are already present as part of the software installation. ( Actually this change is under review ) To Conditional method Code snippet: - name: Check if file exists stat: path: "/tmp/custom_file.json" register: check_custom_file_exist - name: Copy custom policy when exist template: src: "/tmp/custom_file.json" dest: "/tmp/destination_file.json" when: "" The first task checks if the file is present and register the stat result. The second task, copy the file only when the registered result of the previous task is True. (exists == True) Outputs the following when the file is not present: PLAY [localhost] *************************************************************** TASK [Check if file exists] **************************************************** ok: [localhost] TASK [Copy custom policy when exist] ******************************************* skipping: [localhost] PLAY RECAP ********************************************************************* localhost : ok=1 changed=0 unreachable=0 failed=0 We can see the copy file task is skipped with a skipping message. To Skip method Code snippet: - name: Copy custom policy when exist template: src: "" dest: "/tmp/destination_file.json" with_first_found: - files: - custom_file.json skip: True This playbook contains a single task, this task will use the first found file in a list of files. If no file is present will skip the task. Output from this execution: PLAY [localhost] *************************************************************** TASK [Copy custom policy when exist] ******************************************* PLAY RECAP ********************************************************************* localhost : ok=0 changed=0 unreachable=0 failed=0 We can see that no task is executed when custom files are not present, no output from the task (hidden skip). Analysis and own opinion Both methods do the same, both copy custom files when are present and both skip copy task when are not present. What are the differences between both methods? To_skip method is simpler to read and unified in a single task, to_conditional is created within two tasks. To_conditional method takes longer to be executed as it has to check the existence of a file and then evaluate a conditional. You may think that to_skip method is better than to_conditional method, that’s right in terms of code syntax and execution times. But… As both, operator and infrastructure developer, I always use to_conditional method because when I’m deploying something new, I want to know what is executed and what not. In to_skip method you don’t know because there is no output provided from the task(not really true) but in to_conditional method it clearly says Skipping. Execution times are not a problem in most use cases, as is not commonly used this kind of tasks in CM systems, only a few tasks will need this type of logic. Regards, Eduardo Gonzalez'>
<meta property="og:description" content='Have you ever think about if an Ansible task should be skipped with a conditional or without (hidden skip)?. Well, this post will analyse both methods. Let’s use a example to create the same result and analyse the both methods: In OpenStack Kolla we found that sometimes operators need to customise policy.json files. That’s fine, but the problem is that policy.json files are installed with the services by default and we don’t need/want to maintain policy.json files in our repository because for sure will cause bugs from outdated policy files in the future. What’s the proposed solution to this? Allow operators use their own policy files only when their files exists in a custom configuration folder. If custom files are not present, default policy.json files are already present as part of the software installation. ( Actually this change is under review ) To Conditional method Code snippet: - name: Check if file exists stat: path: "/tmp/custom_file.json" register: check_custom_file_exist - name: Copy custom policy when exist template: src: "/tmp/custom_file.json" dest: "/tmp/destination_file.json" when: "" The first task checks if the file is present and register the stat result. The second task, copy the file only when the registered result of the previous task is True. (exists == True) Outputs the following when the file is not present: PLAY [localhost] *************************************************************** TASK [Check if file exists] **************************************************** ok: [localhost] TASK [Copy custom policy when exist] ******************************************* skipping: [localhost] PLAY RECAP ********************************************************************* localhost : ok=1 changed=0 unreachable=0 failed=0 We can see the copy file task is skipped with a skipping message. To Skip method Code snippet: - name: Copy custom policy when exist template: src: "" dest: "/tmp/destination_file.json" with_first_found: - files: - custom_file.json skip: True This playbook contains a single task, this task will use the first found file in a list of files. If no file is present will skip the task. Output from this execution: PLAY [localhost] *************************************************************** TASK [Copy custom policy when exist] ******************************************* PLAY RECAP ********************************************************************* localhost : ok=0 changed=0 unreachable=0 failed=0 We can see that no task is executed when custom files are not present, no output from the task (hidden skip). Analysis and own opinion Both methods do the same, both copy custom files when are present and both skip copy task when are not present. What are the differences between both methods? To_skip method is simpler to read and unified in a single task, to_conditional is created within two tasks. To_conditional method takes longer to be executed as it has to check the existence of a file and then evaluate a conditional. You may think that to_skip method is better than to_conditional method, that’s right in terms of code syntax and execution times. But… As both, operator and infrastructure developer, I always use to_conditional method because when I’m deploying something new, I want to know what is executed and what not. In to_skip method you don’t know because there is no output provided from the task(not really true) but in to_conditional method it clearly says Skipping. Execution times are not a problem in most use cases, as is not commonly used this kind of tasks in CM systems, only a few tasks will need this type of logic. Regards, Eduardo Gonzalez'>
<link rel="canonical" href="http://217.182.136.201:5000/to-conditional-or-to-skip-that-is-the-ansible-question/">
<meta property="og:url" content="http://217.182.136.201:5000/to-conditional-or-to-skip-that-is-the-ansible-question/">
<meta property="og:site_name" content="OpenStack things">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-10-31T20:49:37+00:00">
<script type="application/ld+json">
{"name":null,"description":"Have you ever think about if an Ansible task should be skipped with a conditional or without (hidden skip)?. Well, this post will analyse both methods. Let’s use a example to create the same result and analyse the both methods: In OpenStack Kolla we found that sometimes operators need to customise policy.json files. That’s fine, but the problem is that policy.json files are installed with the services by default and we don’t need/want to maintain policy.json files in our repository because for sure will cause bugs from outdated policy files in the future. What’s the proposed solution to this? Allow operators use their own policy files only when their files exists in a custom configuration folder. If custom files are not present, default policy.json files are already present as part of the software installation. ( Actually this change is under review ) To Conditional method Code snippet: - name: Check if file exists stat: path: &quot;/tmp/custom_file.json&quot; register: check_custom_file_exist - name: Copy custom policy when exist template: src: &quot;/tmp/custom_file.json&quot; dest: &quot;/tmp/destination_file.json&quot; when: &quot;&quot; The first task checks if the file is present and register the stat result. The second task, copy the file only when the registered result of the previous task is True. (exists == True) Outputs the following when the file is not present: PLAY [localhost] *************************************************************** TASK [Check if file exists] **************************************************** ok: [localhost] TASK [Copy custom policy when exist] ******************************************* skipping: [localhost] PLAY RECAP ********************************************************************* localhost : ok=1 changed=0 unreachable=0 failed=0 We can see the copy file task is skipped with a skipping message. To Skip method Code snippet: - name: Copy custom policy when exist template: src: &quot;&quot; dest: &quot;/tmp/destination_file.json&quot; with_first_found: - files: - custom_file.json skip: True This playbook contains a single task, this task will use the first found file in a list of files. If no file is present will skip the task. Output from this execution: PLAY [localhost] *************************************************************** TASK [Copy custom policy when exist] ******************************************* PLAY RECAP ********************************************************************* localhost : ok=0 changed=0 unreachable=0 failed=0 We can see that no task is executed when custom files are not present, no output from the task (hidden skip). Analysis and own opinion Both methods do the same, both copy custom files when are present and both skip copy task when are not present. What are the differences between both methods? To_skip method is simpler to read and unified in a single task, to_conditional is created within two tasks. To_conditional method takes longer to be executed as it has to check the existence of a file and then evaluate a conditional. You may think that to_skip method is better than to_conditional method, that’s right in terms of code syntax and execution times. But… As both, operator and infrastructure developer, I always use to_conditional method because when I’m deploying something new, I want to know what is executed and what not. In to_skip method you don’t know because there is no output provided from the task(not really true) but in to_conditional method it clearly says Skipping. Execution times are not a problem in most use cases, as is not commonly used this kind of tasks in CM systems, only a few tasks will need this type of logic. Regards, Eduardo Gonzalez","author":{"@type":"Person","name":"Editor"},"@type":"BlogPosting","url":"http://217.182.136.201:5000/to-conditional-or-to-skip-that-is-the-ansible-question/","publisher":null,"image":null,"headline":"To Conditional or To Skip, that is the Ansible question","dateModified":"2016-10-31T20:49:37+00:00","datePublished":"2016-10-31T20:49:37+00:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://217.182.136.201:5000/to-conditional-or-to-skip-that-is-the-ansible-question/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="http://github.com/egonzalez90/egonzalez90.github.io">View on GitHub</a>

          <h1 id="project_title">OpenStack things</h1>
          <h2 id="project_tagline">OpenStack, Docker, Ansible, Ceph, Linux</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Have you ever think about if an Ansible task should be skipped with a conditional or without (hidden skip)?.
Well, this post will analyse both methods.</p>

<p>Let’s use a example to create the same result and analyse the both methods:</p>

<p>In OpenStack Kolla we found that sometimes operators need to customise policy.json files. That’s fine, but the problem is that policy.json files are installed with the services by default and we don’t need/want to maintain policy.json files in our repository because for sure will cause bugs from outdated policy files in the future.</p>

<p>What’s the proposed solution to this? Allow operators use their own policy files only when their files exists in a custom configuration folder. If custom files are not present, default policy.json files are already present as part of the software installation. ( Actually this change is under review )</p>
<h2>To Conditional method</h2>
<p>Code snippet:</p>
<pre>  - name: Check if file exists
    stat:
      path: "/tmp/custom_file.json"
    register: check_custom_file_exist

  - name: Copy custom policy when exist
    template:
      src: "/tmp/custom_file.json"
      dest: "/tmp/destination_file.json"
    when: ""
</pre>
<p>The first task checks if the file is present and register the stat result.
The second task, copy the file only when the registered result of the previous task is True. (exists == True)</p>

<p>Outputs the following when the file is not present:</p>
<pre>PLAY [localhost] ***************************************************************

TASK [Check if file exists] ****************************************************
ok: [localhost]

TASK [Copy custom policy when exist] *******************************************
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=1    changed=0    unreachable=0    failed=0  
</pre>
<p>We can see the copy file task is skipped with a skipping message.</p>
<h2>To Skip method</h2>
<p>Code snippet:</p>
<pre>  - name: Copy custom policy when exist
    template:
      src: ""
      dest: "/tmp/destination_file.json"
    with_first_found:
    - files:
      - custom_file.json
      skip: True
</pre>
<p>This playbook contains a single task, this task will use the first found file in a list of files. If no file is present will skip the task.</p>

<p>Output from this execution:</p>
<pre>PLAY [localhost] ***************************************************************

TASK [Copy custom policy when exist] *******************************************

PLAY RECAP *********************************************************************
localhost                  : ok=0    changed=0    unreachable=0    failed=0 
</pre>
<p>We can see that no task is executed when custom files are not present, no output from the task (hidden skip).</p>
<h2>Analysis and own opinion</h2>
<p>Both methods do the same, both copy custom files when are present and both skip copy task when are not present.
What are the differences between both methods?</p>

<p>To_skip method is simpler to read and unified in a single task, to_conditional is created within two tasks.
To_conditional method takes longer to be executed as it has to check the existence of a file and then evaluate a conditional.</p>

<p>You may think that to_skip method is better than to_conditional method, that’s right in terms of code syntax and execution times. But…
As both, operator and infrastructure developer, I always use to_conditional method because when I’m deploying something new, I want to know what is executed and what not. In to_skip method you don’t know because there is no output provided from the task(not really true) but in to_conditional method it clearly says Skipping.</p>

<p>Execution times are not a problem in most use cases, as is not commonly used this kind of tasks in CM systems, only a few tasks will need this type of logic.</p>

<p>Regards, Eduardo Gonzalez</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">OpenStack things maintained by <a href="http://github.com/egonzalez90">egonzalez90</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = 'https://egonzalez-1.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</html>
