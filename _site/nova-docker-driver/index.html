<!DOCTYPE html>
<html lang="en-US">

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <meta name="description" content="OpenStack things : OpenStack, Docker, Ansible, Ceph, Linux">

    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=9a6333a51cf04996f04338046deefb14dd69cda4">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Nova Docker driver | OpenStack things</title>
<meta property="og:title" content="Nova Docker driver">
<meta name="author" content="Editor">
<meta property="og:locale" content="en_US">
<meta name="description" content="Cloud computing has evolved too fast over the last years, currently is a totally different thing as the 5 years ago cloud, today is a common thing listening words like containers, instances, microservices, queue messages on linkedin, twitter, etc. OpenStack is not a lazy community, new capabilities are daily added to the OpenStack catalog reaching more users and business needs who are discovered at the several summits and meetups over the world. One of that needs is the capability to easy create and manage docker containers. Now we have two main methods, directly launching instances as containers from nova driver or with heat/kubernetes/messos. The second method is the one with more followers, but there are some projects which are using nova driver as Solum, for this reason i’m going to show you how to configure docker as nova driver. The fist step is install docker on the compute nodes curl -sSL https://get.docker.com/ | sh + sh -c 'sleep 3; yum -y -q install docker-engine' advertencia:/var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm: EncabezadoV4 RSA/SHA512 Signature, ID de clave 2c52609d: NOKEY No se ha instalado la llave pública de docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm Importando llave GPG 0x2C52609D: Usuarioid  : &quot;Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;&quot; Huella       : 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d Desde      : https://yum.dockerproject.org/gpg Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Add nova user to docker group, docker group will be created during docker installation usermod -aG docker nova Start docker service sudo systemctl start docker Test docker installation with the following command, a Hello from Docker message should be prompted sudo docker run hello-world Unable to find image 'hello-world:latest' locally latest: Pulling from library/hello-world b901d36b6f2f: Pull complete 0a6ba66e537a: Pull complete Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7 Status: Downloaded newer image for hello-world:latest Hello from Docker. This message shows that your installation appears to be working correctly. Once docker runs in a proper way, enable docker service at boot sudo systemctl enable docker ln -s '/usr/lib/systemd/system/docker.service' '/etc/systemd/system/multi-user.target.wants/docker.service' Give docker socket the apropiate permissions chmod 666  /var/run/docker.sock Restart nova-compute service systemctl restart openstack-nova-compute Install git and pip if not present on the system sudo yum install -y git sudo easy_install pip Clone docker driver for nova from OpenStack repositories git clone -b stable/liberty https://github.com/openstack/nova-docker Install basic requirements cd nova-docker sudo  pip install -r requirements.txt Install docker driver python setup.py install Edit nova.conf and allow docker driver as compute driver vi /etc/nova/nova.conf compute_driver=novadocker.virt.docker.DockerDriver Create the following directory mkdir /etc/nova/rootwrap.d Create a file with the following content to allow setting networking in docker containers vi /etc/nova/rootwrap.d/docker.filters [Filters] # nova/virt/docker/driver.py: 'ln', '-sf', '/var/run/netns/.*' ln: CommandFilter, /bin/ln, root Edit glance-api.conf and allow docker as container format vi /etc/glance/glance-api.conf container_formats=ami,ari,aki,bare,ovf,ova,docker Restart glance-api to apply changes systemctl restart openstack-glance-api Pull a docker image, i use hipache as testing image docker pull hipache Using default tag: latest latest: Pulling from library/hipache 0a85502c06c9: Pull complete 0998bf8fb9e9: Pull complete a6785352b25c: Pull complete e9ae3c220b23: Pull complete 84d61e35041c: Pull complete 0fd25fcc737a: Pull complete c0af65e2f918: Pull complete dc335e9e58f4: Pull complete 7245129ed8a4: Pull complete 52a015bc8761: Pull complete d38065541924: Pull complete 0b8658d6c429: Pull complete 188468e0ae8d: Pull complete 741abf992884: Pull complete Digest: sha256:7774cf9155a8cc83b6964c7ea0d655143c152debc6d11d4f6dfa918c7a7ea099 Status: Downloaded newer image for hipache:latest Upload the image to glance docker save hipache | openstack image create hipache --public --container-format docker --disk-format raw +------------------+------------------------------------------------------+ | Field            | Value                                                | +------------------+------------------------------------------------------+ | checksum         | e93b7c1ddeb2d38419bf44aaf07cc811                     | | container_format | docker                                               | | created_at       | 2015-12-18T10:06:31Z                                 | | disk_format      | raw                                                  | | file             | /v2/images/7f05f7d6-88af-4d0f-adad-66ca025404fa/file | | id               | 7f05f7d6-88af-4d0f-adad-66ca025404fa                 | | min_disk         | 0                                                    | | min_ram          | 0                                                    | | name             | hipache                                              | | owner            | 74675bfffc3c4e1a9d9fb2f1388217d4                     | | protected        | False                                                | | schema           | /v2/schemas/image                                    | | size             | 384304640                                            | | status           | active                                               | | updated_at       | 2015-12-18T10:07:03Z                                 | | virtual_size     | None                                                 | | visibility       | public                                               | +------------------+------------------------------------------------------+ Once the image is active at glance, create a new instance, the instance won’t be a KVM virtual machine, now will be a docker container nova boot --flavor m1.tiny --image hipache --nic net-id=a1aa6336-9ae2-4ffb-99f5-1b6d1130989c --key-name mykey test1 After a while, the instance should be in ACTIVE state watch nova list +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | ID                                   | Name  | Status | Task State | Power State | Networks                    | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | fb192405-4150-4c2d-98ad-316141f48cc5 | test1 | ACTIVE | -          | Running     | private_network=192.168.1.3 | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ If all the steps worked fine, you can use docker as nova backend. Regards">
<meta property="og:description" content="Cloud computing has evolved too fast over the last years, currently is a totally different thing as the 5 years ago cloud, today is a common thing listening words like containers, instances, microservices, queue messages on linkedin, twitter, etc. OpenStack is not a lazy community, new capabilities are daily added to the OpenStack catalog reaching more users and business needs who are discovered at the several summits and meetups over the world. One of that needs is the capability to easy create and manage docker containers. Now we have two main methods, directly launching instances as containers from nova driver or with heat/kubernetes/messos. The second method is the one with more followers, but there are some projects which are using nova driver as Solum, for this reason i’m going to show you how to configure docker as nova driver. The fist step is install docker on the compute nodes curl -sSL https://get.docker.com/ | sh + sh -c 'sleep 3; yum -y -q install docker-engine' advertencia:/var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm: EncabezadoV4 RSA/SHA512 Signature, ID de clave 2c52609d: NOKEY No se ha instalado la llave pública de docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm Importando llave GPG 0x2C52609D: Usuarioid  : &quot;Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;&quot; Huella       : 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d Desde      : https://yum.dockerproject.org/gpg Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Add nova user to docker group, docker group will be created during docker installation usermod -aG docker nova Start docker service sudo systemctl start docker Test docker installation with the following command, a Hello from Docker message should be prompted sudo docker run hello-world Unable to find image 'hello-world:latest' locally latest: Pulling from library/hello-world b901d36b6f2f: Pull complete 0a6ba66e537a: Pull complete Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7 Status: Downloaded newer image for hello-world:latest Hello from Docker. This message shows that your installation appears to be working correctly. Once docker runs in a proper way, enable docker service at boot sudo systemctl enable docker ln -s '/usr/lib/systemd/system/docker.service' '/etc/systemd/system/multi-user.target.wants/docker.service' Give docker socket the apropiate permissions chmod 666  /var/run/docker.sock Restart nova-compute service systemctl restart openstack-nova-compute Install git and pip if not present on the system sudo yum install -y git sudo easy_install pip Clone docker driver for nova from OpenStack repositories git clone -b stable/liberty https://github.com/openstack/nova-docker Install basic requirements cd nova-docker sudo  pip install -r requirements.txt Install docker driver python setup.py install Edit nova.conf and allow docker driver as compute driver vi /etc/nova/nova.conf compute_driver=novadocker.virt.docker.DockerDriver Create the following directory mkdir /etc/nova/rootwrap.d Create a file with the following content to allow setting networking in docker containers vi /etc/nova/rootwrap.d/docker.filters [Filters] # nova/virt/docker/driver.py: 'ln', '-sf', '/var/run/netns/.*' ln: CommandFilter, /bin/ln, root Edit glance-api.conf and allow docker as container format vi /etc/glance/glance-api.conf container_formats=ami,ari,aki,bare,ovf,ova,docker Restart glance-api to apply changes systemctl restart openstack-glance-api Pull a docker image, i use hipache as testing image docker pull hipache Using default tag: latest latest: Pulling from library/hipache 0a85502c06c9: Pull complete 0998bf8fb9e9: Pull complete a6785352b25c: Pull complete e9ae3c220b23: Pull complete 84d61e35041c: Pull complete 0fd25fcc737a: Pull complete c0af65e2f918: Pull complete dc335e9e58f4: Pull complete 7245129ed8a4: Pull complete 52a015bc8761: Pull complete d38065541924: Pull complete 0b8658d6c429: Pull complete 188468e0ae8d: Pull complete 741abf992884: Pull complete Digest: sha256:7774cf9155a8cc83b6964c7ea0d655143c152debc6d11d4f6dfa918c7a7ea099 Status: Downloaded newer image for hipache:latest Upload the image to glance docker save hipache | openstack image create hipache --public --container-format docker --disk-format raw +------------------+------------------------------------------------------+ | Field            | Value                                                | +------------------+------------------------------------------------------+ | checksum         | e93b7c1ddeb2d38419bf44aaf07cc811                     | | container_format | docker                                               | | created_at       | 2015-12-18T10:06:31Z                                 | | disk_format      | raw                                                  | | file             | /v2/images/7f05f7d6-88af-4d0f-adad-66ca025404fa/file | | id               | 7f05f7d6-88af-4d0f-adad-66ca025404fa                 | | min_disk         | 0                                                    | | min_ram          | 0                                                    | | name             | hipache                                              | | owner            | 74675bfffc3c4e1a9d9fb2f1388217d4                     | | protected        | False                                                | | schema           | /v2/schemas/image                                    | | size             | 384304640                                            | | status           | active                                               | | updated_at       | 2015-12-18T10:07:03Z                                 | | virtual_size     | None                                                 | | visibility       | public                                               | +------------------+------------------------------------------------------+ Once the image is active at glance, create a new instance, the instance won’t be a KVM virtual machine, now will be a docker container nova boot --flavor m1.tiny --image hipache --nic net-id=a1aa6336-9ae2-4ffb-99f5-1b6d1130989c --key-name mykey test1 After a while, the instance should be in ACTIVE state watch nova list +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | ID                                   | Name  | Status | Task State | Power State | Networks                    | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | fb192405-4150-4c2d-98ad-316141f48cc5 | test1 | ACTIVE | -          | Running     | private_network=192.168.1.3 | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ If all the steps worked fine, you can use docker as nova backend. Regards">
<link rel="canonical" href="http://217.182.136.201:5000/nova-docker-driver/">
<meta property="og:url" content="http://217.182.136.201:5000/nova-docker-driver/">
<meta property="og:site_name" content="OpenStack things">
<meta property="og:image" content="http://217.182.136.201:5000/wp-content/uploads/2015/09/learn-about-openstack-badge.png">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-12-23T18:31:44+00:00">
<script type="application/ld+json">
{"name":null,"description":"Cloud computing has evolved too fast over the last years, currently is a totally different thing as the 5 years ago cloud, today is a common thing listening words like containers, instances, microservices, queue messages on linkedin, twitter, etc. OpenStack is not a lazy community, new capabilities are daily added to the OpenStack catalog reaching more users and business needs who are discovered at the several summits and meetups over the world. One of that needs is the capability to easy create and manage docker containers. Now we have two main methods, directly launching instances as containers from nova driver or with heat/kubernetes/messos. The second method is the one with more followers, but there are some projects which are using nova driver as Solum, for this reason i’m going to show you how to configure docker as nova driver. The fist step is install docker on the compute nodes curl -sSL https://get.docker.com/ | sh + sh -c &#39;sleep 3; yum -y -q install docker-engine&#39; advertencia:/var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm: EncabezadoV4 RSA/SHA512 Signature, ID de clave 2c52609d: NOKEY No se ha instalado la llave pública de docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm Importando llave GPG 0x2C52609D: Usuarioid  : &quot;Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;&quot; Huella       : 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d Desde      : https://yum.dockerproject.org/gpg Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532228]. Full path required for exclude: net:[4026532285]. Full path required for exclude: net:[4026532285]. Add nova user to docker group, docker group will be created during docker installation usermod -aG docker nova Start docker service sudo systemctl start docker Test docker installation with the following command, a Hello from Docker message should be prompted sudo docker run hello-world Unable to find image &#39;hello-world:latest&#39; locally latest: Pulling from library/hello-world b901d36b6f2f: Pull complete 0a6ba66e537a: Pull complete Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7 Status: Downloaded newer image for hello-world:latest Hello from Docker. This message shows that your installation appears to be working correctly. Once docker runs in a proper way, enable docker service at boot sudo systemctl enable docker ln -s &#39;/usr/lib/systemd/system/docker.service&#39; &#39;/etc/systemd/system/multi-user.target.wants/docker.service&#39; Give docker socket the apropiate permissions chmod 666  /var/run/docker.sock Restart nova-compute service systemctl restart openstack-nova-compute Install git and pip if not present on the system sudo yum install -y git sudo easy_install pip Clone docker driver for nova from OpenStack repositories git clone -b stable/liberty https://github.com/openstack/nova-docker Install basic requirements cd nova-docker sudo  pip install -r requirements.txt Install docker driver python setup.py install Edit nova.conf and allow docker driver as compute driver vi /etc/nova/nova.conf compute_driver=novadocker.virt.docker.DockerDriver Create the following directory mkdir /etc/nova/rootwrap.d Create a file with the following content to allow setting networking in docker containers vi /etc/nova/rootwrap.d/docker.filters [Filters] # nova/virt/docker/driver.py: &#39;ln&#39;, &#39;-sf&#39;, &#39;/var/run/netns/.*&#39; ln: CommandFilter, /bin/ln, root Edit glance-api.conf and allow docker as container format vi /etc/glance/glance-api.conf container_formats=ami,ari,aki,bare,ovf,ova,docker Restart glance-api to apply changes systemctl restart openstack-glance-api Pull a docker image, i use hipache as testing image docker pull hipache Using default tag: latest latest: Pulling from library/hipache 0a85502c06c9: Pull complete 0998bf8fb9e9: Pull complete a6785352b25c: Pull complete e9ae3c220b23: Pull complete 84d61e35041c: Pull complete 0fd25fcc737a: Pull complete c0af65e2f918: Pull complete dc335e9e58f4: Pull complete 7245129ed8a4: Pull complete 52a015bc8761: Pull complete d38065541924: Pull complete 0b8658d6c429: Pull complete 188468e0ae8d: Pull complete 741abf992884: Pull complete Digest: sha256:7774cf9155a8cc83b6964c7ea0d655143c152debc6d11d4f6dfa918c7a7ea099 Status: Downloaded newer image for hipache:latest Upload the image to glance docker save hipache | openstack image create hipache --public --container-format docker --disk-format raw +------------------+------------------------------------------------------+ | Field            | Value                                                | +------------------+------------------------------------------------------+ | checksum         | e93b7c1ddeb2d38419bf44aaf07cc811                     | | container_format | docker                                               | | created_at       | 2015-12-18T10:06:31Z                                 | | disk_format      | raw                                                  | | file             | /v2/images/7f05f7d6-88af-4d0f-adad-66ca025404fa/file | | id               | 7f05f7d6-88af-4d0f-adad-66ca025404fa                 | | min_disk         | 0                                                    | | min_ram          | 0                                                    | | name             | hipache                                              | | owner            | 74675bfffc3c4e1a9d9fb2f1388217d4                     | | protected        | False                                                | | schema           | /v2/schemas/image                                    | | size             | 384304640                                            | | status           | active                                               | | updated_at       | 2015-12-18T10:07:03Z                                 | | virtual_size     | None                                                 | | visibility       | public                                               | +------------------+------------------------------------------------------+ Once the image is active at glance, create a new instance, the instance won’t be a KVM virtual machine, now will be a docker container nova boot --flavor m1.tiny --image hipache --nic net-id=a1aa6336-9ae2-4ffb-99f5-1b6d1130989c --key-name mykey test1 After a while, the instance should be in ACTIVE state watch nova list +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | ID                                   | Name  | Status | Task State | Power State | Networks                    | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ | fb192405-4150-4c2d-98ad-316141f48cc5 | test1 | ACTIVE | -          | Running     | private_network=192.168.1.3 | +--------------------------------------+-------+--------+------------+-------------+-----------------------------+ If all the steps worked fine, you can use docker as nova backend. Regards","author":{"@type":"Person","name":"Editor"},"@type":"BlogPosting","url":"http://217.182.136.201:5000/nova-docker-driver/","publisher":null,"image":"http://217.182.136.201:5000/wp-content/uploads/2015/09/learn-about-openstack-badge.png","headline":"Nova Docker driver","dateModified":"2015-12-23T18:31:44+00:00","datePublished":"2015-12-23T18:31:44+00:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://217.182.136.201:5000/nova-docker-driver/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="http://github.com/egonzalez90/egonzalez90.github.io">View on GitHub</a>

          <h1 id="project_title">OpenStack things</h1>
          <h2 id="project_tagline">OpenStack, Docker, Ansible, Ceph, Linux</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Cloud computing has evolved too fast over the last years, currently is a totally different thing as the 5 years ago cloud, today is a common thing listening words like containers, instances, microservices, queue messages on linkedin, twitter, etc.</p>

<p>OpenStack is not a lazy community, new capabilities are daily added to the OpenStack catalog reaching more users and business needs who are discovered at the several summits and meetups over the world. One of that needs is the capability to easy create and manage docker containers.
Now we have two main methods, directly launching instances as containers from nova driver or with heat/kubernetes/messos.
The second method is the one with more followers, but there are some projects which are using nova driver as Solum, for this reason i’m going to show you how to configure docker as nova driver.</p>

<p>The fist step is install docker on the compute nodes</p>
<pre>
curl -sSL https://get.docker.com/ | sh

+ sh -c 'sleep 3; yum -y -q install docker-engine'
advertencia:/var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm: EncabezadoV4 RSA/SHA512 Signature, ID de clave 2c52609d: NOKEY
No se ha instalado la llave pública de docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm
Importando llave GPG 0x2C52609D:
Usuarioid  : "Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;"
Huella       : 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d
Desde      : https://yum.dockerproject.org/gpg
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532285].
</pre>
<p>Add nova user to docker group, docker group will be created during docker installation</p>
<pre>
usermod -aG docker nova
</pre>
<p>Start docker service</p>
<pre>
sudo systemctl start docker
</pre>
<p>Test docker installation with the following command, a Hello from Docker message should be prompted</p>
<pre>
sudo docker run hello-world

Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
b901d36b6f2f: Pull complete
0a6ba66e537a: Pull complete
Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7
Status: Downloaded newer image for hello-world:latest

Hello from Docker.
This message shows that your installation appears to be working correctly.
</pre>
<p>Once docker runs in a proper way, enable docker service at boot</p>
<pre>
sudo systemctl enable docker
ln -s '/usr/lib/systemd/system/docker.service' '/etc/systemd/system/multi-user.target.wants/docker.service'
</pre>
<p>Give docker socket the apropiate permissions</p>
<pre>
chmod 666  /var/run/docker.sock
</pre>
<p>Restart nova-compute service</p>
<pre>
systemctl restart openstack-nova-compute
</pre>
<p>Install git and pip if not present on the system</p>
<pre>
sudo yum install -y git
sudo easy_install pip
</pre>
<p>Clone docker driver for nova from OpenStack repositories</p>
<pre>
git clone -b stable/liberty https://github.com/openstack/nova-docker
</pre>
<p>Install basic requirements</p>
<pre>
cd nova-docker
sudo  pip install -r requirements.txt
</pre>
<p>Install docker driver</p>
<pre>
python setup.py install
</pre>
<p>Edit nova.conf and allow docker driver as compute driver</p>
<pre>
vi /etc/nova/nova.conf
compute_driver=novadocker.virt.docker.DockerDriver
</pre>
<p>Create the following directory</p>
<pre>
mkdir /etc/nova/rootwrap.d
</pre>
<p>Create a file with the following content to allow setting networking in docker containers</p>
<pre>
vi /etc/nova/rootwrap.d/docker.filters

[Filters]
# nova/virt/docker/driver.py: 'ln', '-sf', '/var/run/netns/.*'
ln: CommandFilter, /bin/ln, root
</pre>
<p>Edit glance-api.conf and allow docker as container format</p>
<pre>
vi /etc/glance/glance-api.conf
container_formats=ami,ari,aki,bare,ovf,ova,docker
</pre>
<p>Restart glance-api to apply changes</p>
<pre>
systemctl restart openstack-glance-api
</pre>
<p>Pull a docker image, i use hipache as testing image</p>
<pre>
docker pull hipache

Using default tag: latest
latest: Pulling from library/hipache
0a85502c06c9: Pull complete
0998bf8fb9e9: Pull complete
a6785352b25c: Pull complete
e9ae3c220b23: Pull complete
84d61e35041c: Pull complete
0fd25fcc737a: Pull complete
c0af65e2f918: Pull complete
dc335e9e58f4: Pull complete
7245129ed8a4: Pull complete
52a015bc8761: Pull complete
d38065541924: Pull complete
0b8658d6c429: Pull complete
188468e0ae8d: Pull complete
741abf992884: Pull complete
Digest: sha256:7774cf9155a8cc83b6964c7ea0d655143c152debc6d11d4f6dfa918c7a7ea099
Status: Downloaded newer image for hipache:latest
</pre>
<p>Upload the image to glance</p>
<pre>
docker save hipache | openstack image create hipache --public --container-format docker --disk-format raw

+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | e93b7c1ddeb2d38419bf44aaf07cc811                     |
| container_format | docker                                               |
| created_at       | 2015-12-18T10:06:31Z                                 |
| disk_format      | raw                                                  |
| file             | /v2/images/7f05f7d6-88af-4d0f-adad-66ca025404fa/file |
| id               | 7f05f7d6-88af-4d0f-adad-66ca025404fa                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | hipache                                              |
| owner            | 74675bfffc3c4e1a9d9fb2f1388217d4                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 384304640                                            |
| status           | active                                               |
| updated_at       | 2015-12-18T10:07:03Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+
</pre>
<p>Once the image is active at glance, create a new instance, the instance won’t be a KVM virtual machine, now will be a docker container</p>
<pre>
nova boot --flavor m1.tiny --image hipache --nic net-id=a1aa6336-9ae2-4ffb-99f5-1b6d1130989c --key-name mykey test1
</pre>
<p>After a while, the instance should be in ACTIVE state</p>
<pre>
watch nova list
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
| ID                                   | Name  | Status | Task State | Power State | Networks                    |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
| fb192405-4150-4c2d-98ad-316141f48cc5 | test1 | ACTIVE | -          | Running     | private_network=192.168.1.3 |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
</pre>
<p>If all the steps worked fine, you can use docker as nova backend.
Regards</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">OpenStack things maintained by <a href="http://github.com/egonzalez90">egonzalez90</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = 'https://egonzalez-1.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</html>
