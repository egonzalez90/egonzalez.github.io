<!DOCTYPE html>
<html lang="en-US">

  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <meta name="description" content="OpenStack things : OpenStack, Docker, Ansible, Ceph, Linux">

    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=9a6333a51cf04996f04338046deefb14dd69cda4">

<!-- Begin Jekyll SEO tag v2.3.0 -->
<title>Multiple store locations for Glance images | OpenStack things</title>
<meta property="og:title" content="Multiple store locations for Glance images">
<meta name="author" content="Editor">
<meta property="og:locale" content="en_US">
<meta name="description" content="&lt;/br&gt; In this post i will show you how to add multiple store locations for glance images. This will allow you to extend your glance capacity without affect your current stored images. The location can be any device or directory mounted at your glance host as a NFS, a physical hard disk, or an extended partition. Let’s start: First we need to create the directories where hard disks are going to be mounted sudo mkdir /var/lib/glance/lvm-images sudo mkdir /var/lib/glance/extended-images Next, we mount the devices at the directories created in the previous step sudo mount /dev/sdc1 /var/lib/glance/lvm-images/ sudo mount /dev/sdd1 /var/lib/glance/extended-images/ An important step is making the glance user the owner of that directories chown glance:glance /var/lib/glance/lvm-images/ chown glance:glance /var/lib/glance/extended-images/ Once the previous steps has been made, we need to configure the /etc/glance/glance-api.conf file. In this file, we’re going to configure glance to use multiple directories to store images. We search the section “Filesystem Store Options” and modify/create the following: We will leave the option “filesystem_store_datadir=” empty, if we comment this option, glance will use it as default store location and will show us an error during image creation. And we add the option “filesystem_store_datadirs”, once for any directory we created in previous steps. We can use priorities on glance, priority 200 has precedence over priority 100, if we don’t specify any priority, default will be 0 ============ Filesystem Store Options ======================== filesystem_store_datadir= filesystem_store_datadirs=/var/lib/glance/images filesystem_store_datadirs=/var/lib/glance/lvm-images:200 filesystem_store_datadirs=/var/lib/glance/extended-images:100 &lt;/code&gt; Once we have configured glance-api.conf, restart glance-api service systemctl restart openstack-glance-api Now we’re going to create an image glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress [=============================&gt;] 100% +------------------+--------------------------------------+ | Property | Value | +------------------+--------------------------------------+ | checksum | 79b4436412283bb63c2cba4ac796bcd9 | | container_format | bare | | created_at | 2015-08-13T11:34:00.000000 | | deleted | False | | deleted_at | None | | disk_format | qcow2 | | id | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | | is_public | False | | min_disk | 0 | | min_ram | 0 | | name | CirrosDatadir | | owner | 738ec25d8b9c41f9b0cf84ce25730e92 | | protected | False | | size | 12506112 | | status | active | | updated_at | 2015-08-13T11:34:09.000000 | | virtual_size | None | +------------------+--------------------------------------+ The image has been properly created at glance, we’re going to check if the image has been properly created in the expected location. As we have configured a priority of 200 on this directory, the image must be here. ls -lsrt /var/lib/glance/extended-images/ total 12216 12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829 We have to keep the store location that we have been using till now, the images remain available here. ls -lsrt /var/lib/glance/images/ total 12892 12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778 Finally we check if the images are in active status glance image-list +--------------------------------------+----------------+-------------+------------------+----------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+----------------+-------------+------------------+----------+--------+ | 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros | qcow2 | bare | 13200896 | active | | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir | qcow2 | bare | 12506112 | active | | 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2 | bare | 12506112 | active | +--------------------------------------+----------------+-------------+------------------+----------+--------+   Regards">
<meta property="og:description" content="&lt;/br&gt; In this post i will show you how to add multiple store locations for glance images. This will allow you to extend your glance capacity without affect your current stored images. The location can be any device or directory mounted at your glance host as a NFS, a physical hard disk, or an extended partition. Let’s start: First we need to create the directories where hard disks are going to be mounted sudo mkdir /var/lib/glance/lvm-images sudo mkdir /var/lib/glance/extended-images Next, we mount the devices at the directories created in the previous step sudo mount /dev/sdc1 /var/lib/glance/lvm-images/ sudo mount /dev/sdd1 /var/lib/glance/extended-images/ An important step is making the glance user the owner of that directories chown glance:glance /var/lib/glance/lvm-images/ chown glance:glance /var/lib/glance/extended-images/ Once the previous steps has been made, we need to configure the /etc/glance/glance-api.conf file. In this file, we’re going to configure glance to use multiple directories to store images. We search the section “Filesystem Store Options” and modify/create the following: We will leave the option “filesystem_store_datadir=” empty, if we comment this option, glance will use it as default store location and will show us an error during image creation. And we add the option “filesystem_store_datadirs”, once for any directory we created in previous steps. We can use priorities on glance, priority 200 has precedence over priority 100, if we don’t specify any priority, default will be 0 ============ Filesystem Store Options ======================== filesystem_store_datadir= filesystem_store_datadirs=/var/lib/glance/images filesystem_store_datadirs=/var/lib/glance/lvm-images:200 filesystem_store_datadirs=/var/lib/glance/extended-images:100 &lt;/code&gt; Once we have configured glance-api.conf, restart glance-api service systemctl restart openstack-glance-api Now we’re going to create an image glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress [=============================&gt;] 100% +------------------+--------------------------------------+ | Property | Value | +------------------+--------------------------------------+ | checksum | 79b4436412283bb63c2cba4ac796bcd9 | | container_format | bare | | created_at | 2015-08-13T11:34:00.000000 | | deleted | False | | deleted_at | None | | disk_format | qcow2 | | id | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | | is_public | False | | min_disk | 0 | | min_ram | 0 | | name | CirrosDatadir | | owner | 738ec25d8b9c41f9b0cf84ce25730e92 | | protected | False | | size | 12506112 | | status | active | | updated_at | 2015-08-13T11:34:09.000000 | | virtual_size | None | +------------------+--------------------------------------+ The image has been properly created at glance, we’re going to check if the image has been properly created in the expected location. As we have configured a priority of 200 on this directory, the image must be here. ls -lsrt /var/lib/glance/extended-images/ total 12216 12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829 We have to keep the store location that we have been using till now, the images remain available here. ls -lsrt /var/lib/glance/images/ total 12892 12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778 Finally we check if the images are in active status glance image-list +--------------------------------------+----------------+-------------+------------------+----------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+----------------+-------------+------------------+----------+--------+ | 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros | qcow2 | bare | 13200896 | active | | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir | qcow2 | bare | 12506112 | active | | 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2 | bare | 12506112 | active | +--------------------------------------+----------------+-------------+------------------+----------+--------+   Regards">
<link rel="canonical" href="http://217.182.136.201:5000/multiple-store-locations-for-glance-images/">
<meta property="og:url" content="http://217.182.136.201:5000/multiple-store-locations-for-glance-images/">
<meta property="og:site_name" content="OpenStack things">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-08-13T13:37:52+00:00">
<script type="application/ld+json">
{"name":null,"description":"&lt;/br&gt; In this post i will show you how to add multiple store locations for glance images. This will allow you to extend your glance capacity without affect your current stored images. The location can be any device or directory mounted at your glance host as a NFS, a physical hard disk, or an extended partition. Let’s start: First we need to create the directories where hard disks are going to be mounted sudo mkdir /var/lib/glance/lvm-images sudo mkdir /var/lib/glance/extended-images Next, we mount the devices at the directories created in the previous step sudo mount /dev/sdc1 /var/lib/glance/lvm-images/ sudo mount /dev/sdd1 /var/lib/glance/extended-images/ An important step is making the glance user the owner of that directories chown glance:glance /var/lib/glance/lvm-images/ chown glance:glance /var/lib/glance/extended-images/ Once the previous steps has been made, we need to configure the /etc/glance/glance-api.conf file. In this file, we’re going to configure glance to use multiple directories to store images. We search the section “Filesystem Store Options” and modify/create the following: We will leave the option “filesystem_store_datadir=” empty, if we comment this option, glance will use it as default store location and will show us an error during image creation. And we add the option “filesystem_store_datadirs”, once for any directory we created in previous steps. We can use priorities on glance, priority 200 has precedence over priority 100, if we don’t specify any priority, default will be 0 ============ Filesystem Store Options ======================== filesystem_store_datadir= filesystem_store_datadirs=/var/lib/glance/images filesystem_store_datadirs=/var/lib/glance/lvm-images:200 filesystem_store_datadirs=/var/lib/glance/extended-images:100 &lt;/code&gt; Once we have configured glance-api.conf, restart glance-api service systemctl restart openstack-glance-api Now we’re going to create an image glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress [=============================&gt;] 100% +------------------+--------------------------------------+ | Property | Value | +------------------+--------------------------------------+ | checksum | 79b4436412283bb63c2cba4ac796bcd9 | | container_format | bare | | created_at | 2015-08-13T11:34:00.000000 | | deleted | False | | deleted_at | None | | disk_format | qcow2 | | id | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | | is_public | False | | min_disk | 0 | | min_ram | 0 | | name | CirrosDatadir | | owner | 738ec25d8b9c41f9b0cf84ce25730e92 | | protected | False | | size | 12506112 | | status | active | | updated_at | 2015-08-13T11:34:09.000000 | | virtual_size | None | +------------------+--------------------------------------+ The image has been properly created at glance, we’re going to check if the image has been properly created in the expected location. As we have configured a priority of 200 on this directory, the image must be here. ls -lsrt /var/lib/glance/extended-images/ total 12216 12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829 We have to keep the store location that we have been using till now, the images remain available here. ls -lsrt /var/lib/glance/images/ total 12892 12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778 Finally we check if the images are in active status glance image-list +--------------------------------------+----------------+-------------+------------------+----------+--------+ | ID | Name | Disk Format | Container Format | Size | Status | +--------------------------------------+----------------+-------------+------------------+----------+--------+ | 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros | qcow2 | bare | 13200896 | active | | 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir | qcow2 | bare | 12506112 | active | | 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2 | bare | 12506112 | active | +--------------------------------------+----------------+-------------+------------------+----------+--------+   Regards","author":{"@type":"Person","name":"Editor"},"@type":"BlogPosting","url":"http://217.182.136.201:5000/multiple-store-locations-for-glance-images/","publisher":null,"image":null,"headline":"Multiple store locations for Glance images","dateModified":"2015-08-13T13:37:52+00:00","datePublished":"2015-08-13T13:37:52+00:00","sameAs":null,"mainEntityOfPage":{"@type":"WebPage","@id":"http://217.182.136.201:5000/multiple-store-locations-for-glance-images/"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="http://github.com/egonzalez90/egonzalez90.github.io">View on GitHub</a>

          <h1 id="project_title">OpenStack things</h1>
          <h2 id="project_tagline">OpenStack, Docker, Ansible, Ceph, Linux</h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><br>&lt;/br&gt;
In this post i will show you how to add multiple store locations for glance images.
This will allow you to extend your glance capacity without affect your current stored images.
The location can be any device or directory mounted at your glance host as  a NFS, a physical hard disk, or an extended partition.
Let’s start:</p>

<p>First we need to create the directories where hard disks are going to be mounted
<code>
sudo mkdir /var/lib/glance/lvm-images
sudo mkdir /var/lib/glance/extended-images
</code></p>

<p>Next, we mount the devices at the directories created in the previous step</p>

<p><code>
sudo mount /dev/sdc1 /var/lib/glance/lvm-images/
sudo mount /dev/sdd1 /var/lib/glance/extended-images/
</code></p>

<p>An important step is making the glance user the owner of that directories</p>

<p><code>
chown glance:glance /var/lib/glance/lvm-images/
chown glance:glance /var/lib/glance/extended-images/
</code></p>

<p>Once the previous steps has been made, we need to configure the /etc/glance/glance-api.conf file.
In this file, we’re going to configure glance to use multiple directories to store images.
We search the section “Filesystem Store Options” and modify/create the following:
We will leave the option “filesystem_store_datadir=” empty, if we comment this option, glance will use it as default store location and will show us an error during image creation.
And we add the option “filesystem_store_datadirs”, once for any directory we created in previous steps.
We can use priorities on glance, priority 200 has precedence over priority 100, if we don’t specify any priority, default will be 0</p>

<p><code></code></p>
<h1 id="-filesystem-store-options-">============ Filesystem Store Options ========================</h1>
<p>filesystem_store_datadir=
filesystem_store_datadirs=/var/lib/glance/images
filesystem_store_datadirs=/var/lib/glance/lvm-images:200
filesystem_store_datadirs=/var/lib/glance/extended-images:100
&lt;/code&gt;</p>

<p>Once we have configured glance-api.conf, restart glance-api service</p>

<p><code>
systemctl restart openstack-glance-api
</code></p>

<p>Now we’re going to create an image</p>
<pre><code>
glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress
[=============================&gt;] 100%
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |
| container_format | bare                                 |
| created_at       | 2015-08-13T11:34:00.000000           |
| deleted          | False                                |
| deleted_at       | None                                 |
| disk_format      | qcow2                                |
| id               | 6ac8f5b9-5863-46ca-bb04-db352d35d829 |
| is_public        | False                                |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | CirrosDatadir                        |
| owner            | 738ec25d8b9c41f9b0cf84ce25730e92     |
| protected        | False                                |
| size             | 12506112                             |
| status           | active                               |
| updated_at       | 2015-08-13T11:34:09.000000           |
| virtual_size     | None                                 |
+------------------+--------------------------------------+

 </code></pre>
<p>The image has been properly created at glance, we’re going to check if the image has been properly created in the expected location.
As we have configured a priority of 200 on this directory, the image must be here.</p>

<p><code>
ls -lsrt /var/lib/glance/extended-images/
total 12216
12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829
</code></p>

<p>We have to keep the store location that we have been using till now, the images remain available here.</p>

<p><code>
ls -lsrt /var/lib/glance/images/
total 12892
12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778
</code></p>

<p>Finally we check if the images are in active status</p>

<pre><code>
glance image-list
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| ID                                   | Name           | Disk Format | Container Format | Size     | Status |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros         | qcow2       | bare             | 13200896 | active |
| 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir  | qcow2       | bare             | 12506112 | active |
| 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2       | bare             | 12506112 | active |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
</code></pre>

<p> </p>

<p>Regards</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">OpenStack things maintained by <a href="http://github.com/egonzalez90">egonzalez90</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  </body>

<div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = 'https://egonzalez-1.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</html>
