<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles in the "OpenStack" category | Page 5</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link href="https://egonzalez90.github.io/feeds/openstack.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Categories Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>

                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/category/openstack5.html">OpenStack</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Aug 13, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html" rel="bookmark" title="Permanent Link to &quot;Multiple store locations for Glance images&quot;">Multiple store locations for Glance images</a>
                </h2>

                
                

                <p>In this post i will show you how to add multiple store locations for
glance images.<br>
This will allow you to extend your glance capacity without affect your
current stored images.<br>
The location can be any device or directory mounted at your glance host
as a NFS, a physical hard disk, or an extended partition.<br>
Let's start:</p>
<p>First we need to create the directories where hard disks are going to be
mounted  </p>
<p><code>sudo mkdir /var/lib/glance/lvm-images sudo mkdir /var/lib/glance/extended-images</code></p>
<p>Next, we mount the devices at the directories created in the previous
step</p>
<p><code>sudo mount /dev/sdc1 /var/lib/glance/lvm-images/ sudo mount /dev/sdd1 /var/lib/glance/extended-images/</code></p>
<p>An important step is making the glance user the owner of that
directories</p>
<p><code>chown glance:glance /var/lib/glance/lvm-images/ chown glance:glance /var/lib/glance/extended-images/</code></p>
<p>Once the previous steps has been made, we need to configure the
/etc/glance/glance-api.conf file.<br>
In this file, we're going to configure glance to use multiple
directories to store images.<br>
We search the section "Filesystem Store Options" and modify/create the
following:<br>
We will leave the option "filesystem_store_datadir=" empty, if we
comment this option, glance will use it as default store location and
will show us an error during image creation.<br>
And we add the option "filesystem_store_datadirs", once for any
directory we created in previous steps.<br>
We can use priorities on glance, priority 200 has precedence over
priority 100, if we don't specify any priority, default will be 0</p>
<p><code># ============ Filesystem Store Options ======================== filesystem_store_datadir= filesystem_store_datadirs=/var/lib/glance/images filesystem_store_datadirs=/var/lib/glance/lvm-images:200 filesystem_store_datadirs=/var/lib/glance/extended-images:100</code></p>
<p>Once we have configured glance-api.conf, restart glance-api service</p>
<p><code>systemctl restart openstack-glance-api</code></p>
<p>Now we're going to create an image</p>
<div class="highlight"><pre><span></span>glance image-create --name CirrosDatadir --file ~/Images/cirros-0.3.4-i386-disk.img --disk-format qcow2 --container-format bare --progress
[=============================&gt;] 100%
+------------------+--------------------------------------+
| Property         | Value                                |
+------------------+--------------------------------------+
| checksum         | 79b4436412283bb63c2cba4ac796bcd9     |
| container_format | bare                                 |
| created_at       | 2015-08-13T11:34:00.000000           |
| deleted          | False                                |
| deleted_at       | None                                 |
| disk_format      | qcow2                                |
| id               | 6ac8f5b9-5863-46ca-bb04-db352d35d829 |
| is_public        | False                                |
| min_disk         | 0                                    |
| min_ram          | 0                                    |
| name             | CirrosDatadir                        |
| owner            | 738ec25d8b9c41f9b0cf84ce25730e92     |
| protected        | False                                |
| size             | 12506112                             |
| status           | active                               |
| updated_at       | 2015-08-13T11:34:09.000000           |
| virtual_size     | None                                 |
+------------------+--------------------------------------+
</pre></div>


<p>The image has been properly created at glance, we're going to check if
the image has been properly created in the expected location.<br>
As we have configured a priority of 200 on this directory, the image
must be here.</p>
<p><code>ls -lsrt /var/lib/glance/extended-images/ total 12216 12216 -rw-r-----. 1 glance glance 12506112 ago 13 13:34 6ac8f5b9-5863-46ca-bb04-db352d35d829</code></p>
<p>We have to keep the store location that we have been using till now, the
images remain available here.</p>
<p><code>ls -lsrt /var/lib/glance/images/ total 12892 12892 -rw-r-----. 1 glance glance 13200896 ago 6 11:09 10a7a49f-2533-4513-881f-c4c6e419b778</code></p>
<p>Finally we check if the images are in active status</p>
<div class="highlight"><pre><span></span>glance image-list
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| ID                                   | Name           | Disk Format | Container Format | Size     | Status |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
| 10a7a49f-2533-4513-881f-c4c6e419b778 | cirros         | qcow2       | bare             | 13200896 | active |
| 6ac8f5b9-5863-46ca-bb04-db352d35d829 | CirrosDatadir  | qcow2       | bare             | 12506112 | active |
| 9e957bad-d0f8-4294-a438-77ad0d6af02b | CirrosDatadir2 | qcow2       | bare             | 12506112 | active |
+--------------------------------------+----------------+-------------+------------------+----------+--------+
</pre></div>


<p>Regards</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html">posted at 13:37</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/create.html" class="tags">create</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/filesystem_store_datadirs.html" class="tags">filesystem_store_datadirs</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance.html" class="tags">glance</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance-api.html" class="tags">glance-api</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance-apiconf.html" class="tags">glance-api.conf</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/images.html" class="tags">images</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/locations.html" class="tags">locations</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/multiple.html" class="tags">multiple</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/storage.html" class="tags">storage</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/store.html" class="tags">store</a>
                </div>
		<a href="https://egonzalez90.github.io/multiple-store-locations-for-glance-images.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Jul 02, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html" rel="bookmark" title="Permanent Link to &quot;List all tenants belonging an user  Keystone v2&quot;">List all tenants belonging an user  Keystone v2</a>
                </h2>

                
                

                <p>Here is a simple script to list all tenants belonging an user:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span> -n <span class="s2">&quot;Username : &quot;</span> <span class="p">;</span> <span class="nb">read</span> usercheck

<span class="k">for</span> userid in <span class="k">$(</span>keystone user-list <span class="p">|</span> grep -w <span class="nv">$usercheck</span> <span class="p">|</span> awk <span class="s1">&#39;{print$2}&#39;</span><span class="k">)</span>
    <span class="k">do</span>
    <span class="k">for</span> tenant in <span class="k">$(</span>keystone tenant-list <span class="p">|</span> awk <span class="s1">&#39;NR&gt;3 &amp;&amp; /^|/ {print$2}&#39;</span><span class="k">)</span>
    <span class="k">do</span>
        <span class="k">for</span> tenantid in <span class="k">$(</span>keystone user-role-list --user <span class="nv">$userid</span> --tenant <span class="nv">$tenant</span> <span class="p">|</span> awk <span class="s1">&#39;NR&gt;3 &amp;&amp; /^|/ {print$8}&#39;</span><span class="k">)</span>
        <span class="k">do</span>
            keystone tenant-list <span class="p">|</span> grep <span class="nv">$tenantid</span> <span class="p">|</span> awk <span class="s1">&#39;{print$4}&#39;</span>
        <span class="k">done</span>
    <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>

<p>Also you can run all in a simple cmd line:<br>
</p>
<div class="highlight"><pre><span></span>echo -n &quot;user name &quot;; read usercheck; for userid in $(keystone user-list | grep $usercheck | awk &#39;{print$2}&#39;); do echo $userid | for tenant in $(keystone tenant-list | awk &#39;NR&gt;3 &amp;&amp; /^|/ {print$2}&#39;); do echo $tenant | for tenantid in $(keystone user-role-list --user $userid --tenant $tenant | awk &#39;NR&gt;3 &amp;&amp; /^|/ {print$8}&#39;); do keystone tenant-list | grep $tenantid | awk &#39;{print$4}&#39;; done ; done ; done
</pre></div>


<p>If you are a developer, probably you need to list all tenants in a HTTP
request, for this purpose you can use curl to the port 5000 of keystone<br>
</p>
<div class="highlight"><pre><span></span>curl -i -X GET http://KEYSTONEIP:5000/v2.0/tenants -H &quot;User-Agent: python-keystoneclient&quot; -H &quot;X-Auth-Token: USERTOKEN&quot;
</pre></div>


<p>I have saved the user token in a OS_VARIABLE called OS_TOKEN, if you
don't do that, you should input all the token in the HTTP request.<br>
For example:<br>
</p>
<div class="highlight"><pre><span></span>curl -i -X GET http://192.168.1.11:5000/v2.0/tenants -H &quot;User-Agent: python-keystoneclient&quot; -H &quot;X-Auth-Token: $OS_TOKEN&quot;
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html">posted at 14:29</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/all.html" class="tags">all</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/bash.html" class="tags">bash</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/belong.html" class="tags">belong</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/curl.html" class="tags">curl</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/get.html" class="tags">GET</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/how.html" class="tags">how</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/inside.html" class="tags">inside</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystone.html" class="tags">keystone</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystoneclient.html" class="tags">keystoneclient</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystonev2.html" class="tags">keystonev2</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/list.html" class="tags">list</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/python.html" class="tags">python</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/role.html" class="tags">role</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/script.html" class="tags">script</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/tenant.html" class="tags">tenant</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/tenants.html" class="tags">tenants</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/to.html" class="tags">to</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/token.html" class="tags">Token</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/user.html" class="tags">user</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/users.html" class="tags">users</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/v2.html" class="tags">v2</a>
                </div>
		<a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Mar 24, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html" rel="bookmark" title="Permanent Link to &quot;Load Balancer as a Service LBaaS&quot;">Load Balancer as a Service LBaaS</a>
                </h2>

                
                

                <p>The following guide will show you how to deploy a LoadBalancer in
Openstack with Neutron, but first, you should understand how it works,
and what his components do.</p>
<p>A Load Balancer is composed of the following components:</p>
<ul>
<li>Pool - A pool is a group of servers(members) who are designed to
    make the same job, <span id=":p2" dir="ltr">generally, a pool of web
    servers is used for balancing traffic between the members of the
    pool. </span>Here we will configure the Load Balancing Method
    (ROUND_ROBIN,LEAST_CONNECTIONS,SOURCE_IP)</li>
<li>Members - Members are instances, a server, any aplication that you
    can balance the load. They are assigned as pool members.</li>
<li>VIP - VIPs are Virtual IPs that logically represents the pool
    members. It is the IP where the load will be balanced between
    instances.</li>
<li>Healthmonitor - Healthmonitor will check if the members of a pool
    are healthy, if an member is not working or the port/protocol
    monitored is down, healthmonitor will send a message to the pool to
    not balance the load to this member.</li>
</ul>
<p>Now will create a Pool with 2 members, this Pool have a VIP and a
Healthmonitor on it.</p>
<p>First we cr            |<br>
| name                   | LoadBalancerPool                     |<br>
| protocol               | HTTP                                 |<br>
| provider               | haproxy                              |<br>
| status                 | PENDING_CREATE                       |<br>
| status_description     |                                      |<br>
| subnet_id              | e5a90ab2-918e-412b-9723-0d822804f022 |<br>
| tenant_id              | b1aaddea9f694e60aea5f1c0d1dd7c24     |<br>
| vip_id                 |                                      |<br>
+------------------------+--------------------------------------+</p>
<p>Next boot 2 instances in the same network</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ nova boot --flavor m1.tiny --image 6a3a7880-bc6f-454d-9a62-d9c2d268ef78 --security-groups default --nic net-id=daddce32-b6e8-4e3f-bd55-32459ed327ea WebServer1
[stack@localhost devstack]$ nova boot --flavor m1.tiny --image 6a3a7880-bc6f-454d-9a62-d9c2d268ef78 --security-groups default --nic net-id=daddce32-b6e8-4e3f-bd55-32459ed327ea WebServer2

[stack@localhost devstack]$ nova list
+--------------------------------------+------------+--------+------------+-------------+------------------+
| ID                                   | Name       | Status | Task State | Power State | Networks         |
+--------------------------------------+------------+--------+------------+-------------+------------------+
| c10e63c6-f342-4d1c-ae22-146c392ce398 | WebServer1 | BUILD  | spawning   | NOSTATE     | private=10.0.0.3 |
| ceef9e6b-6198-4118-8027-00898dee1abe | WebServer2 | BUILD  | spawning   | NOSTATE     | private=10.0.0.4 |
+--------------------------------------+------------+--------+------------+-------------+------------------+
</pre></div>


<p>Assign both instances to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-member-create --address 10.0.0.3 --protocol-port 80 LoadBalancerPool
Created a new member:
+--------------------+--------------------------------------+
| Field              | Value                                |
+--------------------+--------------------------------------+
| address            | 10.0.0.3                             |
| admin_state_up     | True                                 |
| id                 | a6de6bf0-3191-4721-aa01-5781ff05876e |
| pool_id            | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| protocol_port      | 80                                   |
| status             | PENDING_CREATE                       |
| status_description |                                      |
| tenant_id          | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| weight             | 1                                    |
+--------------------+--------------------------------------+

[stack@localhost devstack]$ neutron lb-member-create --address 10.0.0.4 --protocol-port 80 LoadBalancerPool
Created a new member:
+--------------------+--------------------------------------+
| Field              | Value                                |
+--------------------+--------------------------------------+
| address            | 10.0.0.4                             |
| admin_state_up     | True                                 |
| id                 | 9688a770-6494-4599-88fa-6afcd18c4dd1 |
| pool_id            | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| protocol_port      | 80                                   |
| status             | PENDING_CREATE                       |
| status_description |                                      |
| tenant_id          | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| weight             | 1                                    |
+--------------------+--------------------------------------+
</pre></div>


<p>Then create a Healthmonitor and associate it to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-healthmonitor-create --timeout 3 --max-retries 3 --delay 60 --type HTTP
Created a new health_monitor:
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| admin_state_up | True                                 |
| delay          | 60                                   |
| expected_codes | 200                                  |
| http_method    | GET                                  |
| id             | cb73f8fd-14ea-4937-aa10-019e3da8432f |
| max_retries    | 3                                    |
| pools          |                                      |
| tenant_id      | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| timeout        | 3                                    |
| type           | HTTP                                 |
| url_path       | /                                    |
+----------------+--------------------------------------+
[stack@localhost devstack]$ neutron lb-healthmonitor-associate cb73f8fd-14ea-4937-aa10-019e3da8432f LoadBalancerPool
Associated health monitor cb73f8fd-14ea-4937-aa10-019e3da8432f
</pre></div>


<p>Create a VIP to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-vip-create --name LoadBalancerVIP --protocol-port 80 --protocol HTTP --subnet-id e5a90ab2-918e-412b-9723-0d822804f022 LoadBalancerPool
Created a new vip:
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.5                             |
| admin_state_up      | True                                 |
| connection_limit    | -1                                   |
| description         |                                      |
| id                  | 4e3c2b84-a286-4999-a258-51c44965a81a |
| name                | LoadBalancerVIP                      |
| pool_id             | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| port_id             | d4ed46ac-aabf-40b6-8f28-1a2013971391 |
| protocol            | HTTP                                 |
| protocol_port       | 80                                   |
| session_persistence |                                      |
| status              | PENDING_CREATE                       |
| status_description  |                                      |
| subnet_id           | e5a90ab2-918e-412b-9723-0d822804f022 |
| tenant_id           | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+---------------------+--------------------------------------+
</pre></div>


<p>Create a floating IP to the VIP</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron floatingip-create 23101147-e724-4574-82c7-a05ccb661d4d
Created a new floatingip:
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| fixed_ip_address    |                                      |
| floating_ip_address | 172.24.4.3                           |
| floating_network_id | 23101147-e724-4574-82c7-a05ccb661d4d |
| id                  | 62fbf609-77db-4471-b6ae-9fe25a091a21 |
| port_id             |                                      |
| router_id           |                                      |
| status              | DOWN                                 |
| tenant_id           | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+---------------------+--------------------------------------+
</pre></div>


<p>Associate the floating IP with the VIP port</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron floatingip-associate 62fbf609-77db-4471-b6ae-9fe25a091a21 d4ed46ac-aabf-40b6-8f28-1a2013971391
Associated floating IP 62fbf609-77db-4471-b6ae-9fe25a091a21
</pre></div>


<p>Create security rules to allow HTTP, SSH and ICMP traffic</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron security-group-rule-create --protocol TCP --port-range-min 80 --port-range-max 80 be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | 4635cbb6-d939-40b3-ac11-637c8b63b027 |
| port_range_max    | 80                                   |
| port_range_min    | 80                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_prefix  |                                      |
| security_group_id | be0b2264-744a-48b8-9a1e-033227d78f2b |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+

[stack@localhost devstack]$ neutron security-group-rule-create --protocol icmp be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | 988329a1-d686-4541-8950-a22c721f847b |
| port_range_max    |                                      |
| port_range_min    |                                      |
| protocol          | icmp                                 |
| remote_group_id   |                                      |
| remote_ip_prefix  |                                      |
| security_group_id | be0b2264-744a-48b8-9a1e-033227d78f2b |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+

[stack@localhost devstack]$ neutron security-group-rule-create --protocol TCP --port-range-min 22 --port-range-max 22 be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | d18724dc-2eda-4031-be88-202a73c30c24 |
| port_range_max    | 22                                   |
| port_range_min    | 22                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_pref                          |
| security_group_id | d7412bb3-9824-4eb7-bc4b-cd80ab6a570d |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+
</pre></div>


<p>Login to both instances and run the command below to run a "webserver".</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ ssh cirros@INSTANCEIP
The authenticity of host &#39;10.0.0.3 (10.0.0.3)&#39; can&#39;t be established.
RSA key fingerprint is 94:00:8e:fe:9a:9d:af:ef:bc:e3:fd:9d:ad:d3:ab:a3.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;10.0.0.3&#39; (RSA) to the list of known hosts.

$ while true; do echo -e &#39;HTTP/1.0 200 OK \r\n\r\nServer1&#39; | sudo nc -l -p 80 ; done
$ while true; do echo -e &#39;HTTP/1.0 200 OK \r\n\r\nServer2&#39; | sudo nc -l -p 80 ; done
</pre></div>


<p>If we check with curl the VIP's floating IP, we'll see that in every
connection one of both servers reply with his name.</p>
<div class="highlight"><pre><span></span>[stack@localhost ~]$ curl http://172.24.4.3
Server1
[stack@localhost ~]$ curl http://172.24.4.3
Server2
[stack@localhost ~]$ curl http://172.24.4.3
Server1
[stack@localhost ~]$ curl http://172.24.4.3
Server2
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html">posted at 16:17</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/healthmonitor.html" class="tags">healthmonitor</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ip.html" class="tags">IP</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/lbaas.html" class="tags">lbaas</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/load-balancer-as-a-service.html" class="tags">load balancer as a service</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/member.html" class="tags">member</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/neutron.html" class="tags">neutron</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/pool.html" class="tags">pool</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/vip.html" class="tags">vip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/virtual.html" class="tags">virtual</a>
                </div>
		<a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/4" class="prev_page">&larr;&nbsp;Previous</a>
                    <a href="https://egonzalez90.github.io/page/6" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 5 of 16</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>