---
layout: post
title: Nova en Controller Node
date: 2015-02-04 17:11:09.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- OpenStack
tags:
- cloud
- compute
- configurar
- controller
- image-list
- nova
- openstack
- service
meta:
  _edit_last: '2'
  _publicize_twitter_user: "@egongu90"
  _wpas_mess: Nova en Controller Node
  _wpas_skip_10228321: '1'
  _wpas_done_all: '1'
  _wpas_skip_8706018: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1566933424;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:898;}i:1;a:1:{s:2:"id";i:927;}i:2;a:1:{s:2:"id";i:871;}}}}
  dsq_thread_id: '6203237768'
author:
  login: egongu90
  email: egongu90@hotmail.com
  display_name: Editor
  first_name: ''
  last_name: ''
permalink: "/nova-en-controller-node/"
---
<p>Instalaremos los paquetes de Nova en Controller node.</p>
<blockquote><p># yum install openstack-nova-api openstack-nova-cert openstack-nova-conductor </p>
<p>openstack-nova-console openstack-nova-novncproxy openstack-nova-scheduler </p>
<p>openstack-python-novaclient</p></blockquote>
<p>Configuramos nova para que use nuestra base de datos.</p>
<blockquote><p># openstack-config --set /etc/nova/nova.conf database connection mysql://nova:PASSWD@controller/nova</p></blockquote>
<p>Configuramos el uso de QPID.</p>
<blockquote><p># openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend qpid</p>
<p># openstack-config --set /etc/nova/nova.conf DEFAULT qpid_hostname controller</p></blockquote>
<p>Configuramos algunos parámetros como el vnc.</p>
<blockquote><p># openstack-config --set /etc/nova/nova.conf DEFAULT my_ip 192.168.1.11</p>
<p># openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_listen 192.168.1.11</p>
<p># openstack-config --set /etc/nova/nova.conf DEFAULT vncserver_proxyclient_address    192.168.1.11</p></blockquote>
<p>Creamos el usuario nova en la base de datos.</p>
<blockquote><p># mysql -u root -p</p>
<p># CREATE DATABASE nova;</p>
<p># GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' IDENTIFIED BY 'passwd';</p>
<p># GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' IDENTIFIED BY 'passwd';</p></blockquote>
<p>Creamos las tablas de nova en la base de datos.</p>
<blockquote><p># su -s /bin/sh -c "nova-manage db sync" nova</p></blockquote>
<p>Creamos el usuario nova en el tenant service con rol de admin.</p>
<p># keystone user-create --name=nova --pass=PASSWD --email=nova@mail.com</p>
<p># keystone user-role-add --user=nova --tenant=service --role=admin</p>
<p>Configuramos nova para que use keystone.</p>
<blockquote><p># openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://controller:5000</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_host controller</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_protocol http</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_port 35357</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_user nova</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_tenant_name service</p>
<p># openstack-config --set /etc/nova/nova.conf keystone_authtoken admin_password PASSWD</p></blockquote>
<p>Registramos el servicio en nova y creamos el endpoint.</p>
<blockquote><p># keystone service-create --name=nova --type=compute --description="Openstack Compute"</p>
<p># keystone endpoint-create<br />
--service-id=$(keystone service-list | awk '/ compute / {print $2}')<br />
--publicurl=http://controller:8774/v2/%(tenant_id)s<br />
--internalurl=http://controller:8774/v2/%(tenant_id)s<br />
--adminurl=http://controller:8774/v2/%(tenant_id)s</p></blockquote>
<p>Iniciamos los servicios y establecemos la ejecución en el arranque.</p>
<blockquote><p># service openstack-nova-api start</p>
<p># service openstack-nova-cert start</p>
<p># service openstack-nova-consoleauth start</p>
<p># service openstack-nova-scheduler start</p>
<p># service openstack-nova-conductor start</p>
<p># service openstack-nova-novncproxy start</p>
<p># chkconfig openstack-nova-api on</p>
<p># chkconfig openstack-nova-cert on</p>
<p># chkconfig openstack-nova-consoleauth on</p>
<p># chkconfig openstack-nova-scheduler on</p>
<p># chkconfig openstack-nova-conductor on</p>
<p># chkconfig openstack-nova-novncproxy on</p></blockquote>
<p>Comprobamos que esta correctamente configurado</p>
<blockquote><p># nova image-list</p></blockquote>
<p>&nbsp;</p>
