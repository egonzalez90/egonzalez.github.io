---
layout: post
title: Ceph RadosGW Admin Ops, how to use it
date: 2015-09-08 13:45:40.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- OpenStack
tags:
- admin
- admin ops
- ceph
- header
- ops
- query
- radosgw
- script
- sign
- understand
- usage
- user
meta:
  _edit_last: '2'
  _publicize_facebook_user: http://www.facebook.com/1161837279
  _publicize_twitter_user: "@egongu90"
  _wpas_skip_12345373: '1'
  _wpas_done_all: '1'
  _wpas_skip_5226565: '1'
  _wpas_skip_10228321: '1'
  _wpas_skip_8706018: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1568842049;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:1192;}i:1;a:1:{s:2:"id";i:1213;}i:2;a:1:{s:2:"id";i:1257;}}}}
  dsq_thread_id: '6094296968'
author:
  login: egongu90
  email: egongu90@hotmail.com
  display_name: Editor
  first_name: ''
  last_name: ''
permalink: "/ceph-radosgw-admin-ops-how-to-use-it/"
---
<p>
Using RadosGW admin ops for the first time, can be a real headache , for this purpose i have made this post, where you will understand how to use this API.<br />
Let's start:</p>
<p>For issue a request through admin ops, you need to have a signature, this signature is make it signing a header.<br />
The header must to be composed by the current date, the request type(GET/PUT/POST/DELETE) and the request itself.<br />
This header must be signed by SSL including the admin ops secret on this signature.<br />
Now , you can make a request.<br />
Sometimes, the time is not the same as the radosgw node expect, you can hack on it changing the date=$(date) value with:<br />
If your host has two hours more than the radosgw node, substract this two hours under $(( 10#$i-2)) variable, where 2 is the two hours to substract.</p>
<pre>
date=$(for i in $(date "+%H") ; do date "+%a, %d %b %Y $(( 10#$i-2 )):%M:%S +0000" ; done)
</pre>
<p>Examples:</p>
<p>Create a user named egonzalez:</p>
<pre>
#!/bin/bash
token=U2JCD4ZG4D1XJOI5XNF4 ## USER_TOKEN
secret=+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b ## USER_SECRET
query=$1
name=$2
query3="&uid="
query2=admin/user
query4="&quota-type=user"
date=$(date)
header="PUT\n\n\n${date}\n/${query2}"
sig=$(echo -en ${header} | openssl sha1 -hmac ${secret} -binary | base64)
curl -v -H "Date: ${date}" -H "Authorization: AWS ${token}:${sig}" -L -X PUT "http://10.0.2.10/${query2}?format=json${query3}${query}&display-name=${name}" -H "Host: 10.0.2.10"
##Change IPs with your own IPs
</pre>
<p>Output:</p>
<pre>
[ceph@adminnode scripts]$ sh createUser.sh egonzalez EgonzalezDescription
{"user_id":"egonzalez","display_name":"EgonzalezDescription","email":"","suspended":0,"max_buckets":1000,"subusers":[],"keys":[{"user":"egonzalez","access_key":"24FUKCWD6BL9T08DQ2JA","secret_key":"mEQdhcrsqOy7q6Snvu8B5d5A2Ek9OezJH+khwYvX"}],"swift_keys":[],"caps":[]}
</pre>
<p>See egonzalez quotas</p>
<pre>
#!/bin/bash
token=U2JCD4ZG4D1XJOI5XNF4 ## USER_TOKEN
secret=+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b ## USER_SECRET
query=$1
query3="&uid="
query2=admin/user
query4="&quota-type=user"
date=$(date)
header="GET\n\n\n${date}\n/${query2}"
sig=$(echo -en ${header} | openssl sha1 -hmac ${secret} -binary | base64)
curl -v -H "Date: ${date}" -H "Authorization: AWS ${token}:${sig}" -L -X GET "http://10.0.2.10/${query2}?quota${query3}${query}&quota-type=user" -H "Host: 10.0.2.10"
##Change IPs with your own IPs
</pre>
<p>Output:</p>
<pre>
[ceph@adminnode scripts]$ sh getuserquota.sh egonzalez

{"enabled": true,"max_size_kb":1000,"max_objects":1000}Status: 200 OK
</pre>
<p>See egonzalez user information.</p>
<pre>
#!/bin/bash
token=U2JCD4ZG4D1XJOI5XNF4 ## USER_TOKEN
secret=+IFgr7POzLWS0i3hQnC+dd3DOAZObHoY5NYm6m3b ## USER_SECRET
query=$1
query3="&uid="
query2=admin/user
date=$(date)
header="GET\n\n\n${date}\n/${query2}"
sig=$(echo -en ${header} | openssl sha1 -hmac ${secret} -binary | base64)
curl -v -H "Date: ${date}" -H "Authorization: AWS ${token}:${sig}" -L -X GET "http://10.0.2.10/${query2}?format=json${query3}${query}" -H "Host: 10.0.2.10"
##Change IPs with your own IPs
</pre>
<p>Output:</p>
<pre>
[ceph@adminnode scripts]$ sh userInfo.sh egonzalez
{"user_id":"egonzalez","display_name":"EgonzalezDescription","email":"","suspended":0,"max_buckets":1000,"subusers":[],"keys":[{"user":"egonzalez","access_key":"24FUKCWD6BL9T08DQ2JA","secret_key":"mEQdhcrsqOy7q6Snvu8B5d5A2Ek9OezJH+khwYvX"}],"swift_keys":[],"caps":[]}
</pre>
<p>When you really understand how admin ops works, is not as dificult to use it, just search at the official documentation and modify the desired values.</p>
<p>I hope this helps:</p>
<p>Regards, Eduardo.</p>
