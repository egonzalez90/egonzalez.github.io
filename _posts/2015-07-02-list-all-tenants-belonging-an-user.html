---
layout: post
title: List all tenants belonging an user  Keystone v2
date: 2015-07-02 14:29:33.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- OpenStack
tags:
- all
- bash
- belong
- curl
- GET
- how
- inside
- keystone
- keystoneclient
- keystonev2
- list
- openstack
- python
- role
- script
- tenant
- tenants
- to
- Token
- user
- users
- v2
meta:
  _edit_last: '2'
  _publicize_facebook_user: https://www.facebook.com/dudu.gonzalez90
  _publicize_twitter_user: "@egongu90"
  _wpas_done_all: '1'
  _wpas_skip_5226565: '1'
  _wpas_skip_10228321: '1'
  _wpas_skip_8706018: '1'
  _jetpack_related_posts_cache: a:1:{s:32:"8f6677c9d6b0f903e98ad32ec61f8deb";a:2:{s:7:"expires";i:1568667166;s:7:"payload";a:3:{i:0;a:1:{s:2:"id";i:879;}i:1;a:1:{s:2:"id";i:816;}i:2;a:1:{s:2:"id";i:1310;}}}}
  dsq_thread_id: '6095933262'
author:
  login: egongu90
  email: egongu90@hotmail.com
  display_name: Editor
  first_name: ''
  last_name: ''
permalink: "/list-all-tenants-belonging-an-user/"
---
<p>&nbsp;</p>
<p>Here is a simple script to list all tenants belonging an user:</p>
<p>&nbsp;</p>
<pre><code>#!/bin/bash

echo -n "Username : " ; read usercheck

for userid in $(keystone user-list | grep -w $usercheck | awk '{print$2}')
	do
	for tenant in $(keystone tenant-list | awk 'NR&gt;3 &amp;&amp; /^|/ {print$2}')
	do
		for tenantid in $(keystone user-role-list --user $userid --tenant $tenant | awk 'NR&gt;3 &amp;&amp; /^|/ {print$8}')
		do
			keystone tenant-list | grep $tenantid | awk '{print$4}'
		done
	done
done
</code></pre>
<p>&nbsp;<br />
Also you can run all in a simple cmd line:<br />
&nbsp;</p>
<pre><code>
echo -n "user name "; read usercheck; for userid in $(keystone user-list | grep $usercheck | awk '{print$2}'); do echo $userid | for tenant in $(keystone tenant-list | awk 'NR&gt;3 &amp;&amp; /^|/ {print$2}'); do echo $tenant | for tenantid in $(keystone user-role-list --user $userid --tenant $tenant | awk 'NR>3 && /^|/ {print$8}'); do keystone tenant-list | grep $tenantid | awk '{print$4}'; done ; done ; done

</code></pre>
<p>&nbsp;<br />
If you are a developer, probably you need to list all tenants in a HTTP request, for this purpose you can use curl to the port 5000 of keystone<br />
&nbsp;</p>
<pre><code>
curl -i -X GET http://KEYSTONEIP:5000/v2.0/tenants -H "User-Agent: python-keystoneclient" -H "X-Auth-Token: USERTOKEN"
</code></pre>
<p>&nbsp;<br />
I have saved the user token in a OS_VARIABLE called OS_TOKEN, if you don't do that, you should input all the token in the HTTP request.<br />
For example:<br />
&nbsp;</p>
<pre><code>
curl -i -X GET http://192.168.1.11:5000/v2.0/tenants -H "User-Agent: python-keystoneclient" -H "X-Auth-Token: $OS_TOKEN"
</code></pre>
