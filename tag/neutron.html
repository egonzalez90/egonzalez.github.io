<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles tagged "neutron"</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/tag/neutron.html">neutron</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Jan 27, 2016</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html" rel="bookmark" title="Permanent Link to &quot;Configure Neutron DVR OpenStack Liberty&quot;">Configure Neutron DVR OpenStack Liberty</a>
                </h2>

                
                

                <p>Distributed Virtual Routers aka DVR were created to avoid single point
of failure on neutron nodes.<br>
When using standard routers, all the traffic is passing out through
Neutron servers. Inside network servers, router namespaces are created
routing all traffic and NAT forwarding between instances and public
networks. When a network node falls down, instance traffic will no
longer be available until a new namespace is created and executed in
another network node.<br>
Distributed routers is a way to avoid the SPOF neutron nodes were. When
using DVR, router namespaces, are directly created inside compute nodes
where all instance and l3 traffic are routed.</p>
<p>If you want to know more about DVR check this awesome links:  </p>
<p><a href="http://blog.gampel.net/2014/12/openstack-neutron-distributed-virtual.html">http://blog.gampel.net/2014/12/openstack-neutron-distributed-virtual.html</a><br>
<a href="http://blog.gampel.net/2014/12/openstack-dvr2-floating-ips.html">http://blog.gampel.net/2014/12/openstack-dvr2-floating-ips.html</a><br>
<a href="http://blog.gampel.net/2015/01/openstack-DVR-SNAT.html">http://blog.gampel.net/2015/01/openstack-DVR-SNAT.html</a></p>
<p>A previous OpenStack Liberty installation is required, mine was done
with RDO packstack.</p>
<p><strong><ins datetime="2016-01-27T18:47:58+00:00">Configure all Neutron
Servers</ins></strong></p>
<p>Edit ml2 configuration file with the following:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/ml2_conf.ini

mechanism_drivers = openvswitch,l2population
type_drivers = flat,vlan,vxlan
tenant_network_types = vxlan
vni_ranges = 10:100
vxlan_group = 224.1.1.1
enable_security_group = True
</pre></div>


<p>Edit neutron configuration file, enable DVR and uncomment dvr_base_mac
option</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/neutron.conf

router_distributed = True
dvr_base_mac = fa:16:3f:00:00:00
</pre></div>


<p>Configure l3 agent to use dvr_snat</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/l3_agent.ini

agent_mode = dvr_snat
</pre></div>


<p>Restart neutron server</p>
<div class="highlight"><pre><span></span>systemctl restart neutron-server
</pre></div>


<p><strong><ins datetime="2016-01-27T18:47:58+00:00">Configure all Compute
Nodes</ins></strong></p>
<p>Install ml2 package</p>
<div class="highlight"><pre><span></span>yum install openstack-neutron-ml2
</pre></div>


<p>Edit openvswitch agent file as below:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/openvswitch_agent.ini

l2_population = True
arp_responder = True
enable_distributed_routing = True
</pre></div>


<p>Enable DVR and select an interface driver to be used by l3 agent</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/l3_agent.ini

interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
agent_mode = dvr
</pre></div>


<p>Edit ml2 configuration file as below:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/ml2_conf.ini

type_drivers = flat,vlan,vxlan
tenant_network_types = vxlan
mechanism_drivers = openvswitch,l2population
vni_ranges = 10:100
vxlan_group = 224.1.1.1
enable_security_group = True
</pre></div>


<p>Start and enable metadata agent in compute nodes</p>
<div class="highlight"><pre><span></span>systemctl start neutron-l3-agent neutron-metadata-agent
systemctl enable neutron-l3-agent neutron-metadata-agent
</pre></div>


<p>Create an external bridge with an external IP associated on it</p>
<div class="highlight"><pre><span></span># vi /etc/sysconfig/network-scripts/ifcfg-br-ex

DEVICE=br-ex
DEVICETYPE=ovs
TYPE=OVSBridge
BOOTPROTO=static
IPADDR=192.168.100.4                                                          
NETMASK=255.255.255.0
GATEWAY=192.168.100.1
ONBOOT=yes
</pre></div>


<p>Modify an unused interface connected with the same network as the IP
configured with br-ex, edit the interface to be used as OVS port by
br-ex</p>
<div class="highlight"><pre><span></span># vi /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
TYPE=OVSPort
DEVICETYPE=ovs
OVS_BRIDGE=br-ex
ONBOOT=yes
</pre></div>


<p>Restart network service to apply changes on the interfaces and
openvswith-agent</p>
<div class="highlight"><pre><span></span>systemctl restart network
systemctl restart neutron-openvswitch-agent
</pre></div>


<p>Create an external network and a subnet on it</p>
<div class="highlight"><pre><span></span>neutron net-create external_network --provider:network_type flat --provider:physical_network extnet  --router:external --shared
neutron subnet-create --name public_subnet --enable_dhcp=False --allocation-pool=start=192.168.100.100,end=192.168.100.150 --gateway=192.168.100.1 external_network 192.168.100.0/24
</pre></div>


<p>Create a router and associate external network as router gateway</p>
<div class="highlight"><pre><span></span>neutron router-create router1
neutron router-gateway-set router1 external_network
</pre></div>


<p>Create an internal network, a subnet and associate an interface to the
router</p>
<div class="highlight"><pre><span></span>neutron net-create private_network
neutron subnet-create --name private_subnet private_network 10.0.1.0/24
neutron router-interface-add router1 private_subnet
</pre></div>


<p>Boot 2 instances</p>
<div class="highlight"><pre><span></span>nova boot --flavor m1.tiny --image cirros --nic net-id=154da7a8-fa49-415e-9d35-c840b144a8df test1
nova boot --flavor m1.tiny --image cirros --nic net-id=154da7a8-fa49-415e-9d35-c840b144a8df test2
</pre></div>


<p>Create 2 floating ips and associate it to instances</p>
<div class="highlight"><pre><span></span>neutron floatingip-create external_network
neutron floatingip-create external_network
nova floating-ip-associate test1 192.168.100.101
nova floating-ip-associate test2 192.168.100.102
</pre></div>


<p>Test if all works as expected pinging floating ips</p>
<div class="highlight"><pre><span></span># ping 192.168.100.101
# ping 192.168.100.102
</pre></div>


<p>As you can see, in network nodes, a snat namespace is created</p>
<div class="highlight"><pre><span></span># sudo ip netns
qdhcp-154da7a8-fa49-415e-9d35-c840b144a8df
snat-77fef58a-6d0c-4e96-b4b6-5d8e81ebead3
</pre></div>


<p>In compute nodes, a fip namespace per instance with floating ip
associated running on the compute node are created and a qrouter
namespace are created.</p>
<div class="highlight"><pre><span></span># sudo ip netns
fip-4dfdabb0-d2d6-4d4a-8c00-84df834eec8b
qrouter-77fef58a-6d0c-4e96-b4b6-5d8e81ebead3
</pre></div>


<p>Best regards, Eduardo Gonzalez</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html">posted at 20:13</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/-configure.html" class="tags">--configure</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/distributed.html" class="tags">distributed</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/dvr.html" class="tags">dvr</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/fip.html" class="tags">fip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/l3.html" class="tags">l3</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/liberty.html" class="tags">liberty</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/neutron.html" class="tags selected">neutron</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/packstack.html" class="tags">packstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/qrouter.html" class="tags">qrouter</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rdo.html" class="tags">rdo</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/routers.html" class="tags">routers</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/snat.html" class="tags">snat</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/virtual.html" class="tags">virtual</a>
                </div>
		<a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Mar 24, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html" rel="bookmark" title="Permanent Link to &quot;Load Balancer as a Service LBaaS&quot;">Load Balancer as a Service LBaaS</a>
                </h2>

                
                

                <p>The following guide will show you how to deploy a LoadBalancer in
Openstack with Neutron, but first, you should understand how it works,
and what his components do.</p>
<p>A Load Balancer is composed of the following components:</p>
<ul>
<li>Pool - A pool is a group of servers(members) who are designed to
    make the same job, <span id=":p2" dir="ltr">generally, a pool of web
    servers is used for balancing traffic between the members of the
    pool. </span>Here we will configure the Load Balancing Method
    (ROUND_ROBIN,LEAST_CONNECTIONS,SOURCE_IP)</li>
<li>Members - Members are instances, a server, any aplication that you
    can balance the load. They are assigned as pool members.</li>
<li>VIP - VIPs are Virtual IPs that logically represents the pool
    members. It is the IP where the load will be balanced between
    instances.</li>
<li>Healthmonitor - Healthmonitor will check if the members of a pool
    are healthy, if an member is not working or the port/protocol
    monitored is down, healthmonitor will send a message to the pool to
    not balance the load to this member.</li>
</ul>
<p>Now will create a Pool with 2 members, this Pool have a VIP and a
Healthmonitor on it.</p>
<p>First we cr            |<br>
| name                   | LoadBalancerPool                     |<br>
| protocol               | HTTP                                 |<br>
| provider               | haproxy                              |<br>
| status                 | PENDING_CREATE                       |<br>
| status_description     |                                      |<br>
| subnet_id              | e5a90ab2-918e-412b-9723-0d822804f022 |<br>
| tenant_id              | b1aaddea9f694e60aea5f1c0d1dd7c24     |<br>
| vip_id                 |                                      |<br>
+------------------------+--------------------------------------+</p>
<p>Next boot 2 instances in the same network</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ nova boot --flavor m1.tiny --image 6a3a7880-bc6f-454d-9a62-d9c2d268ef78 --security-groups default --nic net-id=daddce32-b6e8-4e3f-bd55-32459ed327ea WebServer1
[stack@localhost devstack]$ nova boot --flavor m1.tiny --image 6a3a7880-bc6f-454d-9a62-d9c2d268ef78 --security-groups default --nic net-id=daddce32-b6e8-4e3f-bd55-32459ed327ea WebServer2

[stack@localhost devstack]$ nova list
+--------------------------------------+------------+--------+------------+-------------+------------------+
| ID                                   | Name       | Status | Task State | Power State | Networks         |
+--------------------------------------+------------+--------+------------+-------------+------------------+
| c10e63c6-f342-4d1c-ae22-146c392ce398 | WebServer1 | BUILD  | spawning   | NOSTATE     | private=10.0.0.3 |
| ceef9e6b-6198-4118-8027-00898dee1abe | WebServer2 | BUILD  | spawning   | NOSTATE     | private=10.0.0.4 |
+--------------------------------------+------------+--------+------------+-------------+------------------+
</pre></div>


<p>Assign both instances to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-member-create --address 10.0.0.3 --protocol-port 80 LoadBalancerPool
Created a new member:
+--------------------+--------------------------------------+
| Field              | Value                                |
+--------------------+--------------------------------------+
| address            | 10.0.0.3                             |
| admin_state_up     | True                                 |
| id                 | a6de6bf0-3191-4721-aa01-5781ff05876e |
| pool_id            | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| protocol_port      | 80                                   |
| status             | PENDING_CREATE                       |
| status_description |                                      |
| tenant_id          | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| weight             | 1                                    |
+--------------------+--------------------------------------+

[stack@localhost devstack]$ neutron lb-member-create --address 10.0.0.4 --protocol-port 80 LoadBalancerPool
Created a new member:
+--------------------+--------------------------------------+
| Field              | Value                                |
+--------------------+--------------------------------------+
| address            | 10.0.0.4                             |
| admin_state_up     | True                                 |
| id                 | 9688a770-6494-4599-88fa-6afcd18c4dd1 |
| pool_id            | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| protocol_port      | 80                                   |
| status             | PENDING_CREATE                       |
| status_description |                                      |
| tenant_id          | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| weight             | 1                                    |
+--------------------+--------------------------------------+
</pre></div>


<p>Then create a Healthmonitor and associate it to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-healthmonitor-create --timeout 3 --max-retries 3 --delay 60 --type HTTP
Created a new health_monitor:
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| admin_state_up | True                                 |
| delay          | 60                                   |
| expected_codes | 200                                  |
| http_method    | GET                                  |
| id             | cb73f8fd-14ea-4937-aa10-019e3da8432f |
| max_retries    | 3                                    |
| pools          |                                      |
| tenant_id      | b1aaddea9f694e60aea5f1c0d1dd7c24     |
| timeout        | 3                                    |
| type           | HTTP                                 |
| url_path       | /                                    |
+----------------+--------------------------------------+
[stack@localhost devstack]$ neutron lb-healthmonitor-associate cb73f8fd-14ea-4937-aa10-019e3da8432f LoadBalancerPool
Associated health monitor cb73f8fd-14ea-4937-aa10-019e3da8432f
</pre></div>


<p>Create a VIP to the Pool</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron lb-vip-create --name LoadBalancerVIP --protocol-port 80 --protocol HTTP --subnet-id e5a90ab2-918e-412b-9723-0d822804f022 LoadBalancerPool
Created a new vip:
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| address             | 10.0.0.5                             |
| admin_state_up      | True                                 |
| connection_limit    | -1                                   |
| description         |                                      |
| id                  | 4e3c2b84-a286-4999-a258-51c44965a81a |
| name                | LoadBalancerVIP                      |
| pool_id             | 3eb0d41c-3df5-4beb-9758-ebfef56909df |
| port_id             | d4ed46ac-aabf-40b6-8f28-1a2013971391 |
| protocol            | HTTP                                 |
| protocol_port       | 80                                   |
| session_persistence |                                      |
| status              | PENDING_CREATE                       |
| status_description  |                                      |
| subnet_id           | e5a90ab2-918e-412b-9723-0d822804f022 |
| tenant_id           | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+---------------------+--------------------------------------+
</pre></div>


<p>Create a floating IP to the VIP</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron floatingip-create 23101147-e724-4574-82c7-a05ccb661d4d
Created a new floatingip:
+---------------------+--------------------------------------+
| Field               | Value                                |
+---------------------+--------------------------------------+
| fixed_ip_address    |                                      |
| floating_ip_address | 172.24.4.3                           |
| floating_network_id | 23101147-e724-4574-82c7-a05ccb661d4d |
| id                  | 62fbf609-77db-4471-b6ae-9fe25a091a21 |
| port_id             |                                      |
| router_id           |                                      |
| status              | DOWN                                 |
| tenant_id           | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+---------------------+--------------------------------------+
</pre></div>


<p>Associate the floating IP with the VIP port</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron floatingip-associate 62fbf609-77db-4471-b6ae-9fe25a091a21 d4ed46ac-aabf-40b6-8f28-1a2013971391
Associated floating IP 62fbf609-77db-4471-b6ae-9fe25a091a21
</pre></div>


<p>Create security rules to allow HTTP, SSH and ICMP traffic</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ neutron security-group-rule-create --protocol TCP --port-range-min 80 --port-range-max 80 be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | 4635cbb6-d939-40b3-ac11-637c8b63b027 |
| port_range_max    | 80                                   |
| port_range_min    | 80                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_prefix  |                                      |
| security_group_id | be0b2264-744a-48b8-9a1e-033227d78f2b |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+

[stack@localhost devstack]$ neutron security-group-rule-create --protocol icmp be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | 988329a1-d686-4541-8950-a22c721f847b |
| port_range_max    |                                      |
| port_range_min    |                                      |
| protocol          | icmp                                 |
| remote_group_id   |                                      |
| remote_ip_prefix  |                                      |
| security_group_id | be0b2264-744a-48b8-9a1e-033227d78f2b |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+

[stack@localhost devstack]$ neutron security-group-rule-create --protocol TCP --port-range-min 22 --port-range-max 22 be0b2264-744a-48b8-9a1e-033227d78f2b
Created a new security_group_rule:
+-------------------+--------------------------------------+
| Field             | Value                                |
+-------------------+--------------------------------------+
| direction         | ingress                              |
| ethertype         | IPv4                                 |
| id                | d18724dc-2eda-4031-be88-202a73c30c24 |
| port_range_max    | 22                                   |
| port_range_min    | 22                                   |
| protocol          | tcp                                  |
| remote_group_id   |                                      |
| remote_ip_pref                          |
| security_group_id | d7412bb3-9824-4eb7-bc4b-cd80ab6a570d |
| tenant_id         | b1aaddea9f694e60aea5f1c0d1dd7c24     |
+-------------------+--------------------------------------+
</pre></div>


<p>Login to both instances and run the command below to run a "webserver".</p>
<div class="highlight"><pre><span></span>[stack@localhost devstack]$ ssh cirros@INSTANCEIP
The authenticity of host &#39;10.0.0.3 (10.0.0.3)&#39; can&#39;t be established.
RSA key fingerprint is 94:00:8e:fe:9a:9d:af:ef:bc:e3:fd:9d:ad:d3:ab:a3.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#39;10.0.0.3&#39; (RSA) to the list of known hosts.

$ while true; do echo -e &#39;HTTP/1.0 200 OK \r\n\r\nServer1&#39; | sudo nc -l -p 80 ; done
$ while true; do echo -e &#39;HTTP/1.0 200 OK \r\n\r\nServer2&#39; | sudo nc -l -p 80 ; done
</pre></div>


<p>If we check with curl the VIP's floating IP, we'll see that in every
connection one of both servers reply with his name.</p>
<div class="highlight"><pre><span></span>[stack@localhost ~]$ curl http://172.24.4.3
Server1
[stack@localhost ~]$ curl http://172.24.4.3
Server2
[stack@localhost ~]$ curl http://172.24.4.3
Server1
[stack@localhost ~]$ curl http://172.24.4.3
Server2
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html">posted at 16:17</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/healthmonitor.html" class="tags">healthmonitor</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ip.html" class="tags">IP</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/lbaas.html" class="tags">lbaas</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/load-balancer-as-a-service.html" class="tags">load balancer as a service</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/member.html" class="tags">member</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/neutron.html" class="tags selected">neutron</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/pool.html" class="tags">pool</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/vip.html" class="tags">vip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/virtual.html" class="tags">virtual</a>
                </div>
		<a href="https://egonzalez90.github.io/load-balancer-as-a-service-lbaas.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Mar 09, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/delete-openstack-neutron-networks-solution-to-unable-to-complete-operation-on-subnet.html" rel="bookmark" title="Permanent Link to &quot;Delete openstack Neutron networks (Solution to: Unable to complete operation on subnet)&quot;">Delete openstack Neutron networks (Solution to: Unable to complete operation on subnet)</a>
                </h2>

                
                

                <div class="highlight"><pre><span></span>[root@rdoicehouse ~(keystone_admin)]# neutron router-list
+--------------------------------------+------------------+-----------------------------------------------------------------------------+
| id                                   | name             | external_gateway_info                                                       |
+--------------------------------------+------------------+-----------------------------------------------------------------------------+
| e34d94ad-7fe1-4704-8156-d255a2daa167 | demodeleterouter | {&quot;network_id&quot;: &quot;8b2ceda2-4d77-4c5c-ae21-6a7ba133e4fc&quot;, &quot;enable_snat&quot;: true} |
+--------------------------------------+------------------+-----------------------------------------------------------------------------+

[root@rdoicehouse ~(keystone_admin)]# neutron router-gateway-clear e34d94ad-7fe1-4704-8156-d255a2daa167
Removed gateway from router e34d94ad-7fe1-4704-8156-d255a2daa167

[root@rdoicehouse ~(keystone_admin)]# neutron router-port-list e34d94ad-7fe1-4704-8156-d255a2daa167

If Apply: 
          [[ neutron router-interface-delete &lt;router-id&gt; &lt;subnet-id&gt; ]]

[root@rdoicehouse ~(keystone_admin)]# neutron router-delete e34d94ad-7fe1-4704-8156-d255a2daa167
Deleted router: e34d94ad-7fe1-4704-8156-d255a2daa167

[root@rdoicehouse ~(keystone_admin)]# neutron subnet-list
+--------------------------------------+------------------+------------------+--------------------------------------------------------+
| id                                   | name             | cidr             | allocation_pools                                       |
+--------------------------------------+------------------+------------------+--------------------------------------------------------+
| d50e28f7-47ee-4bdf-8594-e1108f25586b | demosubnetdelete | 192.168.137.0/24 | {&quot;start&quot;: &quot;192.168.137.100&quot;, &quot;end&quot;: &quot;192.168.137.120&quot;} |
| c93fd5a7-d672-4b0c-8f2e-6e74f487e45d | private_subnet   | 10.0.0.0/24      | {&quot;start&quot;: &quot;10.0.0.2&quot;, &quot;end&quot;: &quot;10.0.0.254&quot;}             |
+--------------------------------------+------------------+------------------+--------------------------------------------------------+
[root@rdoicehouse ~(keystone_admin)]# neutron subnet-delete d50e28f7-47ee-4bdf-8594-e1108f25586b
409-{u&#39;NeutronError&#39;: {u&#39;message&#39;: u&#39;Unable to complete operation on subnet d50e28f7-47ee-4bdf-8594-e1108f25586b. One or more ports have an IP allocation from this subnet.&#39;, u&#39;type&#39;: u&#39;SubnetInUse&#39;, u&#39;detail&#39;: u&#39;&#39;}}

[root@rdoicehouse ~(keystone_admin)]# neutron port-list
+--------------------------------------+------+-------------------+----------------------------------------------------------------------------------------+
| id                                   | name | mac_address       | fixed_ips                                                                              |
+--------------------------------------+------+-------------------+----------------------------------------------------------------------------------------+
| 4655e13a-9767-4750-8f44-4eee8410ca70 |      | fa:16:3e:03:c7:cf | {&quot;subnet_id&quot;: &quot;d50e28f7-47ee-4bdf-8594-e1108f25586b&quot;, &quot;ip_address&quot;: &quot;192.168.137.103&quot;} |
| 767f2f83-f99a-46d1-b2c2-2e47bae4bb90 |      | fa:16:3e:ff:94:28 | {&quot;subnet_id&quot;: &quot;d50e28f7-47ee-4bdf-8594-e1108f25586b&quot;, &quot;ip_address&quot;: &quot;192.168.137.102&quot;} |
+--------------------------------------+------+-------------------+----------------------------------------------------------------------------------------+

[root@rdoicehouse ~(keystone_admin)]# neutron port-delete 767f2f83-f99a-46d1-b2c2-2e47bae4bb90
Deleted port: 767f2f83-f99a-46d1-b2c2-2e47bae4bb90

[root@rdoicehouse ~(keystone_admin)]# neutron port-delete 4655e13a-9767-4750-8f44-4eee8410ca70
409-{u&#39;NeutronError&#39;: {u&#39;message&#39;: u&#39;Port 4655e13a-9767-4750-8f44-4eee8410ca70 has owner network:floatingip and therefore cannot be deleted directly via the port API.&#39;, u&#39;type&#39;: u&#39;L3PortInUse&#39;, u&#39;detail&#39;: u&#39;&#39;}}

[root@rdoicehouse ~(keystone_admin)]# neutron floatingip-list
+--------------------------------------+------------------+---------------------+---------+
| id                                   | fixed_ip_address | floating_ip_address | port_id |
+--------------------------------------+------------------+---------------------+---------+
| 0a74679b-b469-4ae5-97a0-08c3aeeb2129 |                  | 192.168.137.103     |         |
+--------------------------------------+------------------+---------------------+---------+

[root@rdoicehouse ~(keystone_admin)]# neutron floatingip-delete 0a74679b-b469-4ae5-97a0-08c3aeeb2129
Deleted floatingip: 0a74679b-b469-4ae5-97a0-08c3aeeb2129

[root@rdoicehouse ~(keystone_admin)]# neutron port-list

[root@rdoicehouse ~(keystone_admin)]# neutron subnet-delete d50e28f7-47ee-4bdf-8594-e1108f25586b
Deleted subnet: d50e28f7-47ee-4bdf-8594-e1108f25586b

[root@rdoicehouse ~(keystone_admin)]# neutron net-list
+--------------------------------------+------------+--------------------------------------------------+
| id                                   | name       | subnets                                          |
+--------------------------------------+------------+--------------------------------------------------+
| 77dd5a93-b63e-44be-84d6-f6ef4fd8771b | private    | c93fd5a7-d672-4b0c-8f2e-6e74f487e45d 10.0.0.0/24 |
| 8b2ceda2-4d77-4c5c-ae21-6a7ba133e4fc | demodelete |                                                  |
+--------------------------------------+------------+--------------------------------------------------+
[root@rdoicehouse ~(keystone_admin)]# neutron net-delete 8b2ceda2-4d77-4c5c-ae21-6a7ba133e4fc
Deleted network: 8b2ceda2-4d77-4c5c-ae21-6a7ba133e4fc
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/delete-openstack-neutron-networks-solution-to-unable-to-complete-operation-on-subnet.html">posted at 16:58</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/cannot-be-deleted-directly-via-the-port-api.html" class="tags">cannot be deleted directly via the port API</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/delete.html" class="tags">delete</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/error.html" class="tags">error</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/floatingip.html" class="tags">floatingip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/guide.html" class="tags">guide</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/has-owner-networkfloatingip.html" class="tags">has owner network:floatingip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/net.html" class="tags">net</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/network.html" class="tags">network</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/neutron.html" class="tags selected">neutron</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/port.html" class="tags">port</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/router.html" class="tags">router</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/solution.html" class="tags">solution</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/step-by-step.html" class="tags">step by step</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/subnet.html" class="tags">subnet</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/unable-to-complete-operation-on-subnet.html" class="tags">Unable to complete operation on subnet</a>
                </div>
		<a href="https://egonzalez90.github.io/delete-openstack-neutron-networks-solution-to-unable-to-complete-operation-on-subnet.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/2" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 2</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>