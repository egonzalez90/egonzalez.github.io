<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles tagged "rdo" | Page 3</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/tag/rdo3.html">rdo</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Jan 27, 2016</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html" rel="bookmark" title="Permanent Link to &quot;Configure Neutron DVR OpenStack Liberty&quot;">Configure Neutron DVR OpenStack Liberty</a>
                </h2>

                
                

                <p>Distributed Virtual Routers aka DVR were created to avoid single point
of failure on neutron nodes.<br>
When using standard routers, all the traffic is passing out through
Neutron servers. Inside network servers, router namespaces are created
routing all traffic and NAT forwarding between instances and public
networks. When a network node falls down, instance traffic will no
longer be available until a new namespace is created and executed in
another network node.<br>
Distributed routers is a way to avoid the SPOF neutron nodes were. When
using DVR, router namespaces, are directly created inside compute nodes
where all instance and l3 traffic are routed.</p>
<p>If you want to know more about DVR check this awesome links:  </p>
<p><a href="http://blog.gampel.net/2014/12/openstack-neutron-distributed-virtual.html">http://blog.gampel.net/2014/12/openstack-neutron-distributed-virtual.html</a><br>
<a href="http://blog.gampel.net/2014/12/openstack-dvr2-floating-ips.html">http://blog.gampel.net/2014/12/openstack-dvr2-floating-ips.html</a><br>
<a href="http://blog.gampel.net/2015/01/openstack-DVR-SNAT.html">http://blog.gampel.net/2015/01/openstack-DVR-SNAT.html</a></p>
<p>A previous OpenStack Liberty installation is required, mine was done
with RDO packstack.</p>
<p><strong><ins datetime="2016-01-27T18:47:58+00:00">Configure all Neutron
Servers</ins></strong></p>
<p>Edit ml2 configuration file with the following:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/ml2_conf.ini

mechanism_drivers = openvswitch,l2population
type_drivers = flat,vlan,vxlan
tenant_network_types = vxlan
vni_ranges = 10:100
vxlan_group = 224.1.1.1
enable_security_group = True
</pre></div>


<p>Edit neutron configuration file, enable DVR and uncomment dvr_base_mac
option</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/neutron.conf

router_distributed = True
dvr_base_mac = fa:16:3f:00:00:00
</pre></div>


<p>Configure l3 agent to use dvr_snat</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/l3_agent.ini

agent_mode = dvr_snat
</pre></div>


<p>Restart neutron server</p>
<div class="highlight"><pre><span></span>systemctl restart neutron-server
</pre></div>


<p><strong><ins datetime="2016-01-27T18:47:58+00:00">Configure all Compute
Nodes</ins></strong></p>
<p>Install ml2 package</p>
<div class="highlight"><pre><span></span>yum install openstack-neutron-ml2
</pre></div>


<p>Edit openvswitch agent file as below:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/openvswitch_agent.ini

l2_population = True
arp_responder = True
enable_distributed_routing = True
</pre></div>


<p>Enable DVR and select an interface driver to be used by l3 agent</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/l3_agent.ini

interface_driver = neutron.agent.linux.interface.OVSInterfaceDriver
agent_mode = dvr
</pre></div>


<p>Edit ml2 configuration file as below:</p>
<div class="highlight"><pre><span></span># vi /etc/neutron/plugins/ml2/ml2_conf.ini

type_drivers = flat,vlan,vxlan
tenant_network_types = vxlan
mechanism_drivers = openvswitch,l2population
vni_ranges = 10:100
vxlan_group = 224.1.1.1
enable_security_group = True
</pre></div>


<p>Start and enable metadata agent in compute nodes</p>
<div class="highlight"><pre><span></span>systemctl start neutron-l3-agent neutron-metadata-agent
systemctl enable neutron-l3-agent neutron-metadata-agent
</pre></div>


<p>Create an external bridge with an external IP associated on it</p>
<div class="highlight"><pre><span></span># vi /etc/sysconfig/network-scripts/ifcfg-br-ex

DEVICE=br-ex
DEVICETYPE=ovs
TYPE=OVSBridge
BOOTPROTO=static
IPADDR=192.168.100.4                                                          
NETMASK=255.255.255.0
GATEWAY=192.168.100.1
ONBOOT=yes
</pre></div>


<p>Modify an unused interface connected with the same network as the IP
configured with br-ex, edit the interface to be used as OVS port by
br-ex</p>
<div class="highlight"><pre><span></span># vi /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
TYPE=OVSPort
DEVICETYPE=ovs
OVS_BRIDGE=br-ex
ONBOOT=yes
</pre></div>


<p>Restart network service to apply changes on the interfaces and
openvswith-agent</p>
<div class="highlight"><pre><span></span>systemctl restart network
systemctl restart neutron-openvswitch-agent
</pre></div>


<p>Create an external network and a subnet on it</p>
<div class="highlight"><pre><span></span>neutron net-create external_network --provider:network_type flat --provider:physical_network extnet  --router:external --shared
neutron subnet-create --name public_subnet --enable_dhcp=False --allocation-pool=start=192.168.100.100,end=192.168.100.150 --gateway=192.168.100.1 external_network 192.168.100.0/24
</pre></div>


<p>Create a router and associate external network as router gateway</p>
<div class="highlight"><pre><span></span>neutron router-create router1
neutron router-gateway-set router1 external_network
</pre></div>


<p>Create an internal network, a subnet and associate an interface to the
router</p>
<div class="highlight"><pre><span></span>neutron net-create private_network
neutron subnet-create --name private_subnet private_network 10.0.1.0/24
neutron router-interface-add router1 private_subnet
</pre></div>


<p>Boot 2 instances</p>
<div class="highlight"><pre><span></span>nova boot --flavor m1.tiny --image cirros --nic net-id=154da7a8-fa49-415e-9d35-c840b144a8df test1
nova boot --flavor m1.tiny --image cirros --nic net-id=154da7a8-fa49-415e-9d35-c840b144a8df test2
</pre></div>


<p>Create 2 floating ips and associate it to instances</p>
<div class="highlight"><pre><span></span>neutron floatingip-create external_network
neutron floatingip-create external_network
nova floating-ip-associate test1 192.168.100.101
nova floating-ip-associate test2 192.168.100.102
</pre></div>


<p>Test if all works as expected pinging floating ips</p>
<div class="highlight"><pre><span></span># ping 192.168.100.101
# ping 192.168.100.102
</pre></div>


<p>As you can see, in network nodes, a snat namespace is created</p>
<div class="highlight"><pre><span></span># sudo ip netns
qdhcp-154da7a8-fa49-415e-9d35-c840b144a8df
snat-77fef58a-6d0c-4e96-b4b6-5d8e81ebead3
</pre></div>


<p>In compute nodes, a fip namespace per instance with floating ip
associated running on the compute node are created and a qrouter
namespace are created.</p>
<div class="highlight"><pre><span></span># sudo ip netns
fip-4dfdabb0-d2d6-4d4a-8c00-84df834eec8b
qrouter-77fef58a-6d0c-4e96-b4b6-5d8e81ebead3
</pre></div>


<p>Best regards, Eduardo Gonzalez</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html">posted at 20:13</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/-configure.html" class="tags">--configure</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/distributed.html" class="tags">distributed</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/dvr.html" class="tags">dvr</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/fip.html" class="tags">fip</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/l3.html" class="tags">l3</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/liberty.html" class="tags">liberty</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/neutron.html" class="tags">neutron</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/packstack.html" class="tags">packstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/qrouter.html" class="tags">qrouter</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rdo.html" class="tags selected">rdo</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/routers.html" class="tags">routers</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/snat.html" class="tags">snat</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/virtual.html" class="tags">virtual</a>
                </div>
		<a href="https://egonzalez90.github.io/configure-neutron-dvr-openstack-liberty.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Dec 23, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/nova-docker-driver.html" rel="bookmark" title="Permanent Link to &quot;Nova Docker driver&quot;">Nova Docker driver</a>
                </h2>

                
                

                <p>Cloud computing has evolved too fast over the last years, currently is a
totally different thing as the 5 years ago cloud, today is a common
thing listening words like containers, instances, microservices, queue
messages on linkedin, twitter, etc.</p>
<p>OpenStack is not a lazy community, new capabilities are daily added to
the OpenStack catalog reaching more users and business needs who are
discovered at the several summits and meetups over the world. One of
that needs is the capability to easy create and manage docker
containers.<br>
Now we have two main methods, directly launching instances as
containers from nova driver or with heat/kubernetes/messos.<br>
The second method is the one with more followers, but there are some
projects which are using nova driver as Solum, for this reason i'm going
to show you how to configure docker as nova driver.</p>
<p>The fist step is install docker on the compute nodes</p>
<div class="highlight"><pre><span></span>curl -sSL https://get.docker.com/ | sh

+ sh -c &#39;sleep 3; yum -y -q install docker-engine&#39;
advertencia:/var/cache/yum/x86_64/7/docker-main-repo/packages/docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm: EncabezadoV4 RSA/SHA512 Signature, ID de clave 2c52609d: NOKEY
No se ha instalado la llave pública de docker-engine-selinux-1.9.1-1.el7.centos.noarch.rpm
Importando llave GPG 0x2C52609D:
Usuarioid  : &quot;Docker Release Tool (releasedocker) &lt;docker@docker.com&gt;&quot;
Huella       : 5811 8e89 f3a9 1289 7c07 0adb f762 2157 2c52 609d
Desde      : https://yum.dockerproject.org/gpg
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532228].
Full path required for exclude: net:[4026532285].
Full path required for exclude: net:[4026532285].
</pre></div>


<p>Add nova user to docker group, docker group will be created during
docker installation</p>
<div class="highlight"><pre><span></span>usermod -aG docker nova
</pre></div>


<p>Start docker service</p>
<div class="highlight"><pre><span></span>sudo systemctl start docker
</pre></div>


<p>Test docker installation with the following command, a Hello from Docker
message should be prompted</p>
<div class="highlight"><pre><span></span>sudo docker run hello-world

Unable to find image &#39;hello-world:latest&#39; locally
latest: Pulling from library/hello-world
b901d36b6f2f: Pull complete
0a6ba66e537a: Pull complete
Digest: sha256:8be990ef2aeb16dbcb9271ddfe2610fa6658d13f6dfb8bc72074cc1ca36966a7
Status: Downloaded newer image for hello-world:latest

Hello from Docker.
This message shows that your installation appears to be working correctly.
</pre></div>


<p>Once docker runs in a proper way, enable docker service at boot</p>
<div class="highlight"><pre><span></span>sudo systemctl enable docker
ln -s &#39;/usr/lib/systemd/system/docker.service&#39; &#39;/etc/systemd/system/multi-user.target.wants/docker.service&#39;
</pre></div>


<p>Give docker socket the apropiate permissions</p>
<div class="highlight"><pre><span></span>chmod 666  /var/run/docker.sock
</pre></div>


<p>Restart nova-compute service</p>
<div class="highlight"><pre><span></span>systemctl restart openstack-nova-compute
</pre></div>


<p>Install git and pip if not present on the system</p>
<div class="highlight"><pre><span></span>sudo yum install -y git
sudo easy_install pip
</pre></div>


<p>Clone docker driver for nova from OpenStack repositories</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty https://github.com/openstack/nova-docker
</pre></div>


<p>Install basic requirements</p>
<div class="highlight"><pre><span></span>cd nova-docker
sudo  pip install -r requirements.txt
</pre></div>


<p>Install docker driver</p>
<div class="highlight"><pre><span></span>python setup.py install
</pre></div>


<p>Edit nova.conf and allow docker driver as compute driver</p>
<div class="highlight"><pre><span></span>vi /etc/nova/nova.conf
compute_driver=novadocker.virt.docker.DockerDriver
</pre></div>


<p>Create the following directory</p>
<div class="highlight"><pre><span></span>mkdir /etc/nova/rootwrap.d
</pre></div>


<p>Create a file with the following content to allow setting networking in
docker containers</p>
<div class="highlight"><pre><span></span>vi /etc/nova/rootwrap.d/docker.filters

[Filters]
# nova/virt/docker/driver.py: &#39;ln&#39;, &#39;-sf&#39;, &#39;/var/run/netns/.*&#39;
ln: CommandFilter, /bin/ln, root
</pre></div>


<p>Edit glance-api.conf and allow docker as container format</p>
<div class="highlight"><pre><span></span>vi /etc/glance/glance-api.conf
container_formats=ami,ari,aki,bare,ovf,ova,docker
</pre></div>


<p>Restart glance-api to apply changes</p>
<div class="highlight"><pre><span></span>systemctl restart openstack-glance-api
</pre></div>


<p>Pull a docker image, i use hipache as testing image</p>
<div class="highlight"><pre><span></span>docker pull hipache

Using default tag: latest
latest: Pulling from library/hipache
0a85502c06c9: Pull complete
0998bf8fb9e9: Pull complete
a6785352b25c: Pull complete
e9ae3c220b23: Pull complete
84d61e35041c: Pull complete
0fd25fcc737a: Pull complete
c0af65e2f918: Pull complete
dc335e9e58f4: Pull complete
7245129ed8a4: Pull complete
52a015bc8761: Pull complete
d38065541924: Pull complete
0b8658d6c429: Pull complete
188468e0ae8d: Pull complete
741abf992884: Pull complete
Digest: sha256:7774cf9155a8cc83b6964c7ea0d655143c152debc6d11d4f6dfa918c7a7ea099
Status: Downloaded newer image for hipache:latest
</pre></div>


<p>Upload the image to glance</p>
<div class="highlight"><pre><span></span>docker save hipache | openstack image create hipache --public --container-format docker --disk-format raw

+------------------+------------------------------------------------------+
| Field            | Value                                                |
+------------------+------------------------------------------------------+
| checksum         | e93b7c1ddeb2d38419bf44aaf07cc811                     |
| container_format | docker                                               |
| created_at       | 2015-12-18T10:06:31Z                                 |
| disk_format      | raw                                                  |
| file             | /v2/images/7f05f7d6-88af-4d0f-adad-66ca025404fa/file |
| id               | 7f05f7d6-88af-4d0f-adad-66ca025404fa                 |
| min_disk         | 0                                                    |
| min_ram          | 0                                                    |
| name             | hipache                                              |
| owner            | 74675bfffc3c4e1a9d9fb2f1388217d4                     |
| protected        | False                                                |
| schema           | /v2/schemas/image                                    |
| size             | 384304640                                            |
| status           | active                                               |
| updated_at       | 2015-12-18T10:07:03Z                                 |
| virtual_size     | None                                                 |
| visibility       | public                                               |
+------------------+------------------------------------------------------+
</pre></div>


<p>Once the image is active at glance, create a new instance, the instance
won't be a KVM virtual machine, now will be a docker container</p>
<div class="highlight"><pre><span></span>nova boot --flavor m1.tiny --image hipache --nic net-id=a1aa6336-9ae2-4ffb-99f5-1b6d1130989c --key-name mykey test1
</pre></div>


<p>After a while, the instance should be in ACTIVE state</p>
<div class="highlight"><pre><span></span>watch nova list
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
| ID                                   | Name  | Status | Task State | Power State | Networks                    |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
| fb192405-4150-4c2d-98ad-316141f48cc5 | test1 | ACTIVE | -          | Running     | private_network=192.168.1.3 |
+--------------------------------------+-------+--------+------------+-------------+-----------------------------+
</pre></div>


<p>If all the steps worked fine, you can use docker as nova backend.<br>
Regards</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/nova-docker-driver.html">posted at 18:31</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/-configure.html" class="tags">--configure</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/centos.html" class="tags">centos</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/container.html" class="tags">container</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/docker.html" class="tags">docker</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/driver.html" class="tags">driver</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance.html" class="tags">glance</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/install.html" class="tags">install</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instance.html" class="tags">instance</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/nova.html" class="tags">nova</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rdo.html" class="tags selected">rdo</a>
                </div>
		<a href="https://egonzalez90.github.io/nova-docker-driver.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Dec 14, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html" rel="bookmark" title="Permanent Link to &quot;Murano in RDO OpenStack - Manual Installation&quot;">Murano in RDO OpenStack - Manual Installation</a>
                </h2>

                
                

                <p>Want to install and use Murano in a RDO OpenStack environment? Here are
the steps to do it.</p>
<p>The first thing we need to do, is to know what is Murano:<br>
Murano is an application catalog who gives the users the capacity to
launch pre-configured s/instances/jobs/g with apps in an OpenStack
infrastructure.<br>
As the final user just select an application from a catalog with a
minimal configuration, and Murano will take the role to orchestrate the
background jobs(create instances, configure apps, connect networks,
etc)<br>
For more information about application catalog project refer to this
site:<br>
<a href="https://wiki.openstack.org/wiki/Murano/ApplicationCatalog">https://wiki.openstack.org/wiki/Murano/ApplicationCatalog</a></p>
<p>At this tutorial, i will use the following s/configurations/versions/g:</p>
<ul>
<li>Centos 7.1</li>
<li>RDO Liberty release</li>
<li>Hosts installed with packstack/ML2 network</li>
</ul>
<p>Let's start installing some pre requisites</p>
<div class="highlight"><pre><span></span>sudo yum install -y gcc python-setuptools python-devel git postgresql-devel libffi-devel openssl-devel
</pre></div>


<p>Install pip</p>
<div class="highlight"><pre><span></span>sudo easy_install pip
</pre></div>


<p>Install tox and upgrade six</p>
<div class="highlight"><pre><span></span>sudo pip install tox
sudo pip install --upgrade six
</pre></div>


<p>Create a database for murano</p>
<div class="highlight"><pre><span></span>mysql -u root -p
CREATE DATABASE murano;
</pre></div>


<p>Create murano user at MySQL</p>
<div class="highlight"><pre><span></span>GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
GRANT ALL PRIVILEGES ON murano.* TO &#39;murano&#39;@&#39;%&#39; IDENTIFIED BY &#39;MURANODB_PASS&#39;;
</pre></div>


<p>Clone murano from liberty/stable branch</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano
</pre></div>


<p>Install all requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano/
sudo  pip install -r requirements.txt
</pre></div>


<p>Install murano</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Create sample configuration file</p>
<div class="highlight"><pre><span></span>oslo-config-generator --config-file etc/oslo-config-generator/murano.conf
</pre></div>


<p>Create murano directory and copy the sample content on it</p>
<div class="highlight"><pre><span></span>mkdir /etc/murano
cp ~/murano/etc/murano/* /etc/murano/
</pre></div>


<p>Rename sample configuration to murano.conf</p>
<div class="highlight"><pre><span></span>mv /etc/murano/murano.conf.sample /etc/murano/murano.conf
</pre></div>


<p>Edit the configuration file like this, adjust the configuration as your
environment needs.<br>
<code>vi /etc/murano/murano.conf</code></p>
<div class="highlight"><pre><span></span><span class="k">[oslo_messaging_rabbit]</span>

<span class="na">rabbit_host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">rabbit_port</span><span class="o">=</span><span class="s">5672</span>
<span class="na">rabbit_hosts</span><span class="o">=</span><span class="s">RABBITMQ_IP:5672</span>
<span class="na">rabbit_use_ssl</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_userid</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">rabbit_virtual_host</span><span class="o">=</span><span class="s">/</span>
<span class="na">rabbit_ha_queues</span><span class="o">=</span><span class="s">False</span>
<span class="na">rabbit_notification_exchange</span><span class="o">=</span><span class="s">openstack</span>
<span class="na">rabbit_notification_topic</span><span class="o">=</span><span class="s">notifications</span>

<span class="k">[database]</span>
<span class="na">connection</span> <span class="o">=</span> <span class="s">mysql://murano:MURANODB_PASS@MYSQL_IP/murano</span>

<span class="k">[keystone_authtoken]</span>
<span class="na">auth_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:5000/v2.0</span>
<span class="na">identity_uri</span><span class="o">=</span><span class="s">http://KEYSTONE_IP:35357</span>
<span class="na">admin_user</span><span class="o">=</span><span class="s">murano</span>
<span class="na">admin_password</span><span class="o">=</span><span class="s">MURANO_PASS</span>
<span class="na">admin_tenant_name</span><span class="o">=</span><span class="s">services</span>

<span class="k">[murano]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">http://MURANO_IP:8082</span>

<span class="k">[rabbitmq]</span>

<span class="na">host</span><span class="o">=</span><span class="s">RABBITMQ_IP</span>
<span class="na">login</span><span class="o">=</span><span class="s">guest</span>
<span class="na">password</span><span class="o">=</span><span class="s">guest</span>
<span class="na">virtual_host</span><span class="o">=</span><span class="s">/</span>
</pre></div>


<p>Create murano user</p>
<div class="highlight"><pre><span></span>openstack user create --password MURANO_PASS murano
</pre></div>


<p>Add murano user to services tenant with admin privileges</p>
<div class="highlight"><pre><span></span>openstack role add --project services --user murano admin
</pre></div>


<p>Create a service for application-catalog</p>
<div class="highlight"><pre><span></span>openstack service create --name muranoapi --description &quot;Murano Project&quot; application-catalog
</pre></div>


<p>Associate an endpoint to application-catalog service</p>
<div class="highlight"><pre><span></span>openstack endpoint create --region RegionOne --publicurl &#39;http://MURANO_IP:8082/&#39; --adminurl &#39;http://MURANO_IP:8082/&#39; --internalurl &#39;http://http://MURANO_IP:8082/&#39; MURANO_SERVICE_ID
</pre></div>


<p>Sync the database</p>
<div class="highlight"><pre><span></span>murano-db-manage --config-file /etc/murano/murano.conf upgrade
</pre></div>


<p>Open a new terminal and start murano-api service</p>
<div class="highlight"><pre><span></span>murano-api --config-file /etc/murano/murano.conf
</pre></div>


<p>Import base murano package</p>
<div class="highlight"><pre><span></span>murano-manage --config-file /etc/murano/murano.conf import-package murano/meta/io.murano
</pre></div>


<p>In a new terminal, start murano-engine service</p>
<div class="highlight"><pre><span></span>murano-engine --config-file /etc/murano/murano.conf
</pre></div>


<p>Clone stable liberty module for horizon</p>
<div class="highlight"><pre><span></span>git clone -b stable/liberty git://git.openstack.org/openstack/murano-dashboard
</pre></div>


<p>Install base requirements</p>
<div class="highlight"><pre><span></span>cd ~/murano-dashboard
pip install -r requirements.txt
</pre></div>


<p>Install murano-dashboard module</p>
<div class="highlight"><pre><span></span>sudo python setup.py install
</pre></div>


<p>Enable murano-dashboard at horizon</p>
<div class="highlight"><pre><span></span>cp muranodashboard/local/_50_murano.py /usr/share/openstack-dashboard/openstack_dashboard/enabled/
</pre></div>


<p>Restart apache to apply changes</p>
<div class="highlight"><pre><span></span>systemctl restart httpd
</pre></div>


<p>Import ApacheHttpServer package</p>
<div class="highlight"><pre><span></span><span class="n">murano</span> <span class="o">--</span><span class="n">murano</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://storage.apps.openstack.org/&quot;</span> <span class="n">package</span><span class="o">-</span><span class="kn">import</span> <span class="nn">io.murano.apps.apache.ApacheHttpServer</span>
</pre></div>


<p>You can find more packages at:
<a href="http://apps.openstack.org/#tab=murano-apps">http://apps.openstack.org/#tab=murano-apps</a></p>
<p>This will add a Debian image to glance image service, wait until the
image is in active status</p>
<p>Create a file with the following content, modify the variables with your
own needs<br>
<code>vi object_model_patch.json</code></p>
<div class="highlight"><pre><span></span>[
    { &quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/-&quot;, &quot;value&quot;:
        {
            &quot;instance&quot;: {
                &quot;availabilityZone&quot;: &quot;nova&quot;,
                &quot;name&quot;: &quot;APP_NAME&quot;,
                &quot;image&quot;: &quot;GLANCE_IMAGE_ID&quot;,
                &quot;keyname&quot;: &quot;KEY_PAIR&quot;,
                &quot;flavor&quot;: &quot;FLAVOR&quot;,
                &quot;assignFloatingIp&quot;: false,
                &quot;?&quot;: {
                    &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,
                    &quot;id&quot;: &quot;===id1===&quot;
                }
            },
            &quot;name&quot;: &quot;ApacheHttpServer&quot;,
            &quot;enablePHP&quot;: true,
            &quot;?&quot;: {
                &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,
                &quot;id&quot;: &quot;===id2===&quot;
            }
        }
    }
]
</pre></div>


<p>Create an environment</p>
<div class="highlight"><pre><span></span>murano environment-create --join-subnet-id SUBNET_ID ENVIRONMENT_NAME

murano environment-create --join-subnet-id e2c5175a-d5bc-4eb7-91ba-67ac9120c64a test
+----------------------------------+------+---------------------+---------------------+
| ID                               | Name | Created             | Updated             |
+----------------------------------+------+---------------------+---------------------+
| 68a19d233d2d42459faf64d375d995e5 | test | 2015-12-11T13:09:57 | 2015-12-11T13:09:57 |
+----------------------------------+------+---------------------+---------------------+
</pre></div>


<p>Create a session for temporal working on the environment</p>
<div class="highlight"><pre><span></span>murano environment-session-create ENVIRONMENT_ID

murano environment-session-create 68a19d233d2d42459faf64d375d995e5
Created new session:
+----------+----------------------------------+
| Property | Value                            |
+----------+----------------------------------+
| id       | b0f5e39a9c4c419c9ee7fdb6c92c37a6 |
+----------+----------------------------------+
</pre></div>


<p>Add the file with the apps configuration</p>
<div class="highlight"><pre><span></span>murano environment-apps-edit --session-id SESSION_ID ENVIRONMENT_ID FILE_NAME

murano environment-apps-edit --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6 68a19d233d2d42459faf64d375d995e5 object_model_patch.json
</pre></div>


<p>Deploy the environment</p>
<div class="highlight"><pre><span></span>murano environment-deploy ENVIRONMENT_ID --session-id SESSION_ID

murano environment-deploy 68a19d233d2d42459faf64d375d995e5 --session-id b0f5e39a9c4c419c9ee7fdb6c92c37a6
+-----------+-------------------------------------------------------------+
| Property  | Value                                                       |
+-----------+-------------------------------------------------------------+
| created   | 2015-12-11T13:09:57                                         |
| id        | 68a19d233d2d42459faf64d375d995e5                            |
| name      | test                                                        |
| services  | [                                                           |
|           |   {                                                         |
|           |     &quot;instance&quot;: {                                           |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                           |
|           |       &quot;name&quot;: &quot;test&quot;,                                       |
|           |       &quot;assignFloatingIp&quot;: false,                            |
|           |       &quot;keyname&quot;: &quot;&quot;,                                        |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                    |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,      |
|           |       &quot;?&quot;: {                                                |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,  |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;            |
|           |       }                                                     |
|           |     },                                                      |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                             |
|           |     &quot;enablePHP&quot;: true,                                      |
|           |     &quot;?&quot;: {                                                  |
|           |       &quot;status&quot;: &quot;deploying&quot;,                                |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,     |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;              |
|           |     }                                                       |
|           |   }                                                         |
|           | ]                                                           |
| status    | deploying                                                   |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                            |
| updated   | 2015-12-11T13:09:57                                         |
| version   | 0                                                           |
+-----------+-------------------------------------------------------------+
</pre></div>


<p>Now, you can check at nova the building status of the instances</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | BUILD  | scheduling | NOSTATE     |          |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+----------+
</pre></div>


<p>After a while, the instance is up and running</p>
<div class="highlight"><pre><span></span>nova list
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| ID                                   | Name                                    | Status | Task State | Power State | Networks         |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
| a68cedfb-7b4c-47a6-96fb-6b64a85a8ca6 | murano-mmnpdii1ozz7r2-test-5np5cvfeoiyh | ACTIVE | -          | Running     | private=10.0.0.8 |
+--------------------------------------+-----------------------------------------+--------+------------+-------------+------------------+
</pre></div>


<p>Once the instance is active, murano will configure the application
inside, wait until the status is ready.</p>
<div class="highlight"><pre><span></span>murano environment-show f392de2004e24ff7b2a08f05df0599b8
+-----------+---------------------------------------------------------------+
| Property  | Value                                                         |
+-----------+---------------------------------------------------------------+
| created   | 2015-12-11T13:43:23                                           |
| id        | 68a19d233d2d42459faf64d375d995e5                              |
| name      | test                                                          |
| services  | [                                                             |
|           |   {                                                           |
|           |     &quot;instance&quot;: {                                             |
|           |       &quot;availabilityZone&quot;: &quot;nova&quot;,                             |
|           |       &quot;openstackId&quot;: &quot;91615340-e1d3-428e-848f-38a762004d33&quot;,  |
|           |       &quot;name&quot;: &quot;test&quot;,                                         |
|           |       &quot;securityGroupName&quot;: null,                              |
|           |       &quot;image&quot;: &quot;9049eb0c-081e-4d56-9413-72fdc6f8d8bf&quot;,        |
|           |       &quot;assignFloatingIp&quot;: false,                              |
|           |       &quot;floatingIpAddress&quot;: null,                              |
|           |       &quot;keyname&quot;: &quot;&quot;,                                          |
|           |       &quot;?&quot;: {                                                  |
|           |         &quot;classVersion&quot;: &quot;0.0.0&quot;,                              |
|           |         &quot;name&quot;: null,                                         |
|           |         &quot;package&quot;: &quot;io.murano&quot;,                               |
|           |         &quot;type&quot;: &quot;io.murano.resources.LinuxMuranoInstance&quot;,    |
|           |         &quot;_actions&quot;: {},                                       |
|           |         &quot;id&quot;: &quot;30f5a591a58a468fbf4d7ef4755e0512&quot;              |
|           |       },                                                      |
|           |       &quot;ipAddresses&quot;: [                                        |
|           |         &quot;10.0.0.8&quot;                                            |
|           |       ],                                                      |
|           |       &quot;flavor&quot;: &quot;twogb&quot;,                                      |
|           |       &quot;networks&quot;: {                                           |
|           |         &quot;useFlatNetwork&quot;: false,                              |
|           |         &quot;primaryNetwork&quot;: null,                               |
|           |         &quot;useEnvironmentNetwork&quot;: true,                        |
|           |         &quot;customNetworks&quot;: []                                  |
|           |       },                                                      |
|           |       &quot;sharedIps&quot;: []                                         |
|           |     },                                                        |
|           |     &quot;name&quot;: &quot;ApacheHttpServer&quot;,                               |
|           |     &quot;?&quot;: {                                                    |
|           |       &quot;classVersion&quot;: &quot;0.0.0&quot;,                                |
|           |       &quot;status&quot;: &quot;ready&quot;,                                      |
|           |       &quot;name&quot;: null,                                           |
|           |       &quot;package&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,    |
|           |       &quot;type&quot;: &quot;io.murano.apps.apache.ApacheHttpServer&quot;,       |
|           |       &quot;_actions&quot;: {},                                         |
|           |       &quot;id&quot;: &quot;98b994565c634f7e97d5f365203ce222&quot;                |
|           |     },                                                        |
|           |     &quot;enablePHP&quot;: true                                         |
|           |   }                                                           |
|           | ]                                                             |
| status    | ready                                                         |
| tenant_id | 3a5d50fac9a3462fa4d76b8b84677c3f                              |
| updated   | 2015-12-11T13:47:35                                           |
| version   | 1                                                             |
+-----------+---------------------------------------------------------------+
</pre></div>


<p>That's all you need to have up and running a Murano application catalog,
for now there is no rpm package to ease the installation, so you need to
install from source like we done.<br>
A thing you can do, is create systemd files to manage murano services
in a easier way.</p>
<p>Regards, Eduardo Gonzalez</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html">posted at 20:04</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/app.html" class="tags">app</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/application-catalog.html" class="tags">application catalog</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/centos.html" class="tags">centos</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/create.html" class="tags">create</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/deploy.html" class="tags">deploy</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/environment.html" class="tags">environment</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/install.html" class="tags">install</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/liberty.html" class="tags">liberty</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/manual.html" class="tags">manual</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/murano.html" class="tags">murano</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/packstack.html" class="tags">packstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rdo.html" class="tags selected">rdo</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/red-hat.html" class="tags">red hat</a>
                </div>
		<a href="https://egonzalez90.github.io/murano-in-rdo-openstack-manual-installation.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/2" class="prev_page">&larr;&nbsp;Previous</a>
                    <a href="https://egonzalez90.github.io/page/4" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 3 of 4</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>