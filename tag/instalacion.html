<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles tagged "instalacion"</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/tag/instalacion.html">instalacion</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Jan 29, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/configuracion-de-image-service-glance.html" rel="bookmark" title="Permanent Link to &quot;Configuración de Image Service Glance&quot;">Configuración de Image Service Glance</a>
                </h2>

                
                

                <p>Lo primero que debemos instalar son los paquetes de Glance en Controller
Node.</p>
<blockquote>
<p># yum install openstack-glance python-glanceclient</p>
</blockquote>
<p>Después configuraremos en enlace con la base de datos en los ficheros de
configuración de Glance:</p>
<blockquote>
<p># openstack-config --set /etc/glance/glance-api.conf</p>
<p>database connection mysql://glance:PASSWD@controller/glance</p>
<p># openstack-config --set /etc/glance/glance-registry.conf</p>
<p>database connection mysql://glance:PASSWD@controller/glance</p>
</blockquote>
<p>A continuación crearemos el usuario y la base de datos de Glance</p>
<blockquote>
<p>mysql -u root -p</p>
<p># CREATE DATABASE glance;</p>
<p>#GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'localhost' IDENTIFIED
BY 'PASSWD'</p>
<p>#GRANT ALL PRIVILEGES ON glance.* TO 'glance'@'%' IDENTIFIED BY
'PASSWD'</p>
</blockquote>
<p>Crearemos las tablas en la base de datos</p>
<blockquote>
<p># su -s /bin/sh -c "glance-manage db_sync" glance</p>
</blockquote>
<p>Creamos el usuario Glance en keystone con tenant "service" y rol "admin"</p>
<blockquote>
<p># keystone user-create --name=glance --pass=PASSWD
--email=email@mail.com</p>
<p># keystone user-role-add --user=glance --tenant-service --role=admin</p>
</blockquote>
<p>A continuación modificaremos los ficheros de configuración de Glance</p>
<blockquote>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken auth_uri http://controller:5000</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken  auth_host controller</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken auth_port 35357</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken auth_protocol http</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken admin_tenant_name service</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken admin_user glance</p>
<p># openstack-config --set /etc/glance/glance-api.conf
keystone_authtoken admin_password PASSWD</p>
<p># openstack-config --set /etc/glance/glance-api.conf paste_deploy
flavor keystone</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken auth_uri http://controller:5000</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken auth_host controller</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken auth_port 35357</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken auth_protocol http</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken admin_tenant_name service</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken admin_user glance</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
keystone_authtoken admin_password PASSWD</p>
<p># openstack-config --set /etc/glance/glance-registry.conf
paste_deploy flavor keystone</p>
</blockquote>
<p>Después de configurar los ficheros anteriores, registraremos el servicio
y creamos el endpoint</p>
<blockquote>
<p># keystone service-create --name=glance --type=image
--description="Image Service"</p>
<p># keystone endpoint-create --service-id=\&lt;ID></p>
<p>--publicurl=http://controller:9292</p>
<p>--internalurl=http://controller:9292</p>
<p>--adminurl=http://controller:9292</p>
</blockquote>
<p>Iniciamos el servicio y habilitamos la ejecución en el arranque</p>
<blockquote>
<p># service openstack-glance-api start</p>
<p># service openstack-glance-registry start</p>
<p>#chkconfig openstack-glance-api on</p>
<p># chkconfig openstack-glance-registry on</p>
</blockquote>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/configuracion-de-image-service-glance.html">posted at 17:36</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/configuracion.html" class="tags">configuracion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance.html" class="tags">glance</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/glance-api.html" class="tags">glance-api</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/image-service.html" class="tags">image service</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instalacion.html" class="tags selected">instalacion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                </div>
		<a href="https://egonzalez90.github.io/configuracion-de-image-service-glance.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Dec 29, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/comprobar-keystone.html" rel="bookmark" title="Permanent Link to &quot;Comprobar Keystone&quot;">Comprobar Keystone</a>
                </h2>

                
                

                <p>En anteriores post hemos configurado Keystone(Identity Service), ahora
deberemos de comprobar que este correctamente configurado. Para ello he
creado esta entrada en el blog.</p>
<p>Lo primero que haremos será quitar las variables de entorno con las que
nos autenticábamos en el servicio, con ello nos tendremos que autenticar
con usuario y contraseña.</p>
<blockquote>
<p>unset OS_SERVICE_TOKEN OS_SERVICE_ENDPOINT</p>
</blockquote>
<p>A continuación crearemos el archivo admin-openrc.sh, en el que
configuraremos los datos de nuestro usuario, en este caso el usuario
admin previamente creado. Una vez creado el fichero anterior mediante un
editor de texto, vi, gedit, nano, etc. Incluiremos el siguiente
contenido:</p>
<blockquote>
<p>export OS_USERNAME=admin</p>
<p>export OS_PASSWORD=\&lt;adminPASSWORD></p>
<p>export OS_TENANT_NAME=admin</p>
<p>export OS_AUTH_URL=http://controller:35357/v2.0</p>
</blockquote>
<p>A continuación, estableceremos las variables de entorno añadidas en el
archivo admin-openrc.sh</p>
<blockquote>
<p>source admin-openrc.sh</p>
</blockquote>
<p>Comprobaremos que podemos listar los usuarios y ya de paso comprobamos
que estan bien definidas las variables y por lo tanto estamos utilizando
el usuario admin en esta operación</p>
<blockquote>
<p>keystone user-list</p>
</blockquote>
<p>Listamos los roles del usuario admin</p>
<blockquote>
<p>keystone user-role-list --user=admin --tenant=admin</p>
</blockquote>
<p>Estos dos últimos comandos nos mostraran una información, en la que
comprobaremos que el ID del usuario admin esta en el rol de admin y
_member_</p>
<p>Si todo lo anterior salió correctamente quiere decir que tenemos la
configuración básica de Identity Service correctamente realizada y
podremos seguir configurando mas servicios en nuestro entorno</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/comprobar-keystone.html">posted at 18:14</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/-.html" class="tags">-</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/comprobar.html" class="tags">comprobar</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instalacion.html" class="tags selected">instalacion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystone.html" class="tags">keystone</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/list.html" class="tags">list</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/role.html" class="tags">role</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/usr.html" class="tags">usr</a>
                </div>
		<a href="https://egonzalez90.github.io/comprobar-keystone.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Nov 21, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/816.html" rel="bookmark" title="Permanent Link to &quot;Instalación Identity Service (Keystone)&quot;">Instalación Identity Service (Keystone)</a>
                </h2>

                
                

                <p>Primero instalaremos los paquetes necesarios de Openstack Identity
Service</p>
<blockquote>
<p>yum install openstack-keystone python-keystoneclient</p>
</blockquote>
<p>A Continuación configuraremos keystone para usar la base de datos MySQL
que habiamos creado</p>
<blockquote>
<p>openstack-config --set /etc/keystone/keystone.conf database connection
mysql://keystone:PASSWORD@controller/keystone</p>
</blockquote>
<p>Crearemos la base de datos para keystone y el usuario keystone</p>
<blockquote>
<p>mysql -u root -p</p>
<p>CREATE DATABASE keystone;</p>
<p>GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost'
IDENTIFIED BY 'keystonepassword';</p>
<p>GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY
'keystonepassword';</p>
<p>exit</p>
</blockquote>
<p>Creamos las tablas de keystone</p>
<blockquote>
<p>su -s /bin/sh -c "keystone-manage db_sync" keystone</p>
</blockquote>
<p>Creamos un token de autenticacion para usar como clave entre keystone y
los demás servicios de openstack</p>
<blockquote>
<p>ADMIN_TOKEN=\$(openssl rand -hex 10)</p>
<p>echo \$ADMIN_TOKEN</p>
<p>openstack-config --set /etc/keystone/keystone.conf DEFAULT
admin_token \$ADMIN_TOKEN</p>
</blockquote>
<p>Creamos las claves firmadas y los certificados, también restringimos el
acceso a la información generada</p>
<blockquote>
<p>keystone-manage pki_setup --keystone-user keystone --keystone-group
keystone</p>
<p>chown -R keystone:keystone /etc/keystone/ssl</p>
<p>chmod -R o-rwx /etc/keystone/ssl</p>
</blockquote>
<p>Iniciamos el servicio keystone y establecemos el arranque del servicio
con el arranque del sistema</p>
<blockquote>
<p>service openstack-keystone start</p>
<p>chkconfig openstack-keystone on</p>
</blockquote>
<p>Creamos una tarea en cron para que elimine los tokens caducados y
prevenir  una acumulación innecesaria</p>
<blockquote>
<p>(crontab -l -u keystone 2>&amp;1 | grep -q token_flush) ||<br>
 echo '@hourly /usr/bin/keystone-manage token_flush
>/var/log/keystone/<br>
 keystone-tokenflush.log 2>&amp;1' >> /var/spool/cron/keystone</p>
</blockquote>
<p>Ya tendríamos instalado keystone, el siguiente paso sera crear los
usuarios, tenants y roles de administración, eso lo veremos en la
siguiente entrada.</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/816.html">posted at 16:49</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/cloud.html" class="tags">cloud</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/configuracion.html" class="tags">configuracion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/guia.html" class="tags">guia</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/identity.html" class="tags">identity</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instalacion.html" class="tags selected">instalacion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystone.html" class="tags">keystone</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                </div>
		<a href="https://egonzalez90.github.io/816.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/2" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 3</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>