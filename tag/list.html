<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles tagged "list"</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/tag/list.html">list</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Jul 02, 2015</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html" rel="bookmark" title="Permanent Link to &quot;List all tenants belonging an user  Keystone v2&quot;">List all tenants belonging an user  Keystone v2</a>
                </h2>

                
                

                <p>Here is a simple script to list all tenants belonging an user:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span> -n <span class="s2">&quot;Username : &quot;</span> <span class="p">;</span> <span class="nb">read</span> usercheck

<span class="k">for</span> userid in <span class="k">$(</span>keystone user-list <span class="p">|</span> grep -w <span class="nv">$usercheck</span> <span class="p">|</span> awk <span class="s1">&#39;{print$2}&#39;</span><span class="k">)</span>
    <span class="k">do</span>
    <span class="k">for</span> tenant in <span class="k">$(</span>keystone tenant-list <span class="p">|</span> awk <span class="s1">&#39;NR&gt;3 &amp;&amp; /^|/ {print$2}&#39;</span><span class="k">)</span>
    <span class="k">do</span>
        <span class="k">for</span> tenantid in <span class="k">$(</span>keystone user-role-list --user <span class="nv">$userid</span> --tenant <span class="nv">$tenant</span> <span class="p">|</span> awk <span class="s1">&#39;NR&gt;3 &amp;&amp; /^|/ {print$8}&#39;</span><span class="k">)</span>
        <span class="k">do</span>
            keystone tenant-list <span class="p">|</span> grep <span class="nv">$tenantid</span> <span class="p">|</span> awk <span class="s1">&#39;{print$4}&#39;</span>
        <span class="k">done</span>
    <span class="k">done</span>
<span class="k">done</span>
</pre></div>
</td></tr></table>

<p>Also you can run all in a simple cmd line:<br>
</p>
<div class="highlight"><pre><span></span>echo -n &quot;user name &quot;; read usercheck; for userid in $(keystone user-list | grep $usercheck | awk &#39;{print$2}&#39;); do echo $userid | for tenant in $(keystone tenant-list | awk &#39;NR&gt;3 &amp;&amp; /^|/ {print$2}&#39;); do echo $tenant | for tenantid in $(keystone user-role-list --user $userid --tenant $tenant | awk &#39;NR&gt;3 &amp;&amp; /^|/ {print$8}&#39;); do keystone tenant-list | grep $tenantid | awk &#39;{print$4}&#39;; done ; done ; done
</pre></div>


<p>If you are a developer, probably you need to list all tenants in a HTTP
request, for this purpose you can use curl to the port 5000 of keystone<br>
</p>
<div class="highlight"><pre><span></span>curl -i -X GET http://KEYSTONEIP:5000/v2.0/tenants -H &quot;User-Agent: python-keystoneclient&quot; -H &quot;X-Auth-Token: USERTOKEN&quot;
</pre></div>


<p>I have saved the user token in a OS_VARIABLE called OS_TOKEN, if you
don't do that, you should input all the token in the HTTP request.<br>
For example:<br>
</p>
<div class="highlight"><pre><span></span>curl -i -X GET http://192.168.1.11:5000/v2.0/tenants -H &quot;User-Agent: python-keystoneclient&quot; -H &quot;X-Auth-Token: $OS_TOKEN&quot;
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html">posted at 14:29</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/all.html" class="tags">all</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/bash.html" class="tags">bash</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/belong.html" class="tags">belong</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/curl.html" class="tags">curl</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/get.html" class="tags">GET</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/how.html" class="tags">how</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/inside.html" class="tags">inside</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystone.html" class="tags">keystone</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystoneclient.html" class="tags">keystoneclient</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystonev2.html" class="tags">keystonev2</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/list.html" class="tags selected">list</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/python.html" class="tags">python</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/role.html" class="tags">role</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/script.html" class="tags">script</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/tenant.html" class="tags">tenant</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/tenants.html" class="tags">tenants</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/to.html" class="tags">to</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/token.html" class="tags">Token</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/user.html" class="tags">user</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/users.html" class="tags">users</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/v2.html" class="tags">v2</a>
                </div>
		<a href="https://egonzalez90.github.io/list-all-tenants-belonging-an-user.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Dec 29, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/comprobar-keystone.html" rel="bookmark" title="Permanent Link to &quot;Comprobar Keystone&quot;">Comprobar Keystone</a>
                </h2>

                
                

                <p>En anteriores post hemos configurado Keystone(Identity Service), ahora
deberemos de comprobar que este correctamente configurado. Para ello he
creado esta entrada en el blog.</p>
<p>Lo primero que haremos será quitar las variables de entorno con las que
nos autenticábamos en el servicio, con ello nos tendremos que autenticar
con usuario y contraseña.</p>
<blockquote>
<p>unset OS_SERVICE_TOKEN OS_SERVICE_ENDPOINT</p>
</blockquote>
<p>A continuación crearemos el archivo admin-openrc.sh, en el que
configuraremos los datos de nuestro usuario, en este caso el usuario
admin previamente creado. Una vez creado el fichero anterior mediante un
editor de texto, vi, gedit, nano, etc. Incluiremos el siguiente
contenido:</p>
<blockquote>
<p>export OS_USERNAME=admin</p>
<p>export OS_PASSWORD=\&lt;adminPASSWORD></p>
<p>export OS_TENANT_NAME=admin</p>
<p>export OS_AUTH_URL=http://controller:35357/v2.0</p>
</blockquote>
<p>A continuación, estableceremos las variables de entorno añadidas en el
archivo admin-openrc.sh</p>
<blockquote>
<p>source admin-openrc.sh</p>
</blockquote>
<p>Comprobaremos que podemos listar los usuarios y ya de paso comprobamos
que estan bien definidas las variables y por lo tanto estamos utilizando
el usuario admin en esta operación</p>
<blockquote>
<p>keystone user-list</p>
</blockquote>
<p>Listamos los roles del usuario admin</p>
<blockquote>
<p>keystone user-role-list --user=admin --tenant=admin</p>
</blockquote>
<p>Estos dos últimos comandos nos mostraran una información, en la que
comprobaremos que el ID del usuario admin esta en el rol de admin y
_member_</p>
<p>Si todo lo anterior salió correctamente quiere decir que tenemos la
configuración básica de Identity Service correctamente realizada y
podremos seguir configurando mas servicios en nuestro entorno</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/comprobar-keystone.html">posted at 18:14</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/-.html" class="tags">-</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/comprobar.html" class="tags">comprobar</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instalacion.html" class="tags">instalacion</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/keystone.html" class="tags">keystone</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/list.html" class="tags selected">list</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/role.html" class="tags">role</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/usr.html" class="tags">usr</a>
                </div>
		<a href="https://egonzalez90.github.io/comprobar-keystone.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Oct 05, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/nova-flavor-con-acls.html" rel="bookmark" title="Permanent Link to &quot;Nova flavor con control de acceso&quot;">Nova flavor con control de acceso</a>
                </h2>

                
                

                <p>Primero crearemos un "flavor"(sabor) mediante es siguiente comando, este
sabor le haremos privado mediante la opción --is-public=False, un ID
23, con 4vCPU y 4 GB de RAM.<!--more--></p>
<p>``` {style="border: 0px; margin-top: 0px; margin-bottom: 24px; padding: 1.5em; vertical-align: baseline; font-family: 'Courier 10 Pitch', Courier, monospace; color: #222222; line-height: 21px; overflow: auto; font-size: 15px; background: #f7f7f7;"}
$ nova flavor-create 4vCPU-4GB_Mem 23 4096 0 4 --is-public=False
+----+----------------+-----------+------+-----------+------+-------+-------------+-----------+
| ID | Name           | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |
+----+----------------+-----------+------+-----------+------+-------+-------------+-----------+
| 23 | 4vCPU-4GB_Mem  |  4096     | 0    | 0         |      |     4 | 1.0         |     False |
+----+----------------+-----------+------+-----------+------+-------+-------------+-----------+</p>
<div class="highlight"><pre><span></span><span class="nt">A</span> <span class="nt">continuaci</span><span class="err">ó</span><span class="nt">n</span> <span class="nt">buscaremos</span> <span class="nt">el</span> <span class="nt">tenant</span><span class="err">\</span><span class="nt">_ID</span><span class="err"> </span><span class="nt">del</span> <span class="nt">tenant</span> <span class="nt">al</span> <span class="nt">que</span> <span class="nt">queramos</span>
<span class="nt">asignar</span> <span class="nt">el</span> <span class="nt">sabor</span><span class="o">,</span> <span class="nt">en</span> <span class="nt">este</span> <span class="nt">caso</span> <span class="nt">el</span> <span class="nt">tenant</span><span class="o">(</span><span class="nt">previamente</span> <span class="nt">creado</span><span class="o">)</span> <span class="nt">es</span> <span class="nt">prueba</span>

<span class="err">```</span> <span class="p">{</span><span class="err">style=&quot;</span><span class="k">border</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span> <span class="k">margin-top</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span> <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">24</span><span class="kt">px</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">1.5</span><span class="kt">em</span><span class="p">;</span> <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">baseline</span><span class="p">;</span> <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Courier 10 Pitch&#39;</span><span class="p">,</span> <span class="n">Courier</span><span class="p">,</span> <span class="kc">monospace</span><span class="p">;</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#222222</span><span class="p">;</span> <span class="k">line-height</span><span class="p">:</span> <span class="mi">21</span><span class="kt">px</span><span class="p">;</span> <span class="k">overflow</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span> <span class="k">font-size</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#f7f7f7</span><span class="p">;</span><span class="err">&quot;</span><span class="p">}</span>
<span class="o">$</span> <span class="nt">keystone</span> <span class="nt">tenant-list</span> <span class="o">|</span> <span class="nt">grep</span> <span class="nt">prueba</span>
<span class="o">|</span> <span class="nt">41a0db24bc8940b6a2f3297bef5f6cee</span> <span class="o">|</span> <span class="nt">prueba</span> <span class="o">|</span> <span class="nt">True</span> <span class="o">|</span>
</pre></div>


<p>Con el tenant_ID y el flavor_ID, asignaremos el flavor a el tenant, lo
haremos mediante el siguiente comando:</p>
<ul>
<li>23 es flavor_ID</li>
<li>41a0db24bc8940b6a2f3297bef5f6cee es tenant_ID</li>
</ul>
<p>``` {style="border: 0px; margin-top: 0px; margin-bottom: 24px; padding: 1.5em; vertical-align: baseline; font-family: 'Courier 10 Pitch', Courier, monospace; color: #222222; line-height: 21px; overflow: auto; font-size: 15px; background: #f7f7f7;"}
$ nova flavor-access-add 23 41a0db24bc8940b6a2f3297bef5f6cee
+-----------+----------------------------------+
| Flavor_ID | Tenant_ID                        |
+-----------+----------------------------------+
|        23 | 41a0db24bc8940b6a2f3297bef5f6cee |
+-----------+----------------------------------+</p>
<div class="highlight"><pre><span></span><span class="nt">Por</span> <span class="nt">ultimo</span> <span class="nt">comprobaremos</span><span class="err"> </span><span class="nt">la</span> <span class="nt">lista</span> <span class="nt">de</span> <span class="nt">sabores</span><span class="o">,</span> <span class="nt">aqui</span> <span class="nt">veremos</span> <span class="nt">como</span> <span class="nt">el</span>
<span class="nt">flavor</span> <span class="nt">no</span> <span class="nt">es</span> <span class="nt">publico</span><span class="o">,</span> <span class="err"> </span><span class="nt">y</span> <span class="nt">deber</span><span class="err">í</span><span class="nt">a</span> <span class="nt">de</span> <span class="nt">estar</span> <span class="nt">solo</span> <span class="nt">disponible</span> <span class="nt">para</span> <span class="nt">el</span> <span class="nt">tenant</span>
<span class="nt">asignado</span> <span class="nt">anteriormente</span>

<span class="err">```</span> <span class="p">{</span><span class="err">style=&quot;</span><span class="k">border</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span> <span class="k">margin-top</span><span class="p">:</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span> <span class="k">margin-bottom</span><span class="p">:</span> <span class="mi">24</span><span class="kt">px</span><span class="p">;</span> <span class="k">padding</span><span class="p">:</span> <span class="mf">1.5</span><span class="kt">em</span><span class="p">;</span> <span class="k">vertical-align</span><span class="p">:</span> <span class="kc">baseline</span><span class="p">;</span> <span class="k">font-family</span><span class="p">:</span> <span class="s1">&#39;Courier 10 Pitch&#39;</span><span class="p">,</span> <span class="n">Courier</span><span class="p">,</span> <span class="kc">monospace</span><span class="p">;</span> <span class="k">color</span><span class="p">:</span> <span class="mh">#222222</span><span class="p">;</span> <span class="k">line-height</span><span class="p">:</span> <span class="mi">21</span><span class="kt">px</span><span class="p">;</span> <span class="k">overflow</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span> <span class="k">font-size</span><span class="p">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span> <span class="k">background</span><span class="p">:</span> <span class="mh">#f7f7f7</span><span class="p">;</span><span class="err">&quot;</span><span class="p">}</span>
<span class="o">$</span> <span class="nt">nova</span> <span class="nt">flavor-list</span>
<span class="o">+</span><span class="nt">----</span><span class="o">+</span><span class="nt">-----------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-------</span><span class="o">+</span><span class="nt">-------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span>
<span class="o">|</span> <span class="nt">ID</span> <span class="o">|</span> <span class="nt">Name</span>            <span class="o">|</span> <span class="nt">Memory_MB</span> <span class="o">|</span> <span class="nt">Disk</span> <span class="o">|</span> <span class="nt">Ephemeral</span> <span class="o">|</span> <span class="nt">Swap</span> <span class="o">|</span> <span class="nt">VCPUs</span> <span class="o">|</span> <span class="nt">RXTX_Factor</span> <span class="o">|</span> <span class="nt">Is_Public</span> <span class="o">|</span>
<span class="o">+</span><span class="nt">----</span><span class="o">+</span><span class="nt">-----------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-------</span><span class="o">+</span><span class="nt">-------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span>
<span class="o">|</span> <span class="nt">23</span> <span class="o">|</span> <span class="nt">4vCPU-4GB_Mem</span>   <span class="o">|</span> <span class="nt">4096</span>      <span class="o">|</span> <span class="nt">0</span>    <span class="o">|</span> <span class="nt">0</span>         <span class="o">|</span>      <span class="o">|</span> <span class="nt">4</span>     <span class="o">|</span> <span class="nt">4</span><span class="p">.</span><span class="nc">0</span>         <span class="o">|</span> <span class="nt">False</span>     <span class="o">|</span>
<span class="o">+</span><span class="nt">----</span><span class="o">+</span><span class="nt">-----------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span><span class="nt">------</span><span class="o">+</span><span class="nt">-------</span><span class="o">+</span><span class="nt">-------------</span><span class="o">+</span><span class="nt">-----------</span><span class="o">+</span>
</pre></div>


<p><span style="font-size: 14px; line-height: 22.3999996185303px;">La
información sacada para este post viene de este blog (en ingles),
visitarle si tenéis
ocasión: <a href="http://blog.aaronorosen.com/nova-flavors-with-access-control/">http://blog.aaronorosen.com/nova-flavors-with-access-control/</a></span></p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/nova-flavor-con-acls.html">posted at 17:47</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/openstack.html" rel="tag">OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/acceso.html" class="tags">acceso</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/acl.html" class="tags">acl</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/cloud.html" class="tags">cloud</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/control.html" class="tags">control</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/flavor.html" class="tags">flavor</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/flavor_id.html" class="tags">flavor_id</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/flavor-access-add.html" class="tags">flavor-access-add</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/flavor-create.html" class="tags">flavor-create</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/list.html" class="tags selected">list</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/nova.html" class="tags">nova</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/openstack.html" class="tags">openstack</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/tenant_id.html" class="tags">tenant_id</a>
                </div>
		<a href="https://egonzalez90.github.io/nova-flavor-con-acls.html#disqus_thread">Click to read and post comments</a>
            </article>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>