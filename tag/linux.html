<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenStack Stuff | articles tagged "linux"</title>
    <link rel="shortcut icon" type="image/png" href="https://egonzalez90.github.io/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://egonzalez90.github.io/favicon.ico">
    <link href="https://egonzalez90.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OpenStack Stuff Full Atom Feed" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://egonzalez90.github.io/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Eduardo Gonzalez" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://egonzalez90.github.io/tag/linux.html">linux</a></li>
                <li><a href="https://egonzalez90.github.io/">Home</a></li>
                <li><a href="https://docs.openstack.org">OpenStack</a></li>
                <li><a href="https://www.linkedin.com/in/eduardogonzalezgutierrez">Linkedin</a></li>
                <li><a href="https://github.com/egonzalez90">Github</a></li>
                <li><a href="https://egonzalez90.github.io/archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://egonzalez90.github.io/">OpenStack Stuff</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Oct 15, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/analisis-forense-servidor-atacado.html" rel="bookmark" title="Permanent Link to &quot;Análisis Forense Servidor Atacado&quot;">Análisis Forense Servidor Atacado</a>
                </h2>

                
                

                <p>Esta guía te proporcionara las bases para investigar servidores que su
seguridad ha sido comprometida.</p>
<p>Veremos  los diferentes modos para determinar:</p>
<ul>
<li>Punto de entrada</li>
<li>Origen del ataque</li>
<li>Archivos comprometidos</li>
<li>Nivel de acceso obtenido por el atacante</li>
<li>Investigación de pruebas y rastros dejados por los atacantes</li>
</ul>
<!--more-->

<p>Son muchos los puntos de entradas que un servidor Linux/Unix puede
tener, pero es importante que método se ha usado para determinar el daño
que ha podido hacer en a máquina y/o otros servidores conectados entre
sí.</p>
<p>La mejor forma de arreglar un servidor comprometido es re instalar el
sistema operativo y restaurar los datos importantes desde una copia de
seguridad, pero es importante investigar el servidor afectado para
conocer el punto de entrada y así poder parchearlo en la reinstalación
del SO.</p>
<h1>Documentación</h1>
<p>Cuando te enteras que un sistema bajo tu control puede haber sido
comprometido, debes de intentar obtener la mayor información posible del
denunciante. Entre ellas:</p>
<ul>
<li>Cuando se encontró el problema inicial</li>
<li>La hora estimada del ataque</li>
<li>Se ha modificado el servidor desde el ataque</li>
<li>Alguna cosa más que el denunciante considere importante</li>
</ul>
<p>NOTA: Si estás pensando en involucrar a las fuerzas de la ley, realizar
denuncias, es muy importante que no se realice ninguna acción en el
servidor. Este debe quedar en su estado actual a un equipo de
informática forense para la búsqueda de pruebas.</p>
<p>Si vas a proceder a la investigación, documenta toda lo que encuentres
en el servidor.</p>
<h1>Herramientas usadas en la investigación</h1>
<p>En un escenario ideal para un atacante, todos los archivos de log se
habrán borrado dejando su rastro limpio. Por suerte estos casos no se
suelen dar, y aunque los ataques estén automatizados, siempre hay alguna
pista desde la que encontrar información sobre cómo se ha realizado el
ataque, si es ataque web básico o un ataque que compromete el acceso
root.</p>
<p>Aquí tienes algunas herramientas con las que podrás investigar posibles
rastros para analizar el sistema.</p>
<h2>last</h2>
<p>Esta herramienta listara las últimas sesiones de usuario, con este
comando podrás ver horas de sesión, IP, nombre de usuario, etc.</p>
<p>Un numero exagerado de direcciones IP en los archivos de log
/var/log/messages o /var/log/secure puede indicar que el atacante
realizo un ataque por fuerza bruta, eso reflejara en el comando last la
hora de cuando consiguió dicho acceso al servidor</p>
<h2>ls -lart</h2>
<p>Este comando nos mostrara una lista de archivos y directorios ordenados
por fecha según la última modificación. Esto nos permitirá saber que ha
sido modificado o añadido comprobándolo con las fechas del ataque.</p>
<h2>netstat -na</h2>
<p>Eso nos listara las conexiones a la escucha existentes. Nos podrá
revelar posibles backdoors o servicios que no deberían estar en escucha,
los cuales pueden ser causa de alguno de los ficheros</p>
<h2>alias</h2>
<p>Este comando nos mostrara los alias de comandos, es posible que un
atacante cree alias para que al ejecutar determinado comando se ejecute
otro.</p>
<h2>ps -wauxef</h2>
<p>Este comando nos es muy útil a la hora de detectar procesos erróneos en
escucha, además también nos listara otros procesos como los del usuario
www. lsof | grep \&lt;pid> puede ser usado para encontrar que archivos
está utilizando determinado proceso. Igualmente con cat
/proc/\&lt;pid>/cmdline puedes saber dónde está el archivo que controla el
proceso.</p>
<h2>bash_history</h2>
<p>Mediante este comando obtendremos el historial de los comandos
ejecutados desde los diferentes usuarios. El archivo se encuentra en la
carpeta / root y el /home/ de cada usuario. Es oculto</p>
<h2>top</h2>
<p>A veces un proceso malicioso causa extremo uso de CPU causando problemas
en el entorno, suele estar situado en el principio de la lista. Todo
proceso que este causando un consumo excesivo de CPU debe ser
considerado sospechoso</p>
<h2>strace -p</h2>
<p>Este comando se ejecutara sobre procesos sospechosos, el cual nos dará
mucha información sobre que está realizando.</p>
<p>En algunos casos, este comando no nos proporcionara ninguna información
real, debido a que se pueden haber modificado los binarios para que la
salida del comando no muestre lo que debería, complicando la
investigación del ataque. Para ello investigaremos que dichos binarios
no están trojanizados:</p>
<h2>rpm -Va</h2>
<p>Este comando comprobara la información de los paquetes instalados con
los metadatos de la base de datos rpm. Entre otras cosas, compara el
tamaño, suma de verificación MD5, permisos, tipo, propietario y grupo.
Cualquier modificación del paquete original será mostrada.</p>
<p>Cuando se ejecuta este comando, es importante si alguno de los paquetes
marcados como modificados esta en alguno de los siguientes directorios,
de ser así, puede significar que se está usando una versión trojanizada
del binario, por lo que no se puede fiar de la salida del comando.</p>
<h4>/bin</h4>
<h4>/sbin</h4>
<h4>/usr/bin</h4>
<h4>/usr/sbin</h4>
<h2>rpm -qa</h2>
<p>Este comando te mostrara cuales son los últimos paquetes instalado en
orden cronológico. En cualquier caso, si el acceso root ha sido
comprometido, la base de datos rpm puede haber sido modificada y no ser
fiable</p>
<h2>lsattr</h2>
<p>En el caso de que el atacante haya conseguido acceso root y trojanizar
determinados binarios, puede que haya establecido dicho binario como
inmutable, por lo que no podrás reinstalar una versión limpia del
binario. Los directorios más comunes son:</p>
<h4>/bin</h4>
<h4>/sbin</h4>
<h4>/usr/bin</h4>
<h4>/usr/sbin</h4>
<p>También deberías de buscar por otros directorios como /etc, /root, /tmp,
etc.</p>
<p>Un ejemplo del binario de ps establecido como inmutable es este:</p>
<h4>-------i----- /bin/ps</h4>
<h2>find / mtime 5</h2>
<p>Con este comando buscaras archivos que han sido modificados en los
últimos 5 días, puedes cambiar el digito numérico si sabes las fechas
exactas, así afinaras más las búsqueda y evitaras ver archivos
modificados que no tengan interés en la investigación.</p>
<h1>Directorios comunes donde se encuentran los exploits</h1>
<p>Comprueba los directorios que Apache comúnmente puede escribir sus
archivos temporales</p>
<h4>ls -al /tmp</h4>
<h4>ls -al /var/tmp</h4>
<h4>ls -al /dev/shm</h4>
<p>Si tienes algun fichero con todos los permisos 777, sospecha de el.</p>
<p>Comprueba que los ficheros ocultos no tengan permisos de ejecución.</p>
<h1>Encontrando el punto de acceso</h1>
<p>Si has encontrado algo con la información anterior, quiere decir que ya
sabes más o menos cuando el ataque se ha realizado, de qué forma y
contra que. Ahora ya podrás investigar sobre los logs de acceso a la
página web por la fecha por la que se produjo el ataque. También debes
mirar en los archivos /var/log/* en los cuales encontraras información
de accesos, del sistema, etc.</p>
<p>Si tienes alguna aplicación afectada que también guarde logs, puedes
investigar sobre ellos para buscar más información sobre el atacante.</p>
<p>Debido a un ataque en uno de los servidores que administro tuve que
lidiar con este tipo de investigación forense. Encontré poca información
al respecto, hasta que encontré la siguiente web, que definitivamente me
ayudo realmente.</p>
<p>https://community.rackspace.com/general/f/34/t/75</p>
<p>Estoy realmente agradecido al creador de esa información, por eso me
decidí a traducirla (no literalmente) para que los que sufran de ese
mismo problema y no sepan ingles puedan descubrir que les han hecho en
su servidor.</p>
<p>En la misma web, tienen un ejemplo práctico de como el encontró su
webshell en phpmyadmin, os recomiendo que la lean.</p>
<p>Infinitamente agradecido.</p>
<p>Un saludo</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/analisis-forense-servidor-atacado.html">posted at 16:42</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/linux.html" rel="tag">Linux</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/analisis.html" class="tags">analisis</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/atacado.html" class="tags">atacado</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ataque.html" class="tags">ataque</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/bash_history.html" class="tags">bash_history</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/busqueda.html" class="tags">busqueda</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ethical.html" class="tags">ethical</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/forense.html" class="tags">forense</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/hacking.html" class="tags">Hacking</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/informatica.html" class="tags">informatica</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/last.html" class="tags">last</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/linux.html" class="tags selected">linux</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/lsattr.html" class="tags">lsattr</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/mtime.html" class="tags">mtime</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/netstat.html" class="tags">netstat</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/ps.html" class="tags">ps</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rpm-va.html" class="tags">rpm -Va</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/seguridad.html" class="tags">Seguridad</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/servidor.html" class="tags">servidor</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/strace.html" class="tags">strace</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/top.html" class="tags">top</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/unix.html" class="tags">unix</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/vulnerable.html" class="tags">vulnerable</a>
                </div>
		<a href="https://egonzalez90.github.io/analisis-forense-servidor-atacado.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Oct 03, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/instalar-aws-cli.html" rel="bookmark" title="Permanent Link to &quot;Instalar aws-cli&quot;">Instalar aws-cli</a>
                </h2>

                
                

                <p>AWS-cli es una potente línea de comandos que permite interactuar con
todos los servicios de AWS, en esta entrada mostrare como instalarlo en
un Ubuntu Server.<!--more--></p>
<hr>
<p>Esto mismo lo podrás instalar en RHEL cambiando el gestor de paquetes
apt por yum.</p>
<p>Primero instalaremos python y pip</p>
<blockquote>
<p>sudo apt-get install -y python-pip</p>
</blockquote>
<p>A continuación instalaremos awscli con pip</p>
<blockquote>
<p>sudo pip install awscli</p>
</blockquote>
<p>Después configuraremos awscli para que conecte con nuestra cuenta de AWS</p>
<blockquote>
<p>aws configure</p>
</blockquote>
<p>Aquí introduciremos los siguientes parámetros:</p>
<ul>
<li>Access Key ID: En el archivo credentials que se descarga al crear
    una nueva Access Key en IAM</li>
<li>Secret Access Key:<span style="line-height: 20.7999992370605px;"> En
    el archivo credentials que se descarga al crear una nueva Access Key
    en IAM</span></li>
<li>Region Name: La region de EC2 (no la zona de disponibilidad), es
    importante no poner el ultimo dígito(a,b,c,d) porque dará error de
    configuración y no conectará</li>
<li>Output format: Formato en que queremos que nos muestre los datos
    awscli, lo normal suele ser table o text</li>
</ul>
<blockquote>
<p>AWS Access Key ID [None]: AK***XCLG******XYR7A<br>
 AWS Secret Access Key [None]:
m*********q**********r5Zpyqsb*********AOL<br>
 Default region name [None]: eu-west-1<br>
 Default output format [None]: table</p>
</blockquote>
<p>Por ultimo probaremos que funciona, listando las regiones que tenemos
disponibles, si este comando funciona quiere decir que esta bien
configurado</p>
<blockquote>
<p>aws ec2 describe-regions</p>
</blockquote>
<div>

<div>

[![describe-regions](http://vps38574.vps.ovh.ca/wp-content/uploads/2014/09/describe-regions.png)](http://vps38574.vps.ovh.ca/wp-content/uploads/2014/09/describe-regions.png)

 

</div>

<div>

</div>

</div>

<p>Un saludo</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/instalar-aws-cli.html">posted at 17:11</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/linux-openstack.html" rel="tag">Linux, OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/access-key.html" class="tags">access key</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/amazon.html" class="tags">amazon</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/aws.html" class="tags">AWS</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/awscli.html" class="tags">awscli</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/cloud.html" class="tags">cloud</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/configurar.html" class="tags">configurar</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/instalar.html" class="tags">instalar</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/linux.html" class="tags selected">linux</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/region.html" class="tags">region</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/secret.html" class="tags">secret</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/services.html" class="tags">services</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/web.html" class="tags">web</a>
                </div>
		<a href="https://egonzalez90.github.io/instalar-aws-cli.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Sep 17, 2014</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://egonzalez90.github.io/montar-volumen-aws-en-rhel.html" rel="bookmark" title="Permanent Link to &quot;Montar volumen AWS en RHEL&quot;">Montar volumen AWS en RHEL</a>
                </h2>

                
                

                <p>Para poder realizar estos pasos es necesario que se haya creado un
volumen previamente en EC2 de AWS, nos conectaremos a la maquina por SSH
y seguiremos los siguientes pasos<!--more--></p>
<p>Primero comprobaremos que el volumen que habíamos creado en EC2 le ve el
SO, utilizaremos este comando</p>
<blockquote>
<p><span class="command" style="color: #000000;">lsblk</span><span
style="color: #000000;"> </span></p>
</blockquote>
<p>Lo normal es que el primer  volumen que añadas se llame xvdf alojado en
/dev/</p>
<p>Ahora lo formatearemos en EXT4</p>
<blockquote>
<p>sudo mkfs -t ext4 /dev/xvdf</p>
</blockquote>
<p>A continuación crearemos la carpeta en donde montaremos el volumen y
después lo montaremos en dicha carpeta</p>
<blockquote>
<p>sudo mkdir /mnt/volumen</p>
<p>sudo mount /dev/xvdf /mnt/volumen</p>
</blockquote>
<p>Ahora con el comando df -h comprobaremos que el SO ya lo ve montado</p>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://egonzalez90.github.io/montar-volumen-aws-en-rhel.html">posted at 17:05</a>
                    &nbsp;&middot;&nbsp;<a href="https://egonzalez90.github.io/category/linux-openstack.html" rel="tag">Linux, OpenStack</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://egonzalez90.github.io/tag/amazon.html" class="tags">amazon</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/anadir.html" class="tags">añadir</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/aws.html" class="tags">AWS</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/cloud.html" class="tags">cloud</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/computing.html" class="tags">computing</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/formatear.html" class="tags">formatear</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/linux.html" class="tags selected">linux</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/montar.html" class="tags">montar</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/red-hat.html" class="tags">red hat</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/rhel.html" class="tags">rhel</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/services.html" class="tags">services</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/volumen.html" class="tags">volumen</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/web.html" class="tags">web</a>
                    &nbsp;<a href="https://egonzalez90.github.io/tag/xvdf.html" class="tags">xvdf</a>
                </div>
		<a href="https://egonzalez90.github.io/montar-volumen-aws-en-rhel.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="https://egonzalez90.github.io/page/2" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 7</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://egonzalez90.github.io/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>